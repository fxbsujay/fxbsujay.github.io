<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ELK 学习文档 - Sujay</title>
    <meta name="description" content="Sujay Blog.">
    <link rel="preload stylesheet" href="/assets/style.24f015e4.css" as="style">
    
    <script type="module" src="/assets/app.fa9b4eef.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.4cf23e62.js">
    <link rel="modulepreload" href="/assets/chunks/theme.0be83c97.js">
    <link rel="modulepreload" href="/assets/blog_elk.md.59399ef9.lean.js">
    <link rel="icon" href="/favicon.ico">
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-1919c326><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-1919c326 data-v-7e5bc4a5><div class="VPNavBar has-sidebar" data-v-7e5bc4a5 data-v-a0fd61f4><div class="container" data-v-a0fd61f4><div class="title" data-v-a0fd61f4><div class="VPNavBarTitle has-sidebar" data-v-a0fd61f4 data-v-86d1bed8><a class="title" href="/" data-v-86d1bed8><!--[--><!--]--><!--[--><img class="VPImage logo" src="/favicon.ico" alt data-v-8426fc1a><!--]--><!--[-->Fan Xuebin<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-a0fd61f4><div class="curtain" data-v-a0fd61f4></div><div class="content-body" data-v-a0fd61f4><!--[--><!--]--><div class="VPNavBarSearch search" data-v-a0fd61f4><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a0fd61f4 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/blog/jdk_support.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>博客</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/components/button.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>UI组件库</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a0fd61f4 data-v-f6a63727><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-f6a63727 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a0fd61f4 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/fxbsujay" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a0fd61f4 data-v-40855f84 data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-40855f84 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-40855f84><div class="item social-links" data-v-40855f84><div class="VPSocialLinks social-links-list" data-v-40855f84 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/fxbsujay" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a0fd61f4 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-1919c326 data-v-79c8c1df><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-79c8c1df><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-79c8c1df><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-79c8c1df>目录</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-79c8c1df data-v-1c15a60a><button data-v-1c15a60a>返回</button><!----></div></div><aside class="VPSidebar" data-v-1919c326 data-v-b00e2fdd><div class="curtain" data-v-b00e2fdd></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-b00e2fdd><span class="visually-hidden" id="sidebar-aria-label" data-v-b00e2fdd> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible has-active" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>后端知识库</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/jdk_support.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>JAVA JDK17 新特性</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/bit_operation.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>位运算</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/redis.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Redis</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/docker.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Docker</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/mysql.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>MySql</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/mysql_index.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>MySql 索引</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/juc.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Java JUC</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/mq.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>消息队列</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/elk.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>ELK 学习文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/netty.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Netty 源码分析</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/snow-flake.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>雪花算法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/mymap.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>实现一个简易Map</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/shiwu.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Seata 分布式事务</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>前端知识库</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/css.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>css选择器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/eventLoop.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>事件循环</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/vue.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Vue3 快速上手</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>生活小工具</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/hexo.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>使用 Hexo 搭建一个博客</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/text.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>示例</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-1919c326 data-v-669faec9><div class="VPDoc has-sidebar has-aside" data-v-669faec9 data-v-6b87e69f><!--[--><!--]--><div class="container" data-v-6b87e69f><div class="aside" data-v-6b87e69f><div class="aside-curtain" data-v-6b87e69f></div><div class="aside-container" data-v-6b87e69f><div class="aside-content" data-v-6b87e69f><div class="VPDocAside" data-v-6b87e69f data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-d330b1bb><div class="content" data-v-d330b1bb><div class="outline-marker" data-v-d330b1bb></div><div class="outline-title" role="heading" aria-level="2" data-v-d330b1bb>大纲</div><nav aria-labelledby="doc-outline-aria-label" data-v-d330b1bb><span class="visually-hidden" id="doc-outline-aria-label" data-v-d330b1bb> Table of Contents for current page </span><ul class="root" data-v-d330b1bb data-v-d0ee3533><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b87e69f><div class="content-container" data-v-6b87e69f><!--[--><!--]--><!----><main class="main" data-v-6b87e69f><div style="position:relative;" class="vp-doc _blog_elk" data-v-6b87e69f><div><h1 id="elk-学习文档" tabindex="-1">ELK 学习文档 <a class="header-anchor" href="#elk-学习文档" aria-label="Permalink to &quot;ELK 学习文档&quot;">​</a></h1><h2 id="elasticsearch" tabindex="-1">Elasticsearch <a class="header-anchor" href="#elasticsearch" aria-label="Permalink to &quot;Elasticsearch&quot;">​</a></h2><blockquote><p>分布式、RESTFUL 风格的搜索和分析引擎 <a href="https://www.elastic.co/cn/downloads/past-releases/elasticsearch-7-8-0" target="_blank" rel="noreferrer">下载连接</a> <a href="https://www.elastic.co/guide/index.html" target="_blank" rel="noreferrer">官方文档</a> <a href="https://www.postman.com/downloads/" target="_blank" rel="noreferrer">postman</a></p></blockquote><blockquote></blockquote><details class="details custom-block"><summary>什么是全文搜索引擎 ？</summary><p>Google，百度类的网站搜索，它们都是根据网页中的关键字生成索引，我们在搜索的时候输入关键字，它们会将该关键字即索引匹配到的所有网页返回；还有常见的项目中应用日志的搜索等等。对于这些非结构化的数据文本，关系型数据库搜索不是能很好的支持</p></details><p>一般传统数据库，全文检索都实现的很鸡肋，因为一般也没人用数据库存文本字段。进行全文检索需要扫描整个表，如果数据量大的话即使对 SQL 的语法优化，也收效甚微。建立了索引，但是维护起来也很麻烦，对于 insert 和 update 操作都会重新构建索引</p><p>基于以上原因可以分析得出，在一些生产环境中，使用常规的搜索方式，性能是非常差的，例如：</p><ul><li>搜索的数据对象是大量的非结构化的文本数据</li><li>文件记录量达到数十万或数百万个甚至更多</li><li>支持大量基于交互式文本的查询</li><li>需求非常灵活的全文搜索查询</li><li>对高度相关的搜索结果的有特殊需求，但是没有可用的关系数据库可以满足</li><li>对不同记录类型、非文本数据操作或安全事务处理的需求相对较少的情况</li></ul><p>为了解决结构化数据搜索和非结构化数据搜索性能问题，我们就需要专业，健壮，强大的全文搜索引擎。</p><p><strong>这里说到的全文搜索引擎指的是目前广泛应用的主流搜索引擎</strong>。它的工作原理是计算机索引程序通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这个过程类似于通过字典中的检索字表查字的过程。</p><p><strong>Elasticsearch 应用案例</strong></p><ul><li>GitHub: 2013 年初，抛弃了 Solr，采取 Elasticsearch 来做 PB 级的搜索。 “GitHub 使用Elasticsearch 搜索 20TB 的数据，包括 13 亿文件和 1300 亿行代码”</li><li>维基百科：启动以 Elasticsearch 为基础的核心搜索架构</li><li>百度：目前广泛使用 Elasticsearch 作为文本数据分析，采集百度所有服务器上的各类指标数据及用户自定义数据，通过对各种数据进行多维分析展示，辅助定位分析实例异常或业务层面异常。目前覆盖百度内部 20 多个业务线（包括云分析、网盟、预测、文库、直达号、钱包、 风控等），单集群最大 100 台机器， 200 个 ES 节点，每天导入 30TB+数据</li><li>新浪：使用 Elasticsearch 分析处理 32 亿条实时日志</li><li>阿里：使用 Elasticsearch 构建日志采集和分析体系</li><li>Stack Overflow：解决 Bug 问题的网站，全英文，编程人员交流的网站</li></ul><h3 id="elasticsearch-基本使用" tabindex="-1">Elasticsearch 基本使用 <a class="header-anchor" href="#elasticsearch-基本使用" aria-label="Permalink to &quot;Elasticsearch 基本使用&quot;">​</a></h3><p>Windows 版的 Elasticsearch 压缩包，解压即安装完毕，解压后的目录结构如下</p><table><thead><tr><th><strong>目录</strong></th><th><strong>含义</strong></th></tr></thead><tbody><tr><td>bin</td><td>可执行脚本目录</td></tr><tr><td>config</td><td>配置目录</td></tr><tr><td>jdk</td><td>内置 JDK 目录</td></tr><tr><td>lib</td><td>类库</td></tr><tr><td>logs</td><td>日志目录</td></tr><tr><td>modules</td><td>模块目录</td></tr><tr><td>plugins</td><td>插件目录</td></tr></tbody></table><p>解压后，进入 bin 文件目录，点击 elasticsearch.bat 文件启动 ES 服务</p><div class="warning custom-block"><p class="custom-block-title">注意</p><p>9300 端口为 Elasticsearch 集群间组件的通信端口， 9200 端口为浏览器访问的 http协议 RESTFUL 端口</p></div><p>打开浏览器，输入地址： <a href="http://localhost:9200" target="_blank" rel="noreferrer">http://localhost:9200</a>，测试返回结果，返回结果如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#DC3EB7;">&quot;name&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;DESKTOP-LNJQ0VF&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#DC3EB7;">&quot;cluster_name&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;elasticsearch&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#DC3EB7;">&quot;cluster_uuid&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;nCZqBhfdT1-pw8Yas4QU9w&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#DC3EB7;">&quot;version&quot;</span><span style="color:#002339;"> : {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;number&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;7.8.0&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;build_flavor&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;default&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;build_type&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;zip&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;build_hash&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;757314695644ea9a1dc2fecd26d1a43856725e65&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;build_date&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;2020-06-14T19:35:50.234439Z&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;build_snapshot&quot;</span><span style="color:#002339;"> : </span><span style="color:#174781;">false</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;lucene_version&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;8.5.1&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;minimum_wire_compatibility_version&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;6.8.0&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;minimum_index_compatibility_version&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;6.0.0-beta1&quot;</span></span>
<span class="line"><span style="color:#002339;">  },</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#DC3EB7;">&quot;tagline&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;You Know, for Search&quot;</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>Elasticsearch 是<strong>面向文档型数据库</strong>，一条数据在这里就是一个文档。 为了方便大家理解，我们将 Elasticsearch 里存储文档数据和关系型数据库 MySQL 存储数据的概念进行一个类比</p><p><img src="/doc/elk/img-1.png" alt="image.png"><br>ES 里的 Index 可以看做一个库，而 Types 相当于表， Documents 则相当于表的行。这里 Types 的概念已经被逐渐弱化， Elasticsearch 6.X 中，一个 index 下已经只能包含一个type， Elasticsearch 7.X 中, Type 的概念已经被删除了。</p><h4 id="索引-创建" tabindex="-1">索引-创建 <a class="header-anchor" href="#索引-创建" aria-label="Permalink to &quot;索引-创建&quot;">​</a></h4><p>对比关系型数据库，创建索引就等同于创建数据库。<br>在 Postman 中，向 ES 服务器发 PUT 请求 ：** <a href="http://127.0.0.1:9200/shopping" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping</a>**<br>请求后，服务器返回响应：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">&quot;acknowledged&quot;</span><span style="color:#7B30D0;">:</span><span style="color:#002339;"> </span><span style="color:#174781;">true</span><span style="color:#002339;">,</span><span style="color:#357B42;font-style:italic;">//响应结果</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">&quot;shards_acknowledged&quot;</span><span style="color:#7B30D0;">:</span><span style="color:#002339;"> </span><span style="color:#174781;">true</span><span style="color:#002339;">,</span><span style="color:#357B42;font-style:italic;">//分片结果</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">&quot;index&quot;</span><span style="color:#7B30D0;">:</span><span style="color:#002339;"> </span><span style="color:#A44185;">&quot;shopping&quot;</span><span style="color:#357B42;font-style:italic;">//索引名称</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="索引-查询-删除" tabindex="-1">索引-查询 &amp; 删除 <a class="header-anchor" href="#索引-查询-删除" aria-label="Permalink to &quot;索引-查询 &amp; 删除&quot;">​</a></h4><p>查看所有索引，在 Postman 中，向 ES 服务器发 GET 请求 ： <a href="http://127.0.0.1:9200/_cat/indices?v" target="_blank" rel="noreferrer">http://127.0.0.1:9200/_cat/indices?v</a></p><p>这里请求路径中的_cat 表示查看的意思， indices 表示索引，所以整体含义就是查看当前 ES服务器中的所有索引，就好像 MySQL 中的 show tables 的感觉，服务器响应结果如下 :</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">health status index    uuid                   pri rep docs.count docs.deleted store.size pri.store.size</span></span>
<span class="line"><span style="color:#002339;">yellow open   shopping J0WlEhh4R7aDrfIc3AkwWQ   1   1          0            0       208b           208b</span></span></code></pre></div><p><img src="/doc/elk/img-2.png" alt="image.png"></p><h4 id="查看单个索引" tabindex="-1">查看单个索引 <a class="header-anchor" href="#查看单个索引" aria-label="Permalink to &quot;查看单个索引&quot;">​</a></h4><p>GET 请求 ： <a href="http://127.0.0.1:9200/shopping" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping</a><br>返回结果如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;shopping&quot;</span><span style="color:#002339;">: { </span><span style="color:#357B42;font-style:italic;">// 索引名</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;aliases&quot;</span><span style="color:#002339;">: {}, </span><span style="color:#357B42;font-style:italic;">// 别名</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;mappings&quot;</span><span style="color:#002339;">: {}, </span><span style="color:#357B42;font-style:italic;">// 映射</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;settings&quot;</span><span style="color:#002339;">: { </span><span style="color:#357B42;font-style:italic;">// 设置</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;index&quot;</span><span style="color:#002339;">: { </span><span style="color:#357B42;font-style:italic;">// 设置 - 索引</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;creation_date&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;1617861426847&quot;</span><span style="color:#002339;">, </span><span style="color:#357B42;font-style:italic;">// 设置 - 索引 - 创建时间</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;number_of_shards&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;1&quot;</span><span style="color:#002339;">, </span><span style="color:#357B42;font-style:italic;">// 设置 - 索引 - 主分片数量</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;number_of_replicas&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;1&quot;</span><span style="color:#002339;">, </span><span style="color:#357B42;font-style:italic;">// 设置 - 索引 - 主分片数量</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;uuid&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;J0WlEhh4R7aDrfIc3AkwWQ&quot;</span><span style="color:#002339;">, </span><span style="color:#357B42;font-style:italic;">// 设置 - 索引 - 主分片数量</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;version&quot;</span><span style="color:#002339;">: { </span><span style="color:#357B42;font-style:italic;">// 设置 - 索引 - 主分片数量</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;created&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;7080099&quot;</span></span>
<span class="line"><span style="color:#002339;">                },</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;provided_name&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;"> </span><span style="color:#357B42;font-style:italic;">// 设置 - 索引 - 主分片数量</span></span>
<span class="line"><span style="color:#002339;">            }</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="删除索引" tabindex="-1">删除索引 <a class="header-anchor" href="#删除索引" aria-label="Permalink to &quot;删除索引&quot;">​</a></h4><p>DELETE 请求 ： <a href="http://127.0.0.1:9200/shopping" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping</a><br>返回结果如下：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">&quot;acknowledged&quot;</span><span style="color:#7B30D0;">:</span><span style="color:#002339;"> </span><span style="color:#174781;">true</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>再次查看所有索引，GET <a href="http://127.0.0.1:9200/_cat/indices?v" target="_blank" rel="noreferrer">http://127.0.0.1:9200/_cat/indices?v</a> <br>返回结果如下：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">health status index uuid pri rep </span><span style="color:#2F86D2;">docs</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">count</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">docs</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">deleted</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">store</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">size</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">pri</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">store</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">size</span></span></code></pre></div><p>成功删除</p><h4 id="文档-创建-put-post" tabindex="-1">文档-创建（Put &amp; Post） <a class="header-anchor" href="#文档-创建-put-post" aria-label="Permalink to &quot;文档-创建（Put &amp; Post）&quot;">​</a></h4><p>POST 请求 ： <a href="http://127.0.0.1:9200/shopping/_doc" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_doc</a> <br>请求体JSON内容为：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">3999.00</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>注意，此处发送请求的方式必须为 POST，不能是 PUT，否则会发生错误 。<br>返回结果：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span><span style="color:#357B42;font-style:italic;">//索引</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span><span style="color:#357B42;font-style:italic;">//类型-文档</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;ANQqsHgBaKNfVnMbhZYU&quot;</span><span style="color:#002339;">,</span><span style="color:#357B42;font-style:italic;">//唯一标识，可以类比为 MySQL 中的主键，随机生成</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_version&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span><span style="color:#357B42;font-style:italic;">//版本</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;result&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;created&quot;</span><span style="color:#002339;">,</span><span style="color:#357B42;font-style:italic;">//结果，这里的 create 表示创建成功</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_shards&quot;</span><span style="color:#002339;">: {</span><span style="color:#357B42;font-style:italic;">//</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;total&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">2</span><span style="color:#002339;">,</span><span style="color:#357B42;font-style:italic;">//分片 - 总数</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;successful&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span><span style="color:#357B42;font-style:italic;">//分片 - 总数</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;failed&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#357B42;font-style:italic;">//分片 - 总数</span></span>
<span class="line"><span style="color:#002339;">    },</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_seq_no&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_primary_term&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>上面的数据创建后，由于没有指定数据唯一性标识（ID），默认情况下， ES 服务器会随机生成一个。如果想要自定义唯一性标识，需要在创建时指定<br> POST 请求 ：<a href="http://127.0.0.1:9200/shopping/_doc/1" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_doc/1</a> <br>请求体JSON内容为：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;小米手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;小米&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">:</span><span style="color:#174781;">3999.00</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意</p><p>如果增加数据时明确数据主键，那么请求方式也可以为 PUT。</p></div><p>返回结果如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;1&quot;</span><span style="color:#002339;">,</span><span style="color:#357B42;font-style:italic;">//&lt;------------------自定义唯一性标识</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_version&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;result&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;created&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_shards&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;total&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">2</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;successful&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;failed&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span></span>
<span class="line"><span style="color:#002339;">    },</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_seq_no&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_primary_term&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="查询-主键查询-全查询" tabindex="-1">查询-主键查询 &amp; 全查询 <a class="header-anchor" href="#查询-主键查询-全查询" aria-label="Permalink to &quot;查询-主键查询 &amp; 全查询&quot;">​</a></h4><p>GET 请求 ： <a href="http://127.0.0.1:9200/shopping/_doc/1" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_doc/1</a> <br>返回结果如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;1&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_version&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_seq_no&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_primary_term&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;found&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">true</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">3999</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>查找不存在的内容，向 ES 服务器发 GET 请求 ： <a href="http://127.0.0.1:9200/shopping/_doc/1001" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_doc/1001</a><br>返回结果如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;1001&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;found&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">false</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>查看索引下所有数据，向 ES 服务器发 GET 请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a><br>返回结果如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;took&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">133</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;timed_out&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">false</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_shards&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;total&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;successful&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;skipped&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;failed&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span></span>
<span class="line"><span style="color:#002339;">    },</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;hits&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;total&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;value&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">2</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;relation&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;eq&quot;</span></span>
<span class="line"><span style="color:#002339;">        },</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;max_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;hits&quot;</span><span style="color:#002339;">: [</span></span>
<span class="line"><span style="color:#002339;">            {</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;ANQqsHgBaKNfVnMbhZYU&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">3999</span></span>
<span class="line"><span style="color:#002339;">                }</span></span>
<span class="line"><span style="color:#002339;">            },</span></span>
<span class="line"><span style="color:#002339;">            {</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;1&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">3999</span></span>
<span class="line"><span style="color:#002339;">                }</span></span>
<span class="line"><span style="color:#002339;">            }</span></span>
<span class="line"><span style="color:#002339;">        ]</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="全量修改" tabindex="-1">全量修改 <a class="header-anchor" href="#全量修改" aria-label="Permalink to &quot;全量修改&quot;">​</a></h4><p>POST 请求 ： <a href="http://127.0.0.1:9200/shopping/_doc/1" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_doc/1</a><br>请求体JSON内容为:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;华为手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;华为&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/hw.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">:</span><span style="color:#174781;">1999.00</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>修改成功后，服务器响应结果：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;1&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_version&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">2</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;result&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;updated&quot;</span><span style="color:#002339;">,</span><span style="color:#357B42;font-style:italic;">//&lt;-----------updated 表示数据被更新</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_shards&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;total&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">2</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;successful&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;failed&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span></span>
<span class="line"><span style="color:#002339;">    },</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_seq_no&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">2</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_primary_term&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="局部修改" tabindex="-1">局部修改 <a class="header-anchor" href="#局部修改" aria-label="Permalink to &quot;局部修改&quot;">​</a></h4><p>POST 请求 ： <a href="http://127.0.0.1:9200/shopping/_update/1" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_update/1</a><br>请求体JSON内容为:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;doc&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;小米手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;小米&quot;</span></span>
<span class="line"><span style="color:#002339;">	}</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>返回结果如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;1&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_version&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">3</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;result&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;updated&quot;</span><span style="color:#002339;">,</span><span style="color:#357B42;font-style:italic;">//&lt;-----------updated 表示数据被更新</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_shards&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;total&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">2</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;successful&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;failed&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span></span>
<span class="line"><span style="color:#002339;">    },</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_seq_no&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">3</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_primary_term&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_doc/1" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_doc/1</a> <br>查看修改内容：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;1&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_version&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">3</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_seq_no&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">3</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_primary_term&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;found&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">true</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/hw.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1999</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="删除" tabindex="-1">删除 <a class="header-anchor" href="#删除" aria-label="Permalink to &quot;删除&quot;">​</a></h4><p>DELETE 请求 ： <a href="http://127.0.0.1:9200/shopping/_doc/1" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_doc/1</a><br>返回结果：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;1&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_version&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">4</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;result&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;deleted&quot;</span><span style="color:#002339;">,</span><span style="color:#357B42;font-style:italic;">//&lt;---删除成功</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_shards&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;total&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">2</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;successful&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;failed&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span></span>
<span class="line"><span style="color:#002339;">    },</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_seq_no&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">4</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_primary_term&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>向 ES 服务器发 GET请求 ： <a href="http://127.0.0.1:9200/shopping/_doc/1" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_doc/1</a> <br>查看是否删除成功：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;1&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;found&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">false</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="条件查询" tabindex="-1">条件查询 <a class="header-anchor" href="#条件查询" aria-label="Permalink to &quot;条件查询&quot;">​</a></h4><p>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;took&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">5</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;timed_out&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">false</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_shards&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;total&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;successful&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;skipped&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;failed&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span></span>
<span class="line"><span style="color:#002339;">    },</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;hits&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;total&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;value&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">6</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;relation&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;eq&quot;</span></span>
<span class="line"><span style="color:#002339;">        },</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;max_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;hits&quot;</span><span style="color:#002339;">: [</span></span>
<span class="line"><span style="color:#002339;">            {</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;ANQqsHgBaKNfVnMbhZYU&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">3999</span></span>
<span class="line"><span style="color:#002339;">                }</span></span>
<span class="line"><span style="color:#002339;">            },</span></span>
<span class="line"><span style="color:#002339;">            {</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;A9R5sHgBaKNfVnMb25Ya&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1999</span></span>
<span class="line"><span style="color:#002339;">                }</span></span>
<span class="line"><span style="color:#002339;">            },</span></span>
<span class="line"><span style="color:#002339;">            {</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;BNR5sHgBaKNfVnMb7pal&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1999</span></span>
<span class="line"><span style="color:#002339;">                }</span></span>
<span class="line"><span style="color:#002339;">            },</span></span>
<span class="line"><span style="color:#002339;">            {</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;BtR6sHgBaKNfVnMbX5Y5&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;华为手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;华为&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1999</span></span>
<span class="line"><span style="color:#002339;">                }</span></span>
<span class="line"><span style="color:#002339;">            },</span></span>
<span class="line"><span style="color:#002339;">            {</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;B9R6sHgBaKNfVnMbZpZ6&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;华为手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;华为&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1999</span></span>
<span class="line"><span style="color:#002339;">                }</span></span>
<span class="line"><span style="color:#002339;">            },</span></span>
<span class="line"><span style="color:#002339;">            {</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;CdR7sHgBaKNfVnMbsJb9&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;华为手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;华为&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1999</span></span>
<span class="line"><span style="color:#002339;">                }</span></span>
<span class="line"><span style="color:#002339;">            }</span></span>
<span class="line"><span style="color:#002339;">        ]</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="url带参查询" tabindex="-1">URL带参查询 <a class="header-anchor" href="#url带参查询" aria-label="Permalink to &quot;URL带参查询&quot;">​</a></h4><p>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search?q=category:%E5%B0%8F%E7%B1%B3" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search?q=category:小米</a><br>返回结果如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;took&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">94</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;timed_out&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">false</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;_shards&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;total&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;successful&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;skipped&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;failed&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span></span>
<span class="line"><span style="color:#002339;">    },</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;hits&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;total&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;value&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">3</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;relation&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;eq&quot;</span></span>
<span class="line"><span style="color:#002339;">        },</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;max_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1.3862942</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;hits&quot;</span><span style="color:#002339;">: [</span></span>
<span class="line"><span style="color:#002339;">            {</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;ANQqsHgBaKNfVnMbhZYU&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1.3862942</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">3999</span></span>
<span class="line"><span style="color:#002339;">                }</span></span>
<span class="line"><span style="color:#002339;">            },</span></span>
<span class="line"><span style="color:#002339;">            {</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;A9R5sHgBaKNfVnMb25Ya&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1.3862942</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1999</span></span>
<span class="line"><span style="color:#002339;">                }</span></span>
<span class="line"><span style="color:#002339;">            },</span></span>
<span class="line"><span style="color:#002339;">            {</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_index&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;shopping&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;_doc&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_id&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;BNR5sHgBaKNfVnMb7pal&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_score&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1.3862942</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;title&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米手机&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;小米&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;images&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;http://www.gulixueyuan.com/xm.jpg&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">1999</span></span>
<span class="line"><span style="color:#002339;">                }</span></span>
<span class="line"><span style="color:#002339;">            }</span></span>
<span class="line"><span style="color:#002339;">        ]</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="请求体带参查询" tabindex="-1">请求体带参查询 <a class="header-anchor" href="#请求体带参查询" aria-label="Permalink to &quot;请求体带参查询&quot;">​</a></h4><p>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a> <br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;query&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;match&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">			</span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;小米&quot;</span></span>
<span class="line"><span style="color:#002339;">		}</span></span>
<span class="line"><span style="color:#002339;">	}</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="带请求体方式的查找所有内容" tabindex="-1">带请求体方式的查找所有内容 <a class="header-anchor" href="#带请求体方式的查找所有内容" aria-label="Permalink to &quot;带请求体方式的查找所有内容&quot;">​</a></h4><p>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a> <br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;query&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;match_all&quot;</span><span style="color:#002339;">:{}</span></span>
<span class="line"><span style="color:#002339;">	}</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="查询指定字段" tabindex="-1">查询指定字段 <a class="header-anchor" href="#查询指定字段" aria-label="Permalink to &quot;查询指定字段&quot;">​</a></h4><p>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a> <br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;query&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;match_all&quot;</span><span style="color:#002339;">:{}</span></span>
<span class="line"><span style="color:#002339;">	},</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;_source&quot;</span><span style="color:#002339;">:[</span><span style="color:#00820F;">&quot;title&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="分页查询" tabindex="-1">分页查询 <a class="header-anchor" href="#分页查询" aria-label="Permalink to &quot;分页查询&quot;">​</a></h4><p>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a> <br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;query&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;match_all&quot;</span><span style="color:#002339;">:{}</span></span>
<span class="line"><span style="color:#002339;">	},</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;from&quot;</span><span style="color:#002339;">:</span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;size&quot;</span><span style="color:#002339;">:</span><span style="color:#174781;">2</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="查询排序" tabindex="-1">查询排序 <a class="header-anchor" href="#查询排序" aria-label="Permalink to &quot;查询排序&quot;">​</a></h4><p>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a> <br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;query&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;match_all&quot;</span><span style="color:#002339;">:{}</span></span>
<span class="line"><span style="color:#002339;">	},</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;sort&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">			</span><span style="color:#DC3EB7;">&quot;order&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;desc&quot;</span></span>
<span class="line"><span style="color:#002339;">		}</span></span>
<span class="line"><span style="color:#002339;">	}</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="多条件查询" tabindex="-1">多条件查询 <a class="header-anchor" href="#多条件查询" aria-label="Permalink to &quot;多条件查询&quot;">​</a></h4><p>假设想找出小米牌子，价格为3999元的。（must相当于数据库的&amp;&amp;）<br>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a> <br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;query&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;bool&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">			</span><span style="color:#DC3EB7;">&quot;must&quot;</span><span style="color:#002339;">:[{</span></span>
<span class="line"><span style="color:#002339;">				</span><span style="color:#DC3EB7;">&quot;match&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">					</span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;小米&quot;</span></span>
<span class="line"><span style="color:#002339;">				}</span></span>
<span class="line"><span style="color:#002339;">			},{</span></span>
<span class="line"><span style="color:#002339;">				</span><span style="color:#DC3EB7;">&quot;match&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">					</span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">:</span><span style="color:#174781;">3999.00</span></span>
<span class="line"><span style="color:#002339;">				}</span></span>
<span class="line"><span style="color:#002339;">			}]</span></span>
<span class="line"><span style="color:#002339;">		}</span></span>
<span class="line"><span style="color:#002339;">	}</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>假设想找出小米和华为的牌子。（should相当于数据库的||）<br>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a> <br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;query&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;bool&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">			</span><span style="color:#DC3EB7;">&quot;should&quot;</span><span style="color:#002339;">:[{</span></span>
<span class="line"><span style="color:#002339;">				</span><span style="color:#DC3EB7;">&quot;match&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">					</span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;小米&quot;</span></span>
<span class="line"><span style="color:#002339;">				}</span></span>
<span class="line"><span style="color:#002339;">			},{</span></span>
<span class="line"><span style="color:#002339;">				</span><span style="color:#DC3EB7;">&quot;match&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">					</span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;华为&quot;</span></span>
<span class="line"><span style="color:#002339;">				}</span></span>
<span class="line"><span style="color:#002339;">			}]</span></span>
<span class="line"><span style="color:#002339;">		},</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;filter&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;range&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;gt&quot;</span><span style="color:#002339;">:</span><span style="color:#174781;">2000</span></span>
<span class="line"><span style="color:#002339;">                }</span></span>
<span class="line"><span style="color:#002339;">            }</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">	}</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="范围查询" tabindex="-1">范围查询 <a class="header-anchor" href="#范围查询" aria-label="Permalink to &quot;范围查询&quot;">​</a></h4><p>假设想找出小米和华为的牌子，价格大于2000元的手机。<br>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a> <br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;query&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;bool&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">			</span><span style="color:#DC3EB7;">&quot;should&quot;</span><span style="color:#002339;">:[{</span></span>
<span class="line"><span style="color:#002339;">				</span><span style="color:#DC3EB7;">&quot;match&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">					</span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;小米&quot;</span></span>
<span class="line"><span style="color:#002339;">				}</span></span>
<span class="line"><span style="color:#002339;">			},{</span></span>
<span class="line"><span style="color:#002339;">				</span><span style="color:#DC3EB7;">&quot;match&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">					</span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;华为&quot;</span></span>
<span class="line"><span style="color:#002339;">				}</span></span>
<span class="line"><span style="color:#002339;">			}],</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;filter&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">            	</span><span style="color:#DC3EB7;">&quot;range&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">                	</span><span style="color:#DC3EB7;">&quot;price&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">                    	</span><span style="color:#DC3EB7;">&quot;gt&quot;</span><span style="color:#002339;">:</span><span style="color:#174781;">2000</span></span>
<span class="line"><span style="color:#002339;">                	}</span></span>
<span class="line"><span style="color:#002339;">	            }</span></span>
<span class="line"><span style="color:#002339;">    	    }</span></span>
<span class="line"><span style="color:#002339;">		}</span></span>
<span class="line"><span style="color:#002339;">	}</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="全文检索" tabindex="-1">全文检索 <a class="header-anchor" href="#全文检索" aria-label="Permalink to &quot;全文检索&quot;">​</a></h4><p>这功能像搜索引擎那样，如品牌输入“小华”，返回结果带回品牌有“小米”和华为的。<br>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a> <br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;query&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;match&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">			</span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;小华&quot;</span></span>
<span class="line"><span style="color:#002339;">		}</span></span>
<span class="line"><span style="color:#002339;">	}</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="完全匹配" tabindex="-1">完全匹配 <a class="header-anchor" href="#完全匹配" aria-label="Permalink to &quot;完全匹配&quot;">​</a></h4><p>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a> <br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;query&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;match_phrase&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">			</span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;为&quot;</span></span>
<span class="line"><span style="color:#002339;">		}</span></span>
<span class="line"><span style="color:#002339;">	}</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="高亮查询" tabindex="-1">高亮查询 <a class="header-anchor" href="#高亮查询" aria-label="Permalink to &quot;高亮查询&quot;">​</a></h4><p>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a> <br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;query&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;match_phrase&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">			</span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;"> : </span><span style="color:#00820F;">&quot;为&quot;</span></span>
<span class="line"><span style="color:#002339;">		}</span></span>
<span class="line"><span style="color:#002339;">	},</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;highlight&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;fields&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;category&quot;</span><span style="color:#002339;">:{}</span><span style="color:#357B42;font-style:italic;">//&lt;----高亮这字段</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="聚合查询" tabindex="-1">聚合查询 <a class="header-anchor" href="#聚合查询" aria-label="Permalink to &quot;聚合查询&quot;">​</a></h4><p>聚合允许使用者对 es 文档进行统计分析，类似与关系型数据库中的 group by，当然还有很多其他的聚合，例如取最大值max、平均值avg等等。</p><p>接下来按price字段进行分组：<br>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a><br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;aggs&quot;</span><span style="color:#002339;">:{</span><span style="color:#357B42;font-style:italic;">//聚合操作</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;price_group&quot;</span><span style="color:#002339;">:{</span><span style="color:#357B42;font-style:italic;">//名称，随意起名</span></span>
<span class="line"><span style="color:#002339;">			</span><span style="color:#DC3EB7;">&quot;terms&quot;</span><span style="color:#002339;">:{</span><span style="color:#357B42;font-style:italic;">//分组</span></span>
<span class="line"><span style="color:#002339;">				</span><span style="color:#DC3EB7;">&quot;field&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;price&quot;</span><span style="color:#357B42;font-style:italic;">//分组字段</span></span>
<span class="line"><span style="color:#002339;">			}</span></span>
<span class="line"><span style="color:#002339;">		}</span></span>
<span class="line"><span style="color:#002339;">	}</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>上面返回结果会附带原始数据的。若不想要不附带原始数据的结果<br> ES 服务器发 GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a><br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;aggs&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;price_group&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">			</span><span style="color:#DC3EB7;">&quot;terms&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">				</span><span style="color:#DC3EB7;">&quot;field&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;price&quot;</span></span>
<span class="line"><span style="color:#002339;">			}</span></span>
<span class="line"><span style="color:#002339;">		}</span></span>
<span class="line"><span style="color:#002339;">	},</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;size&quot;</span><span style="color:#002339;">:</span><span style="color:#174781;">0</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>若想对所有手机价格求平均值<br>GET请求 ： <a href="http://127.0.0.1:9200/shopping/_search" target="_blank" rel="noreferrer">http://127.0.0.1:9200/shopping/_search</a><br>附带JSON体如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;aggs&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;price_avg&quot;</span><span style="color:#002339;">:{</span><span style="color:#357B42;font-style:italic;">//名称，随意起名</span></span>
<span class="line"><span style="color:#002339;">			</span><span style="color:#DC3EB7;">&quot;avg&quot;</span><span style="color:#002339;">:{</span><span style="color:#357B42;font-style:italic;">//求平均</span></span>
<span class="line"><span style="color:#002339;">				</span><span style="color:#DC3EB7;">&quot;field&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;price&quot;</span></span>
<span class="line"><span style="color:#002339;">			}</span></span>
<span class="line"><span style="color:#002339;">		}</span></span>
<span class="line"><span style="color:#002339;">	},</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;size&quot;</span><span style="color:#002339;">:</span><span style="color:#174781;">0</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="映射关系" tabindex="-1">映射关系 <a class="header-anchor" href="#映射关系" aria-label="Permalink to &quot;映射关系&quot;">​</a></h4><p>有了索引库，等于有了数据库中的 database。</p><p>接下来就需要建索引库(index)中的映射了，类似于数据库(database)中的表结构(table)。</p><p>创建数据库表需要设置字段名称，类型，长度，约束等；索引库也一样，需要知道这个类型下有哪些字段，每个字段有哪些约束信息，这就叫做映射(mapping)</p><p>先创建一个索引：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;"># PUT http://127.0.0.1:9200/user</span></span></code></pre></div><p>创建映射</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">//  PUT http://127.0.0.1:9200/user/_mapping</span></span>
<span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;properties&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;name&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;text&quot;</span><span style="color:#002339;">, </span><span style="color:#357B42;font-style:italic;">// 允许分词</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;index&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">true</span></span>
<span class="line"><span style="color:#002339;">        },</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;sex&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;keyword&quot;</span><span style="color:#002339;">, </span><span style="color:#357B42;font-style:italic;">// 关键字无法分开必须完全匹配</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;index&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">true</span></span>
<span class="line"><span style="color:#002339;">        },</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;tel&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;keyword&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;index&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">false</span><span style="color:#002339;">   </span><span style="color:#357B42;font-style:italic;">// 不支持索引查询</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>查询映射</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">#GET http://127.0.0.1:9200/user/_mapping</span></span></code></pre></div><p>返回结果如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;user&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#DC3EB7;">&quot;mappings&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#DC3EB7;">&quot;properties&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;name&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;text&quot;</span></span>
<span class="line"><span style="color:#002339;">                },</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;sex&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;keyword&quot;</span></span>
<span class="line"><span style="color:#002339;">                },</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#DC3EB7;">&quot;tel&quot;</span><span style="color:#002339;">: {</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;type&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;keyword&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#DC3EB7;">&quot;index&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">false</span></span>
<span class="line"><span style="color:#002339;">                }</span></span>
<span class="line"><span style="color:#002339;">            }</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>增加数据</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">// PUT http://127.0.0.1:9200/user/_create/1001</span></span>
<span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;name&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;小米&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;sex&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;男的&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;tel&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;1111&quot;</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>查找name含有”小“数据：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">// GET http://127.0.0.1:9200/user/_search</span></span>
<span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DC3EB7;">&quot;query&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#DC3EB7;">&quot;match&quot;</span><span style="color:#002339;">:{</span></span>
<span class="line"><span style="color:#002339;">			</span><span style="color:#DC3EB7;">&quot;name&quot;</span><span style="color:#002339;">:</span><span style="color:#00820F;">&quot;小&quot;</span></span>
<span class="line"><span style="color:#002339;">		}</span></span>
<span class="line"><span style="color:#002339;">	}</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h3 id="javaapi" tabindex="-1">JavaAPI <a class="header-anchor" href="#javaapi" aria-label="Permalink to &quot;JavaAPI&quot;">​</a></h3><p>添加依赖：</p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">&lt;</span><span style="color:#0444AC;">dependencies</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">    &lt;</span><span style="color:#0444AC;">dependency</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">groupId</span><span style="color:#002339;">&gt;org.elasticsearch&lt;/</span><span style="color:#0444AC;">groupId</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">artifactId</span><span style="color:#002339;">&gt;elasticsearch&lt;/</span><span style="color:#0444AC;">artifactId</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">version</span><span style="color:#002339;">&gt;7.8.0&lt;/</span><span style="color:#0444AC;">version</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">    &lt;/</span><span style="color:#0444AC;">dependency</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#357B42;font-style:italic;">&lt;!-- elasticsearch 的客户端 --&gt;</span></span>
<span class="line"><span style="color:#002339;">    &lt;</span><span style="color:#0444AC;">dependency</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">groupId</span><span style="color:#002339;">&gt;org.elasticsearch.client&lt;/</span><span style="color:#0444AC;">groupId</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">artifactId</span><span style="color:#002339;">&gt;elasticsearch-rest-high-level-client&lt;/</span><span style="color:#0444AC;">artifactId</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">version</span><span style="color:#002339;">&gt;7.8.0&lt;/</span><span style="color:#0444AC;">version</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">    &lt;/</span><span style="color:#0444AC;">dependency</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#357B42;font-style:italic;">&lt;!-- elasticsearch 依赖 2.x 的 log4j --&gt;</span></span>
<span class="line"><span style="color:#002339;">    &lt;</span><span style="color:#0444AC;">dependency</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">groupId</span><span style="color:#002339;">&gt;org.apache.logging.log4j&lt;/</span><span style="color:#0444AC;">groupId</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">artifactId</span><span style="color:#002339;">&gt;log4j-api&lt;/</span><span style="color:#0444AC;">artifactId</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">version</span><span style="color:#002339;">&gt;2.8.2&lt;/</span><span style="color:#0444AC;">version</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">    &lt;/</span><span style="color:#0444AC;">dependency</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">    &lt;</span><span style="color:#0444AC;">dependency</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">groupId</span><span style="color:#002339;">&gt;org.apache.logging.log4j&lt;/</span><span style="color:#0444AC;">groupId</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">artifactId</span><span style="color:#002339;">&gt;log4j-core&lt;/</span><span style="color:#0444AC;">artifactId</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">version</span><span style="color:#002339;">&gt;2.8.2&lt;/</span><span style="color:#0444AC;">version</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">    &lt;/</span><span style="color:#0444AC;">dependency</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">    &lt;</span><span style="color:#0444AC;">dependency</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">groupId</span><span style="color:#002339;">&gt;com.fasterxml.jackson.core&lt;/</span><span style="color:#0444AC;">groupId</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">artifactId</span><span style="color:#002339;">&gt;jackson-databind&lt;/</span><span style="color:#0444AC;">artifactId</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">version</span><span style="color:#002339;">&gt;2.9.9&lt;/</span><span style="color:#0444AC;">version</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">    &lt;/</span><span style="color:#0444AC;">dependency</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#357B42;font-style:italic;">&lt;!-- junit 单元测试 --&gt;</span></span>
<span class="line"><span style="color:#002339;">    &lt;</span><span style="color:#0444AC;">dependency</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">groupId</span><span style="color:#002339;">&gt;junit&lt;/</span><span style="color:#0444AC;">groupId</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">artifactId</span><span style="color:#002339;">&gt;junit&lt;/</span><span style="color:#0444AC;">artifactId</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">        &lt;</span><span style="color:#0444AC;">version</span><span style="color:#002339;">&gt;4.12&lt;/</span><span style="color:#0444AC;">version</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">    &lt;/</span><span style="color:#0444AC;">dependency</span><span style="color:#002339;">&gt;</span></span>
<span class="line"><span style="color:#002339;">&lt;/</span><span style="color:#0444AC;">dependencies</span><span style="color:#002339;">&gt;</span></span></code></pre></div><p>HelloElasticsearch</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">import</span><span style="color:#002339;"> </span><span style="color:#DA5221;">java.io.IOException</span><span style="color:#002339;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">import</span><span style="color:#002339;"> </span><span style="color:#DA5221;">org.apache.http.HttpHost</span><span style="color:#002339;">;</span></span>
<span class="line"><span style="color:#7B30D0;">import</span><span style="color:#002339;"> </span><span style="color:#DA5221;">org.elasticsearch.client.RestClient</span><span style="color:#002339;">;</span></span>
<span class="line"><span style="color:#7B30D0;">import</span><span style="color:#002339;"> </span><span style="color:#DA5221;">org.elasticsearch.client.RestHighLevelClient</span><span style="color:#002339;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">HelloElasticsearch</span><span style="color:#002339;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) </span><span style="color:#DA5221;">throws</span><span style="color:#002339;"> </span><span style="color:#0991B6;">IOException</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#357B42;font-style:italic;">// 创建客户端对象</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#0991B6;">RestHighLevelClient</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">RestHighLevelClient</span><span style="color:#002339;">(</span></span>
<span class="line"><span style="color:#002339;">				</span><span style="color:#2F86D2;">RestClient</span><span style="color:#002339;">.</span><span style="color:#7EB233;">builder</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">HttpHost</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;localhost&quot;</span><span style="color:#002339;">, </span><span style="color:#174781;">9200</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;http&quot;</span><span style="color:#002339;">)));</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//		...</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(client);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#357B42;font-style:italic;">// 关闭客户端连接</span></span>
<span class="line"><span style="color:#002339;">		</span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">close</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">	}</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="索引-创建-1" tabindex="-1">索引-创建 <a class="header-anchor" href="#索引-创建-1" aria-label="Permalink to &quot;索引-创建&quot;">​</a></h4><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">CreateIndex</span><span style="color:#002339;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) </span><span style="color:#DA5221;">throws</span><span style="color:#002339;"> </span><span style="color:#0991B6;">IOException</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 创建客户端对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">RestHighLevelClient</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">RestHighLevelClient</span><span style="color:#002339;">(</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#2F86D2;">RestClient</span><span style="color:#002339;">.</span><span style="color:#7EB233;">builder</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">HttpHost</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;localhost&quot;</span><span style="color:#002339;">, </span><span style="color:#174781;">9200</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;http&quot;</span><span style="color:#002339;">)));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 创建索引 - 请求对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">CreateIndexRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">CreateIndexRequest</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user2&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 发送请求，获取响应</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">CreateIndexResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">indices</span><span style="color:#002339;">().</span><span style="color:#7EB233;">create</span><span style="color:#002339;">(request,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">boolean</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">acknowledged</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">isAcknowledged</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 响应状态</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;操作状态 = &quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> acknowledged);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 关闭客户端连接</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">close</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="索引-查询-删除-1" tabindex="-1">索引-查询 &amp; 删除 <a class="header-anchor" href="#索引-查询-删除-1" aria-label="Permalink to &quot;索引-查询 &amp; 删除&quot;">​</a></h4><p>查询</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">SearchIndex</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) </span><span style="color:#DA5221;">throws</span><span style="color:#002339;"> </span><span style="color:#0991B6;">IOException</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 创建客户端对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">RestHighLevelClient</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">RestHighLevelClient</span><span style="color:#002339;">(</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#2F86D2;">RestClient</span><span style="color:#002339;">.</span><span style="color:#7EB233;">builder</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">HttpHost</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;localhost&quot;</span><span style="color:#002339;">, </span><span style="color:#174781;">9200</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;http&quot;</span><span style="color:#002339;">)));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 查询索引 - 请求对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">GetIndexRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">GetIndexRequest</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user2&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 发送请求，获取响应</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">GetIndexResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">indices</span><span style="color:#002339;">().</span><span style="color:#7EB233;">get</span><span style="color:#002339;">(request,</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;aliases:&quot;</span><span style="color:#7B30D0;">+</span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getAliases</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;mappings:&quot;</span><span style="color:#7B30D0;">+</span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getMappings</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;settings:&quot;</span><span style="color:#7B30D0;">+</span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getSettings</span><span style="color:#002339;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">close</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>删除</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">DeleteIndex</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) </span><span style="color:#DA5221;">throws</span><span style="color:#002339;"> </span><span style="color:#0991B6;">IOException</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">RestHighLevelClient</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">RestHighLevelClient</span><span style="color:#002339;">(</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#2F86D2;">RestClient</span><span style="color:#002339;">.</span><span style="color:#7EB233;">builder</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">HttpHost</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;localhost&quot;</span><span style="color:#002339;">, </span><span style="color:#174781;">9200</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;http&quot;</span><span style="color:#002339;">)));</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 删除索引 - 请求对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">DeleteIndexRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">DeleteIndexRequest</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user2&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 发送请求，获取响应</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">AcknowledgedResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">indices</span><span style="color:#002339;">().</span><span style="color:#7EB233;">delete</span><span style="color:#002339;">(request,</span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 操作结果</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;操作结果 ： &quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">isAcknowledged</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">close</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="文档-新增-修改" tabindex="-1">文档-新增 &amp; 修改 <a class="header-anchor" href="#文档-新增-修改" aria-label="Permalink to &quot;文档-新增 &amp; 修改&quot;">​</a></h4><p>重构 上文由于频繁使用以下连接Elasticsearch和关闭它的代码，于是<strong>个人</strong>对它进行重构。</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">SomeClass</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) </span><span style="color:#DA5221;">throws</span><span style="color:#002339;"> </span><span style="color:#0991B6;">IOException</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">RestHighLevelClient</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">RestHighLevelClient</span><span style="color:#002339;">(</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#2F86D2;">RestClient</span><span style="color:#002339;">.</span><span style="color:#7EB233;">builder</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">HttpHost</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;localhost&quot;</span><span style="color:#002339;">, </span><span style="color:#174781;">9200</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;http&quot;</span><span style="color:#002339;">)));</span></span>
<span class="line"><span style="color:#002339;">		</span></span>
<span class="line"><span style="color:#002339;">        ...</span></span>
<span class="line"><span style="color:#002339;">        </span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">close</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>重构后的代码：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">import</span><span style="color:#002339;"> </span><span style="color:#DA5221;">org.elasticsearch.client.RestHighLevelClient</span><span style="color:#002339;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">interface</span><span style="color:#002339;"> </span><span style="color:#0444AC;">ElasticsearchTask</span><span style="color:#002339;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">doSomething</span><span style="color:#002339;">(</span><span style="color:#0991B6;">RestHighLevelClient</span><span style="color:#002339;"> </span><span style="color:#B1108E;">client</span><span style="color:#002339;">) </span><span style="color:#DA5221;">throws</span><span style="color:#002339;"> </span><span style="color:#0991B6;">Exception</span><span style="color:#002339;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">ConnectElasticsearch</span><span style="color:#002339;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(</span><span style="color:#0991B6;">ElasticsearchTask</span><span style="color:#002339;"> </span><span style="color:#B1108E;">task</span><span style="color:#002339;">){</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 创建客户端对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">RestHighLevelClient</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">RestHighLevelClient</span><span style="color:#002339;">(</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#2F86D2;">RestClient</span><span style="color:#002339;">.</span><span style="color:#7EB233;">builder</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">HttpHost</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;localhost&quot;</span><span style="color:#002339;">, </span><span style="color:#174781;">9200</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;http&quot;</span><span style="color:#002339;">)));</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">try</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">task</span><span style="color:#002339;">.</span><span style="color:#7EB233;">doSomething</span><span style="color:#002339;">(client);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 关闭客户端连接</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">close</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        } </span><span style="color:#7B30D0;">catch</span><span style="color:#002339;"> (</span><span style="color:#0991B6;">Exception</span><span style="color:#002339;"> </span><span style="color:#B1108E;">e</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">e</span><span style="color:#002339;">.</span><span style="color:#7EB233;">printStackTrace</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>接下来，如果想让Elasticsearch完成一些操作，就编写一个lambda式即可。</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">SomeClass</span><span style="color:#002339;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">			</span><span style="color:#357B42;font-style:italic;">//do something</span></span>
<span class="line"><span style="color:#002339;">        });</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>新增</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">InsertDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 新增文档 - 请求对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">IndexRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">IndexRequest</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 设置索引及唯一性标识</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1001&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 创建数据对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">User</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">user</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">User</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">user</span><span style="color:#002339;">.</span><span style="color:#7EB233;">setName</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;zhangsan&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">user</span><span style="color:#002339;">.</span><span style="color:#7EB233;">setAge</span><span style="color:#002339;">(</span><span style="color:#174781;">30</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">user</span><span style="color:#002339;">.</span><span style="color:#7EB233;">setSex</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;男&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">ObjectMapper</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">objectMapper</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">ObjectMapper</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">String</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">productJson</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">objectMapper</span><span style="color:#002339;">.</span><span style="color:#7EB233;">writeValueAsString</span><span style="color:#002339;">(user);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 添加文档数据，数据格式为 JSON 格式</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(productJson, </span><span style="color:#2F86D2;">XContentType</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">JSON</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 客户端发送请求，获取响应对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">IndexResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            3.打印结果信息</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;_index:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getIndex</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;_id:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getId</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;_result:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getResult</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        });</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>修改</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">UpdateDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 修改文档 - 请求对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">UpdateRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">UpdateRequest</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 配置修改参数</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1001&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 设置请求体，对数据进行修改</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">doc</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">XContentType</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">JSON</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;sex&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;女&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 客户端发送请求，获取响应对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">UpdateResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">update</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;_index:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getIndex</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;_id:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getId</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;_result:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getResult</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        });</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="文档-查询-删除" tabindex="-1">文档-查询 &amp; 删除 <a class="header-anchor" href="#文档-查询-删除" aria-label="Permalink to &quot;文档-查询 &amp; 删除&quot;">​</a></h4><p>查询</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">GetDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//1.创建请求对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">GetRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">GetRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1001&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//2.客户端发送请求，获取响应对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">GetResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">get</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            3.打印结果信息</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;_index:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getIndex</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;_type:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getType</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;_id:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getId</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;source:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getSourceAsString</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        });</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>删除</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">DeleteDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//创建请求对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">DeleteRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">DeleteRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1001&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//客户端发送请求，获取响应对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">DeleteResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">delete</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//打印信息</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">toString</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        });</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="文档-批量新增-批量删除" tabindex="-1">文档-批量新增 &amp; 批量删除 <a class="header-anchor" href="#文档-批量新增-批量删除" aria-label="Permalink to &quot;文档-批量新增 &amp; 批量删除&quot;">​</a></h4><p>批量新增</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">BatchInsertDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//创建批量新增请求对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">BulkRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">BulkRequest</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">add</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#7EB233;">IndexRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1001&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">XContentType</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">JSON</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;name&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#A44185;">&quot;zhangsan&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">add</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#7EB233;">IndexRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1002&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">XContentType</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">JSON</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;name&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                            </span><span style="color:#A44185;">&quot;lisi&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">add</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#7EB233;">IndexRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1003&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">XContentType</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">JSON</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;name&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">                    </span><span style="color:#A44185;">&quot;wangwu&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//客户端发送请求，获取响应对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">BulkResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">responses</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">bulk</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//打印结果信息</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;took:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">responses</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTook</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;items:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">responses</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getItems</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        });</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>批量删除</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">BatchDeleteDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//创建批量删除请求对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">BulkRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">BulkRequest</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">add</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">DeleteRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1001&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">add</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">DeleteRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1002&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">add</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">DeleteRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1003&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//客户端发送请求，获取响应对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">BulkResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">responses</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">bulk</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//打印结果信息</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;took:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">responses</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTook</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;items:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">responses</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getItems</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        });</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h4 id="文档-高级查询" tabindex="-1">文档-高级查询 <a class="header-anchor" href="#文档-高级查询" aria-label="Permalink to &quot;文档-高级查询&quot;">​</a></h4><p>全量查询</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">BatchInsertDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//创建批量新增请求对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">BulkRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">BulkRequest</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">add</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">IndexRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1001&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">XContentType</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">JSON</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;name&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;zhangsan&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;age&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;10&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;sex&quot;</span><span style="color:#002339;">,</span><span style="color:#A44185;">&quot;女&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">add</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">IndexRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1002&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">XContentType</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">JSON</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;name&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;lisi&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;age&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;30&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;sex&quot;</span><span style="color:#002339;">,</span><span style="color:#A44185;">&quot;女&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">add</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">IndexRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1003&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">XContentType</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">JSON</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;name&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;wangwu1&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;age&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;40&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;sex&quot;</span><span style="color:#002339;">,</span><span style="color:#A44185;">&quot;男&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">add</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">IndexRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1004&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">XContentType</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">JSON</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;name&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;wangwu2&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;age&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;20&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;sex&quot;</span><span style="color:#002339;">,</span><span style="color:#A44185;">&quot;女&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">add</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">IndexRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1005&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">XContentType</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">JSON</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;name&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;wangwu3&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;age&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;50&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;sex&quot;</span><span style="color:#002339;">,</span><span style="color:#A44185;">&quot;男&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">add</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">IndexRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">index</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">id</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;1006&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">XContentType</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">JSON</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;name&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;wangwu4&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;age&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;20&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;sex&quot;</span><span style="color:#002339;">,</span><span style="color:#A44185;">&quot;男&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//客户端发送请求，获取响应对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">BulkResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">responses</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">bulk</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//打印结果信息</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;took:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">responses</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTook</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;items:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">responses</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getItems</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        });</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>查询所有索引数据</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">QueryDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 创建搜索请求对象</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">SearchRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchRequest</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">indices</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 构建查询的请求体</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">SearchSourceBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchSourceBuilder</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 查询所有数据</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">query</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">QueryBuilders</span><span style="color:#002339;">.</span><span style="color:#7EB233;">matchAllQuery</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(sourceBuilder);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">SearchResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">search</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">// 查询匹配</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">SearchHits</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getHits</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;took:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTook</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;timeout:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">isTimedOut</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;total:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTotalHits</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;MaxScore:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getMaxScore</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;hits========&gt;&gt;&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#7B30D0;">for</span><span style="color:#002339;"> (</span><span style="color:#0991B6;">SearchHit</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hit</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">:</span><span style="color:#002339;"> hits) {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//输出每条查询的结果信息</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">hit</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getSourceAsString</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">            }</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;&lt;&lt;========&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        });</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>条件查询</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">QueryDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#0991B6;">ElasticsearchTask</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">SEARCH_BY_CONDITION</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 创建搜索请求对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchRequest</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">indices</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 构建查询的请求体</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchSourceBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchSourceBuilder</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">query</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">QueryBuilders</span><span style="color:#002339;">.</span><span style="color:#7EB233;">termQuery</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;age&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;30&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(sourceBuilder);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">search</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 查询匹配</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchHits</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getHits</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;took:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTook</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;timeout:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">isTimedOut</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;total:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTotalHits</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;MaxScore:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getMaxScore</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;hits========&gt;&gt;&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">for</span><span style="color:#002339;"> (</span><span style="color:#0991B6;">SearchHit</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hit</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">:</span><span style="color:#002339;"> hits) {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//输出每条查询的结果信息</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">hit</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getSourceAsString</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;&lt;&lt;========&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">    };</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(SEARCH_BY_CONDITION);</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>分页查询</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">QueryDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#0991B6;">ElasticsearchTask</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">SEARCH_BY_PAGING</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 创建搜索请求对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchRequest</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">indices</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 构建查询的请求体</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchSourceBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchSourceBuilder</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">query</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">QueryBuilders</span><span style="color:#002339;">.</span><span style="color:#7EB233;">matchAllQuery</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 分页查询</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 当前页其实索引(第一条数据的顺序号)， from</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">from</span><span style="color:#002339;">(</span><span style="color:#174781;">0</span><span style="color:#002339;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 每页显示多少条 size</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">size</span><span style="color:#002339;">(</span><span style="color:#174781;">2</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(sourceBuilder);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">search</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 查询匹配</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchHits</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getHits</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;took:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTook</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;timeout:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">isTimedOut</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;total:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTotalHits</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;MaxScore:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getMaxScore</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;hits========&gt;&gt;&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">for</span><span style="color:#002339;"> (</span><span style="color:#0991B6;">SearchHit</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hit</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">:</span><span style="color:#002339;"> hits) {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//输出每条查询的结果信息</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">hit</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getSourceAsString</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;&lt;&lt;========&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">    };</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(SEARCH_BY_CONDITION);</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>查询排序</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">QueryDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#0991B6;">ElasticsearchTask</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">SEARCH_WITH_ORDER</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 创建搜索请求对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchRequest</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">indices</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 构建查询的请求体</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchSourceBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchSourceBuilder</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">query</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">QueryBuilders</span><span style="color:#002339;">.</span><span style="color:#7EB233;">matchAllQuery</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 排序</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">sort</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;age&quot;</span><span style="color:#002339;">, </span><span style="color:#2F86D2;">SortOrder</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">ASC</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(sourceBuilder);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">search</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 查询匹配</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchHits</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getHits</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;took:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTook</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;timeout:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">isTimedOut</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;total:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTotalHits</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;MaxScore:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getMaxScore</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;hits========&gt;&gt;&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">for</span><span style="color:#002339;"> (</span><span style="color:#0991B6;">SearchHit</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hit</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">:</span><span style="color:#002339;"> hits) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//输出每条查询的结果信息</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">hit</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getSourceAsString</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;&lt;&lt;========&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(SEARCH_WITH_ORDER);</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>组合查询</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">QueryDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#0991B6;">ElasticsearchTask</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">SEARCH_BY_BOOL_CONDITION</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 创建搜索请求对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchRequest</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">indices</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 构建查询的请求体</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchSourceBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchSourceBuilder</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">BoolQueryBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">boolQueryBuilder</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">QueryBuilders</span><span style="color:#002339;">.</span><span style="color:#7EB233;">boolQuery</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 必须包含</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">boolQueryBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">must</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">QueryBuilders</span><span style="color:#002339;">.</span><span style="color:#7EB233;">matchQuery</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;age&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;30&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 一定不含</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">boolQueryBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">mustNot</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">QueryBuilders</span><span style="color:#002339;">.</span><span style="color:#7EB233;">matchQuery</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;name&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;zhangsan&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 可能包含</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">boolQueryBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">should</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">QueryBuilders</span><span style="color:#002339;">.</span><span style="color:#7EB233;">matchQuery</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;sex&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;男&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">query</span><span style="color:#002339;">(boolQueryBuilder);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(sourceBuilder);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">search</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 查询匹配</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchHits</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getHits</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;took:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTook</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;timeout:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">isTimedOut</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;total:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTotalHits</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;MaxScore:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getMaxScore</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;hits========&gt;&gt;&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">for</span><span style="color:#002339;"> (</span><span style="color:#0991B6;">SearchHit</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hit</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">:</span><span style="color:#002339;"> hits) {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//输出每条查询的结果信息</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">hit</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getSourceAsString</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;&lt;&lt;========&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(SEARCH_BY_BOOL_CONDITION);</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>范围查询</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">QueryDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#0991B6;">ElasticsearchTask</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">SEARCH_BY_RANGE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 创建搜索请求对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchRequest</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">indices</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 构建查询的请求体</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchSourceBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchSourceBuilder</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">RangeQueryBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">rangeQuery</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">QueryBuilders</span><span style="color:#002339;">.</span><span style="color:#7EB233;">rangeQuery</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;age&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 大于等于</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//rangeQuery.gte(&quot;30&quot;);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 小于等于</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">rangeQuery</span><span style="color:#002339;">.</span><span style="color:#7EB233;">lte</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;40&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">query</span><span style="color:#002339;">(rangeQuery);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(sourceBuilder);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">search</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 查询匹配</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchHits</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getHits</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;took:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTook</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;timeout:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">isTimedOut</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;total:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTotalHits</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;MaxScore:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getMaxScore</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;hits========&gt;&gt;&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">for</span><span style="color:#002339;"> (</span><span style="color:#0991B6;">SearchHit</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hit</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">:</span><span style="color:#002339;"> hits) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//输出每条查询的结果信息</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">hit</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getSourceAsString</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;&lt;&lt;========&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(SEARCH_BY_RANGE);</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>模糊查询</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">QueryDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#0991B6;">ElasticsearchTask</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">SEARCH_BY_FUZZY_CONDITION</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 创建搜索请求对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchRequest</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">indices</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 构建查询的请求体</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchSourceBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchSourceBuilder</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">query</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">QueryBuilders</span><span style="color:#002339;">.</span><span style="color:#7EB233;">fuzzyQuery</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;name&quot;</span><span style="color:#002339;">,</span><span style="color:#A44185;">&quot;wangwu&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">fuzziness</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">Fuzziness</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">ONE</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(sourceBuilder);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">search</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 查询匹配</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchHits</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getHits</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;took:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTook</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;timeout:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">isTimedOut</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;total:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTotalHits</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;MaxScore:&quot;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getMaxScore</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;hits========&gt;&gt;&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">for</span><span style="color:#002339;"> (</span><span style="color:#0991B6;">SearchHit</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hit</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">:</span><span style="color:#002339;"> hits) {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//输出每条查询的结果信息</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">hit</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getSourceAsString</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;&lt;&lt;========&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">    };</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">//        ConnectElasticsearch.connect(SEARCH_ALL);</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">//        ConnectElasticsearch.connect(SEARCH_BY_CONDITION);</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">//        ConnectElasticsearch.connect(SEARCH_BY_PAGING);</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">//        ConnectElasticsearch.connect(SEARCH_WITH_ORDER);</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">//        ConnectElasticsearch.connect(SEARCH_BY_BOOL_CONDITION);</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">//        ConnectElasticsearch.connect(SEARCH_BY_RANGE);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(SEARCH_BY_FUZZY_CONDITION);</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>高亮查询</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">QueryDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#0991B6;">ElasticsearchTask</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">SEARCH_WITH_HIGHLIGHT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 高亮查询</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">indices</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//2.创建查询请求体构建器</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchSourceBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchSourceBuilder</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//构建查询方式：高亮查询</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">TermsQueryBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">termsQueryBuilder</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#2F86D2;">QueryBuilders</span><span style="color:#002339;">.</span><span style="color:#7EB233;">termsQuery</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;name&quot;</span><span style="color:#002339;">,</span><span style="color:#A44185;">&quot;zhangsan&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//设置查询方式</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">query</span><span style="color:#002339;">(termsQueryBuilder);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//构建高亮字段</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">HighlightBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">highlightBuilder</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">HighlightBuilder</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">highlightBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">preTags</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;&lt;font color=&#39;red&#39;&gt;&quot;</span><span style="color:#002339;">);</span><span style="color:#357B42;font-style:italic;">//设置标签前缀</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">highlightBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">postTags</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;&lt;/font&gt;&quot;</span><span style="color:#002339;">);</span><span style="color:#357B42;font-style:italic;">//设置标签后缀</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">highlightBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">field</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;name&quot;</span><span style="color:#002339;">);</span><span style="color:#357B42;font-style:italic;">//设置高亮字段</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//设置高亮构建对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">highlighter</span><span style="color:#002339;">(highlightBuilder);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//设置请求体</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(sourceBuilder);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//3.客户端发送请求，获取响应对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">search</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//4.打印响应结果</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchHits</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getHits</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;took::&quot;</span><span style="color:#7B30D0;">+</span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTook</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;time_out::&quot;</span><span style="color:#7B30D0;">+</span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">isTimedOut</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;total::&quot;</span><span style="color:#7B30D0;">+</span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getTotalHits</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;max_score::&quot;</span><span style="color:#7B30D0;">+</span><span style="color:#2F86D2;">hits</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getMaxScore</span><span style="color:#002339;">());</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;hits::::&gt;&gt;&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">for</span><span style="color:#002339;"> (</span><span style="color:#0991B6;">SearchHit</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hit</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">:</span><span style="color:#002339;"> hits) {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">String</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">sourceAsString</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hit</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getSourceAsString</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(sourceAsString);</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//打印高亮结果</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">Map</span><span style="color:#002339;">&lt;</span><span style="color:#0991B6;">String</span><span style="color:#002339;">, </span><span style="color:#0991B6;">HighlightField</span><span style="color:#002339;">&gt; </span><span style="color:#2F86D2;">highlightFields</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hit</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getHighlightFields</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(highlightFields);</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;&lt;&lt;::::&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">    };</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(SEARCH_WITH_HIGHLIGHT);</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>最大值查询</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">QueryDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#0991B6;">ElasticsearchTask</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">SEARCH_WITH_MAX</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 高亮查询</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">indices</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchSourceBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchSourceBuilder</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">aggregation</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">AggregationBuilders</span><span style="color:#002339;">.</span><span style="color:#7EB233;">max</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;maxAge&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">field</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;age&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//设置请求体</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(sourceBuilder);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//3.客户端发送请求，获取响应对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">search</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//4.打印响应结果</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchHits</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getHits</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(response);</span></span>
<span class="line"><span style="color:#002339;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(SEARCH_WITH_MAX);</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p>分组查询</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">QueryDoc</span><span style="color:#002339;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">	</span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#0991B6;">ElasticsearchTask</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">SEARCH_WITH_GROUP</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> client </span><span style="color:#0991B6;">-&gt;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchRequest</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">request</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchRequest</span><span style="color:#002339;">().</span><span style="color:#7EB233;">indices</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;user&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchSourceBuilder</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SearchSourceBuilder</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">sourceBuilder</span><span style="color:#002339;">.</span><span style="color:#7EB233;">aggregation</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">AggregationBuilders</span><span style="color:#002339;">.</span><span style="color:#7EB233;">terms</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;age_groupby&quot;</span><span style="color:#002339;">).</span><span style="color:#7EB233;">field</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;age&quot;</span><span style="color:#002339;">));</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//设置请求体</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">request</span><span style="color:#002339;">.</span><span style="color:#7EB233;">source</span><span style="color:#002339;">(sourceBuilder);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//3.客户端发送请求，获取响应对象</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchResponse</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">client</span><span style="color:#002339;">.</span><span style="color:#7EB233;">search</span><span style="color:#002339;">(request, </span><span style="color:#2F86D2;">RequestOptions</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DEFAULT</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">//4.打印响应结果</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SearchHits</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">hits</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">response</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getHits</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(response);</span></span>
<span class="line"><span style="color:#002339;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">ConnectElasticsearch</span><span style="color:#002339;">.</span><span style="color:#7EB233;">connect</span><span style="color:#002339;">(SEARCH_WITH_GROUP);</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h3 id="elasticsearch环境" tabindex="-1">Elasticsearch环境 <a class="header-anchor" href="#elasticsearch环境" aria-label="Permalink to &quot;Elasticsearch环境&quot;">​</a></h3><p>单台 Elasticsearch 服务器提供服务，往往都有最大的负载能力，超过这个阈值，服务器性能就会大大降低甚至不可用，所以生产环境中，一般都是运行在指定服务器集群中。除了负载能力，单点服务器也存在其他问题：</p><ul><li>单台机器存储容量有限</li><li>单服务器容易出现单点故障，无法实现高可用</li><li>单服务的并发处理能力有限</li><li>配置服务器集群时，集群中节点数量没有限制，大于等于 2 个节点就可以看做是集群了</li><li>般出于高性能及高可用方面来考虑集群中节点数量都是 3 个以上</li></ul><p>总之，集群能提高性能，增加容错</p><div class="info custom-block"><p class="custom-block-title">集群 Cluster</p><p>一个集群就是由一个或多个服务器节点组织在一起，共同持有整个的数据，并一起提供索引和搜索功能。 一个 Elasticsearch 集群有一个唯一的名字标识，这个名字默认就是”elasticsearch”。这个名字是重要的，因为一个节点只能通过指定某个集群的名字，来加入这个集群</p></div><div class="info custom-block"><p class="custom-block-title">节点 Node</p><p>集群中包含很多服务器， 一个节点就是其中的一个服务器。 作为集群的一部分，它存储数据，参与集群的索引和搜索功能</p></div><p>一个节点也是由一个名字来标识的，默认情况下，这个名字是一个随机的漫威漫画角色的名字，这个名字会在启动的时候赋予节点。这个名字对于管理工作来说挺重要的，因为在这个管理过程中，你会去确定网络中的哪些服务器对应于 Elasticsearch 集群中的哪些节点。</p><p>一个节点可以通过配置集群名称的方式来加入一个指定的集群。默认情况下，每个节点都会被安排加入到一个叫做“elasticsearch”的集群中，这意味着，如果你在你的网络中启动了若干个节点，并假定它们能够相互发现彼此，它们将会自动地形成并加入到一个叫做“elasticsearch”的集群中。</p><p>在一个集群里，只要你想，可以拥有任意多个节点。而且，如果当前你的网络中没有运行任何 Elasticsearch 节点，这时启动一个节点，会默认创建并加入一个叫做“elasticsearch”的集群。</p><h4 id="windows集群部署" tabindex="-1">Windows集群部署 <a class="header-anchor" href="#windows集群部署" aria-label="Permalink to &quot;Windows集群部署&quot;">​</a></h4><ul><li>创建 elasticsearch-cluster 文件夹</li><li>创建 elasticsearch-7.8.0-cluster 文件夹，在内部复制三个 elasticsearch 服务</li><li>修改集群文件目录中每个节点的 config/elasticsearch.yml 配置文件</li><li>如果有必要，删除每个节点中的 data 目录中所有内容</li></ul><p><img src="/doc/elk/img-3.png" alt="image.png"></p><p><img src="/doc/elk/img-4.png" alt="image.png"></p><p><img src="/doc/elk/img-5.png" alt="image.png"></p><p>启动集群，分别依次双击执行节点的 <code>bin/elasticsearch.bat</code>, 启动节点服务器（可以编写一个脚本启动），启动后，会自动加入指定名称的集群。</p><p>测试集群，用Postman，查看集群状态<br>GET <a href="http://127.0.0.1:1001/_cluster/health" target="_blank" rel="noreferrer">http://127.0.0.1:1001/_cluster/health</a><br>GET <a href="http://127.0.0.1:1002/_cluster/health" target="_blank" rel="noreferrer">http://127.0.0.1:1002/_cluster/health</a><br>GET <a href="http://127.0.0.1:1003/_cluster/health" target="_blank" rel="noreferrer">http://127.0.0.1:1003/_cluster/health</a></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;cluster_name&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;my-application&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;status&quot;</span><span style="color:#002339;">: </span><span style="color:#00820F;">&quot;green&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;timed_out&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">false</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;number_of_nodes&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">3</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;number_of_data_nodes&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">3</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;active_primary_shards&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;active_shards&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;relocating_shards&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;initializing_shards&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;unassigned_shards&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;delayed_unassigned_shards&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;number_of_pending_tasks&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;number_of_in_flight_fetch&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;task_max_waiting_in_queue_millis&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DC3EB7;">&quot;active_shards_percent_as_number&quot;</span><span style="color:#002339;">: </span><span style="color:#174781;">100.0</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p><code>status</code> 字段指示着当前集群在总体上是否工作正常。它的三种颜色含义如下：</p><ul><li>green：所有的主分片和副本分片都正常运行</li><li>yellow：所有的主分片都正常运行，但不是所有的副本分片都正常运行</li><li>red：有主分片没能正常运行</li></ul><p>用Postman，在一节点增加索引，另一节点获取索引</p><p>向集群中的node-1001节点增加索引：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">#PUT http://127.0.0.1:1001/user</span></span></code></pre></div><p>向集群中的node-1003节点获取索引：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">#GET http://127.0.0.1:1003/user</span></span></code></pre></div><p>如果在1003创建索引，同样在1001也能获取索引信息，这就是集群能力</p><h4 id="环境-linux单节点部署" tabindex="-1">环境-Linux单节点部署 <a class="header-anchor" href="#环境-linux单节点部署" aria-label="Permalink to &quot;环境-Linux单节点部署&quot;">​</a></h4><blockquote><p><a href="https://www.elastic.co/cn/downloads/past-releases/elasticsearch-7-8-0" target="_blank" rel="noreferrer">下载连接</a></p></blockquote><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;"># 解压缩</span></span>
<span class="line"><span style="color:#7EB233;">tar</span><span style="color:#002339;"> </span><span style="color:#174781;">-zxvf</span><span style="color:#002339;"> </span><span style="color:#A44185;">elasticsearch-7.8.0-linux-x86_64.tar.gz</span><span style="color:#002339;"> </span><span style="color:#174781;">-C</span><span style="color:#002339;"> </span><span style="color:#A44185;">/opt/module</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 改名</span></span>
<span class="line"><span style="color:#7EB233;">mv</span><span style="color:#002339;"> </span><span style="color:#A44185;">elasticsearch-7.8.0</span><span style="color:#002339;"> </span><span style="color:#A44185;">es</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7EB233;">useradd</span><span style="color:#002339;"> </span><span style="color:#A44185;">es</span><span style="color:#002339;"> </span><span style="color:#357B42;font-style:italic;"># 新增 es 用户</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7EB233;">passwd</span><span style="color:#002339;"> </span><span style="color:#A44185;">es</span><span style="color:#002339;"> </span><span style="color:#357B42;font-style:italic;"># 为 es 用户设置密码</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7EB233;">userdel</span><span style="color:#002339;"> </span><span style="color:#174781;">-r</span><span style="color:#002339;"> </span><span style="color:#A44185;">es</span><span style="color:#002339;"> </span><span style="color:#357B42;font-style:italic;"># 如果错了，可以删除再加</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7EB233;">chown</span><span style="color:#002339;"> </span><span style="color:#174781;">-R</span><span style="color:#002339;"> </span><span style="color:#A44185;">es:es</span><span style="color:#002339;"> </span><span style="color:#A44185;">/opt/module/es</span><span style="color:#002339;"> </span><span style="color:#357B42;font-style:italic;"># 文件夹所有者</span></span></code></pre></div><p>修改 <code>/opt/module/es/config/elasticsearch.yml</code> 文件</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;"># 加入如下配置</span></span>
<span class="line"><span style="color:#0444AC;">cluster.name</span><span style="color:#002339;">: </span><span style="color:#A44185;">elasticsearch</span></span>
<span class="line"><span style="color:#0444AC;">node.name</span><span style="color:#002339;">: </span><span style="color:#A44185;">node-1</span></span>
<span class="line"><span style="color:#0444AC;">network.host</span><span style="color:#002339;">: </span><span style="color:#174781;">0.0.0.0</span></span>
<span class="line"><span style="color:#0444AC;">http.port</span><span style="color:#002339;">: </span><span style="color:#174781;">9200</span></span>
<span class="line"><span style="color:#0444AC;">cluster.initial_master_nodes</span><span style="color:#002339;">: [</span><span style="color:#A44185;">&quot;node-1&quot;</span><span style="color:#002339;">]</span></span></code></pre></div><p>修改 <code>/etc/security/limits.conf</code></p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;"># 在文件末尾中增加下面内容</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 每个进程可以打开的文件数的限制</span></span>
<span class="line"><span style="color:#A44185;">es soft nofile 65536</span></span>
<span class="line"><span style="color:#A44185;">es hard nofile 65536</span></span></code></pre></div><p>修改 <code>/etc/security/limits.d/20-nproc.conf</code></p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;"># 在文件末尾中增加下面内容</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 每个进程可以打开的文件数的限制</span></span>
<span class="line"><span style="color:#A44185;">es soft nofile 65536</span></span>
<span class="line"><span style="color:#A44185;">es hard nofile 65536</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 操作系统级别对每个用户创建的进程数的限制</span></span>
<span class="line"><span style="color:#002339;">* </span><span style="color:#A44185;">hard nproc 4096</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 注： * 带表 Linux 所有用户名称</span></span></code></pre></div><p>修改<code>/etc/sysctl.conf</code></p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;"># 在文件中增加下面内容</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 一个进程可以拥有的 VMA(虚拟内存区域)的数量,默认值为 65536</span></span>
<span class="line"><span style="color:#A44185;">vm.max_map_count=655360</span></span></code></pre></div><p>重新加载</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7EB233;">sysctl</span><span style="color:#002339;"> </span><span style="color:#174781;">-p</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 使用 ES 用户启动</span></span>
<span class="line"><span style="color:#1AB394;">cd</span><span style="color:#002339;"> </span><span style="color:#A44185;">/opt/module/es/</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">#启动</span></span>
<span class="line"><span style="color:#7EB233;">bin/elasticsearch</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">#后台启动</span></span>
<span class="line"><span style="color:#7EB233;">bin/elasticsearch</span><span style="color:#002339;"> </span><span style="color:#174781;">-d</span></span></code></pre></div><p>启动时，会动态生成文件，如果文件所属用户不匹配，会发生错误，需要重新进行修改用户和用户组</p><p><img src="/doc/elk/img-6.png" alt="image.png"></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;"># 暂时关闭防火墙</span></span>
<span class="line"><span style="color:#7EB233;">systemctl</span><span style="color:#002339;"> </span><span style="color:#A44185;">stop</span><span style="color:#002339;"> </span><span style="color:#A44185;">firewalld</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 永久关闭防火墙</span></span>
<span class="line"><span style="color:#7EB233;">systemctl</span><span style="color:#002339;"> </span><span style="color:#A44185;">enable</span><span style="color:#002339;"> </span><span style="color:#A44185;">firewalld.service</span><span style="color:#002339;"> </span><span style="color:#357B42;font-style:italic;"># 打开防火墙永久性生效，重启后不会复原</span></span>
<span class="line"><span style="color:#7EB233;">systemctl</span><span style="color:#002339;"> </span><span style="color:#A44185;">disable</span><span style="color:#002339;"> </span><span style="color:#A44185;">firewalld.service</span><span style="color:#002339;"> </span><span style="color:#357B42;font-style:italic;"># 关闭防火墙，永久性生效，重启后不会复原</span></span></code></pre></div><p>测试软件 浏览器中输入地址： <a href="http://linux1:9200/" target="_blank" rel="noreferrer">http://linux1:9200/</a><img src="/doc/elk/img-7.png" alt="image.png"></p><h2 id="elk-stack" tabindex="-1">ELK Stack <a class="header-anchor" href="#elk-stack" aria-label="Permalink to &quot;ELK Stack&quot;">​</a></h2><p><img src="/doc/elk/img-8.png" alt="image.png"></p><ul><li>Input: 输入，输出数据可以是stdin，File，TCP，Redis，Syslog等</li><li>Filter: 过滤，将日志格式化，有丰富的过滤插件，Grok正则捕获，Date日期处理，JSON解码，Mutate数据修改</li><li>Output：输出，输出目标可以是Stdin，File，TCP，Redis，ES等</li></ul><h3 id="elasticsearch-head-插件" tabindex="-1">Elasticsearch-Head 插件 <a class="header-anchor" href="#elasticsearch-head-插件" aria-label="Permalink to &quot;Elasticsearch-Head 插件&quot;">​</a></h3><blockquote><p><a href="https://github.com/mobz/elasticsearch-head/releases" target="_blank" rel="noreferrer">下载</a></p></blockquote><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7EB233;">npm</span><span style="color:#002339;"> </span><span style="color:#A44185;">install</span></span>
<span class="line"><span style="color:#7EB233;">npm</span><span style="color:#002339;"> </span><span style="color:#A44185;">run</span><span style="color:#002339;"> </span><span style="color:#A44185;">start</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">#  http://localhost:9100/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 修改es的yml文件</span></span>
<span class="line"><span style="color:#7EB233;">http.cors.enabled:</span><span style="color:#002339;"> </span><span style="color:#174781;">true</span></span>
<span class="line"><span style="color:#7EB233;">http.cors.allow-origin:</span><span style="color:#002339;"> </span><span style="color:#A44185;">&quot;*&quot;</span></span></code></pre></div><h3 id="logstash" tabindex="-1">Logstash <a class="header-anchor" href="#logstash" aria-label="Permalink to &quot;Logstash&quot;">​</a></h3><blockquote><p><a href="https://elasticsearch.cn/download/#seg-3" target="_blank" rel="noreferrer">下载</a></p></blockquote><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">beats</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">port</span><span style="color:#002339;"> =&gt; 5044</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">output</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">elasticsearch</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">hosts</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;http://localhost:9200&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">   </span><span style="color:#7B30D0;"> index </span><span style="color:#002339;">=&gt; </span><span style="color:#A44185;">&quot;%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7EB233;">logstash</span><span style="color:#002339;"> </span><span style="color:#174781;">-f</span><span style="color:#002339;"> </span><span style="color:#A44185;">logstash.conf</span></span></code></pre></div><h3 id="input插件" tabindex="-1">Input插件 <a class="header-anchor" href="#input插件" aria-label="Permalink to &quot;Input插件&quot;">​</a></h3><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">stdin</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">output</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">stdout</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">codec</span><span style="color:#002339;"> =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">file</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">path</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;/var/log/message&quot;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">tages</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;123&quot;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">type</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;syslog&quot;</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#7B30D0;">output</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">stdout</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">codec</span><span style="color:#002339;"> =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">tcp</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">port</span><span style="color:#002339;"> =&gt; 9200</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">type</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;nc&quot;</span></span>
<span class="line"><span style="color:#002339;">  } </span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#7B30D0;">output</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">stdout</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">codec</span><span style="color:#002339;"> =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">beats</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">port</span><span style="color:#002339;"> =&gt; 5044</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">output</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">stdout</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">codec</span><span style="color:#002339;"> =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h3 id="codec插件" tabindex="-1">Codec插件 <a class="header-anchor" href="#codec插件" aria-label="Permalink to &quot;Codec插件&quot;">​</a></h3><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">stdin</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">codec</span><span style="color:#002339;"> =&gt; json {</span></span>
<span class="line"><span style="color:#002339;">     </span><span style="color:#7B30D0;"> charset </span><span style="color:#002339;">=&gt; [</span><span style="color:#A44185;">&quot;UTF-8&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">output {</span></span>
<span class="line"><span style="color:#002339;">  stdout {</span></span>
<span class="line"><span style="color:#002339;">    codec =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">stdin</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">codec</span><span style="color:#002339;"> =&gt; multiline {</span></span>
<span class="line"><span style="color:#002339;">      // 不是以字符开头的，合并到上一行 正则匹配</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#7B30D0;">pattern</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;^\s&quot;</span></span>
<span class="line"><span style="color:#002339;">      // 合并到上一行还是下一行</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#7B30D0;">what</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;previous&quot;</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">output</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">stdout</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">codec</span><span style="color:#002339;"> =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h3 id="filter" tabindex="-1">Filter <a class="header-anchor" href="#filter" aria-label="Permalink to &quot;Filter&quot;">​</a></h3><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">stdin</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">   </span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"><span style="color:#7B30D0;">filter</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">json</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    // 解析字段</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">source</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;message&quot;</span></span>
<span class="line"><span style="color:#002339;">    // 目标字段</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">target</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;content&quot;</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">output</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">stdout</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">codec</span><span style="color:#002339;"> =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">stdin</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">   </span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"><span style="color:#7B30D0;">filter</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">kv</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    // 根据 &amp; 和 ? 拆分字符串</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">fleld_split</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;&amp;?&quot;</span><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#002339;">    // 使用正则表达式</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">fleld_split_pattern</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;:+&quot;</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">output</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">stdout</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">codec</span><span style="color:#002339;"> =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p><img src="/doc/elk/img-9.png" alt="image.png"></p><blockquote><p><a href="https://download.maxmind.com/app/geoip_download?edition_id=GeoLite2-City&amp;license_key=O38GA2SviPLnqfF5&amp;suffix=tar.gz" target="_blank" rel="noreferrer">GEOIP下载</a> <a href="https://www.maxmind.com/en/accounts/347303/geoip/downloads?show_all_dates=1" target="_blank" rel="noreferrer">官网</a> <a href="https://download.maxmind.com/app/geoip_download?edition_id=GeoLite2-City&amp;license_key=O38GA2SviPLnqfF5&amp;suffix=tar.gz.sha256" target="_blank" rel="noreferrer">校验文件下载</a> <a href="http://grokdebug.herokuapp.com" target="_blank" rel="noreferrer">grok正则</a></p></blockquote><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">stdin</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">   </span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"><span style="color:#7B30D0;">filter</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">gork</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">   </span><span style="color:#7B30D0;"> match </span><span style="color:#002339;">=&gt; {</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#357B42;font-style:italic;"># 正则匹配消息 日志示例： 223.72.85.86 GET /index.html 15824 0.043</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#A44185;">&quot;message&quot;</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;%{IP:client} %{WORD:method} %{URIPATHPARAM:request} %{NUMBER:bytes} %{NUMBER:duration}&quot;</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">  geoip {</span></span>
<span class="line"><span style="color:#002339;">    source =&gt; </span><span style="color:#A44185;">&quot;client&quot;</span></span>
<span class="line"><span style="color:#002339;">    database =&gt; </span><span style="color:#A44185;">&quot;D:\path\ELK\GeoLite2-City_20220503/GeoLite2-City.mmdb&quot;</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">output {</span></span>
<span class="line"><span style="color:#002339;">  stdout {</span></span>
<span class="line"><span style="color:#002339;">    codec =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 自定义匹配方式</span></span>
<span class="line"><span style="color:#002339;">gork {</span></span>
<span class="line"><span style="color:#002339;">    // ID [0-9A-Z]{10,11}</span></span>
<span class="line"><span style="color:#002339;">    patterns_dir =&gt; </span><span style="color:#A44185;">&quot;D:\path\ELK\patterns\id_dir&quot;</span></span>
<span class="line"><span style="color:#002339;">    match =&gt; {</span></span>
<span class="line"><span style="color:#002339;">      // 正则匹配消息 日志示例： 123124452A</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#A44185;">&quot;message&quot;</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;%{ID:id}&quot;</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 匹配多个</span></span>
<span class="line"><span style="color:#002339;">gork {</span></span>
<span class="line"><span style="color:#002339;">    // ID [0-9A-Z]{10,11}</span></span>
<span class="line"><span style="color:#002339;">    patterns_dir =&gt; </span><span style="color:#A44185;">&quot;D:\path\ELK\patterns\id_dir&quot;</span></span>
<span class="line"><span style="color:#002339;">    match =&gt; [</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#A44185;">&quot;message&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;%{IP:client} %{WORD:method}&quot;</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#A44185;">&quot;message&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;%{ID:id}&quot;</span></span>
<span class="line"><span style="color:#002339;">    ]</span></span>
<span class="line"><span style="color:#002339;">  }</span></span></code></pre></div><p><img src="/doc/elk/img-10.png" alt="image.png"><img src="/doc/elk/img-11.png" alt="image.png"><img src="/doc/elk/img-12.png" alt="image.png"></p><h3 id="output插件" tabindex="-1">Output插件 <a class="header-anchor" href="#output插件" aria-label="Permalink to &quot;Output插件&quot;">​</a></h3><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">file</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">path</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;/var/log/messages&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">type</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;system&quot;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">tags</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;syslog&quot;</span><span style="color:#002339;">,</span><span style="color:#A44185;">&quot;test&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">start_position</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;beginning&quot;</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">file</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">path</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;/var/log/audit/audit.log&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">type</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;system&quot;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">tags</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;auth&quot;</span><span style="color:#002339;">,</span><span style="color:#A44185;">&quot;test&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">start_position</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;beginning&quot;</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"><span style="color:#7B30D0;">filter</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">output</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">if</span><span style="color:#002339;"> [type] == </span><span style="color:#A44185;">&quot;system&quot;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">if</span><span style="color:#002339;"> [tages][0] == </span><span style="color:#A44185;">&quot;syslog&quot;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#7B30D0;">elasticsearch</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">         </span><span style="color:#7B30D0;">hosts</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;http://localhost:9200&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;"> index </span><span style="color:#002339;">=&gt; </span><span style="color:#A44185;">&quot;logstash-system-syslog-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">      stdout {</span></span>
<span class="line"><span style="color:#002339;">         codec =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">    else if [tages][0] == </span><span style="color:#A44185;">&quot;auth&quot;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">       elasticsearch {</span></span>
<span class="line"><span style="color:#002339;">         hosts =&gt; [</span><span style="color:#A44185;">&quot;http://localhost:9200&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">         index =&gt; </span><span style="color:#A44185;">&quot;logstash-system-auth-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">      stdout {</span></span>
<span class="line"><span style="color:#002339;">         codec =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h2 id="kibana" tabindex="-1">Kibana <a class="header-anchor" href="#kibana" aria-label="Permalink to &quot;Kibana&quot;">​</a></h2><ul><li>PV/UV</li><li>用户地理位置分布</li><li>URL，HTTP Status，IP TOP10</li></ul><p><img src="/doc/elk/img-23.png" alt="image.png"></p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#0444AC;">i18n.locale</span><span style="color:#002339;">: </span><span style="color:#A44185;">&quot;zh-CN&quot;</span></span></code></pre></div><p><img src="/doc/elk/img-13.png" alt="image.png"> 使用nginx代理kibana</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#0991B6;">http</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0991B6;">server</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">   </span><span style="color:#7B30D0;"> listen </span><span style="color:#002339;">80;</span></span>
<span class="line"><span style="color:#002339;">   </span><span style="color:#7B30D0;"> server_name </span><span style="color:#002339;">localhost;</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#0991B6;">location</span><span style="color:#002339;"> / {</span></span>
<span class="line"><span style="color:#002339;">     </span><span style="color:#7B30D0;"> proxy_pass </span><span style="color:#002339;">http://localhost:5601;</span></span>
<span class="line"><span style="color:#002339;">     </span><span style="color:#7B30D0;"> auth_basic </span><span style="color:#A44185;">&quot;请输入用户名和密码！&quot;</span><span style="color:#002339;">;</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#357B42;font-style:italic;"># 指定用户文件</span></span>
<span class="line"><span style="color:#002339;">     </span><span style="color:#7B30D0;"> auth_basic_user_file </span><span style="color:#002339;">/mydata/nginx/conf/user.db;  </span></span>
<span class="line"><span style="color:#002339;">     </span><span style="color:#7B30D0;"> root </span><span style="color:#002339;">html;</span></span>
<span class="line"><span style="color:#002339;">     </span><span style="color:#7B30D0;"> index </span><span style="color:#002339;">index.html index.htm;</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;"># 生成密文密码</span></span>
<span class="line"><span style="color:#7EB233;">openssl</span><span style="color:#002339;"> </span><span style="color:#A44185;">passwd</span><span style="color:#002339;"> </span><span style="color:#174781;">-crytp</span><span style="color:#002339;"> </span><span style="color:#174781;">123456</span></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;"># 用户名：密码</span></span>
<span class="line"><span style="color:#002339;">fxb: faHgR3X/</span><span style="color:#7B30D0;">qNehA</span></span></code></pre></div><h2 id="redis" tabindex="-1">Redis <a class="header-anchor" href="#redis" aria-label="Permalink to &quot;Redis&quot;">​</a></h2><p><img src="/doc/elk/img-14.png" alt="image.png"></p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">file</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">path</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;/var/log/messages&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">type</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;system&quot;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">tags</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;syslog&quot;</span><span style="color:#002339;">,</span><span style="color:#A44185;">&quot;test&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">start_position</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;beginning&quot;</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">file</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">path</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;/var/log/audit/audit.log&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">type</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;system&quot;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">tags</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;auth&quot;</span><span style="color:#002339;">,</span><span style="color:#A44185;">&quot;test&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">start_position</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;beginning&quot;</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">filter</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">output</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">redis</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">     </span><span style="color:#7B30D0;">host</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;localhost:6379&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">     </span><span style="color:#7B30D0;">password</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#002339;">     </span><span style="color:#7B30D0;">db</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#002339;">     </span><span style="color:#7B30D0;">data_type</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;list&quot;</span></span>
<span class="line"><span style="color:#002339;">     </span><span style="color:#7B30D0;">key</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;logstash&quot;</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">redis</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">host</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;localhost&quot;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">port</span><span style="color:#002339;"> =&gt; 6379</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">password</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">db</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">data_type</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;list&quot;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">key</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;logstash&quot;</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">filter</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">output</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">if</span><span style="color:#002339;"> [type] == </span><span style="color:#A44185;">&quot;system&quot;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">if</span><span style="color:#002339;"> [tages][0] == </span><span style="color:#A44185;">&quot;syslog&quot;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#7B30D0;">elasticsearch</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">hosts</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;http://localhost:9200&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">       </span><span style="color:#7B30D0;"> index </span><span style="color:#002339;">=&gt; </span><span style="color:#A44185;">&quot;logstash-system-syslog-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">      stdout {</span></span>
<span class="line"><span style="color:#002339;">        codec =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">    else if [tages][0] == </span><span style="color:#A44185;">&quot;auth&quot;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">      elasticsearch {</span></span>
<span class="line"><span style="color:#002339;">        hosts =&gt; [</span><span style="color:#A44185;">&quot;http://localhost:9200&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">        index =&gt; </span><span style="color:#A44185;">&quot;logstash-system-auth-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">      stdout {</span></span>
<span class="line"><span style="color:#002339;">        codec =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">      } </span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h2 id="filebeat" tabindex="-1">FileBeat <a class="header-anchor" href="#filebeat" aria-label="Permalink to &quot;FileBeat&quot;">​</a></h2><p><img src="/doc/elk/img-15.png" alt="image.png"></p><blockquote><p><a href="https://www.elastic.co/guide/en/beats/filebeat/7.7/configuration-filebeat-options.html" target="_blank" rel="noreferrer">相关说明</a></p></blockquote><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#0444AC;">filebeat.inputs</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">- </span><span style="color:#0444AC;">type</span><span style="color:#002339;">: </span><span style="color:#A44185;">log</span><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">paths</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">    - </span><span style="color:#A44185;">/var/log/system.log</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">tags</span><span style="color:#002339;">: [</span><span style="color:#A44185;">&quot;syslog&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#0444AC;">fields</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">type</span><span style="color:#002339;">: </span><span style="color:#A44185;">system</span></span>
<span class="line"><span style="color:#0444AC;">fields_under_root</span><span style="color:#002339;">: </span><span style="color:#174781;">true</span></span>
<span class="line"><span style="color:#002339;">- </span><span style="color:#0444AC;">type</span><span style="color:#002339;">: </span><span style="color:#A44185;">log</span><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">paths</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">    - </span><span style="color:#A44185;">/var/log/auth.log</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">tags</span><span style="color:#002339;">: [</span><span style="color:#A44185;">&quot;auth&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#0444AC;">fields</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">type</span><span style="color:#002339;">: </span><span style="color:#A44185;">system</span></span>
<span class="line"><span style="color:#0444AC;">fields_under_root</span><span style="color:#002339;">: </span><span style="color:#174781;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#0444AC;">output.redis</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">hosts</span><span style="color:#002339;">: [</span><span style="color:#A44185;">&quot;localhost:6379&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">password</span><span style="color:#002339;">: </span><span style="color:#A44185;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">key</span><span style="color:#002339;">: </span><span style="color:#A44185;">&quot;filebeat&quot;</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">db</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">timeout</span><span style="color:#002339;">: </span><span style="color:#174781;">5</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">datatype</span><span style="color:#002339;">: </span><span style="color:#A44185;">list</span></span></code></pre></div><h2 id="日志收集" tabindex="-1">日志收集 <a class="header-anchor" href="#日志收集" aria-label="Permalink to &quot;日志收集&quot;">​</a></h2><h3 id="nginx日志收集" tabindex="-1">Nginx日志收集 <a class="header-anchor" href="#nginx日志收集" aria-label="Permalink to &quot;Nginx日志收集&quot;">​</a></h3><p><img src="/doc/elk/img-16.png" alt="image.png"><img src="/doc/elk/img-17.png" alt="image.png"></p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;"># 日志</span></span>
<span class="line"><span style="color:#7B30D0;">error_log </span><span style="color:#002339;"> /var/log/nginx/error.log</span><span style="color:#174781;"> warn</span><span style="color:#002339;">;</span></span>
<span class="line"><span style="color:#7B30D0;">pid </span><span style="color:#002339;">       /var/run/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># http块</span></span>
<span class="line"><span style="color:#0991B6;">http</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#357B42;font-style:italic;"># nginx默认格式  </span></span>
<span class="line"><span style="color:#002339;">   </span><span style="color:#7B30D0;"> log_format </span><span style="color:#174781;"> main</span><span style="color:#002339;">  </span><span style="color:#A44185;">&#39;$</span><span style="color:#2F86D2;">remote_addr</span><span style="color:#A44185;"> - $</span><span style="color:#2F86D2;">remote_user</span><span style="color:#A44185;"> [$</span><span style="color:#2F86D2;">time_local</span><span style="color:#A44185;">] &quot;$</span><span style="color:#2F86D2;">request</span><span style="color:#A44185;">&quot; &#39;</span></span>
<span class="line"><span style="color:#002339;">                      </span><span style="color:#A44185;">&#39;$</span><span style="color:#2F86D2;">status</span><span style="color:#A44185;"> $</span><span style="color:#2F86D2;">body_bytes_sent</span><span style="color:#A44185;"> &quot;$</span><span style="color:#2F86D2;">http_referer</span><span style="color:#A44185;">&quot; &#39;</span></span>
<span class="line"><span style="color:#002339;">                      </span><span style="color:#A44185;">&#39;&quot;$</span><span style="color:#2F86D2;">http_user_agent</span><span style="color:#A44185;">&quot; &quot;$</span><span style="color:#2F86D2;">http_x_forwarded_for</span><span style="color:#A44185;">&quot;&#39;</span><span style="color:#002339;">;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#357B42;font-style:italic;"># 自定义格式</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#357B42;font-style:italic;"># 时间戳 + 远程地址 + 远程用户 + 请求时间 + 状态码 + 请求方法 + 内存大小 + 扩展头部 + 用户代理</span></span>
<span class="line"><span style="color:#002339;">   </span><span style="color:#7B30D0;"> log_format </span><span style="color:#002339;">json </span><span style="color:#A44185;">&#39;{ &quot;@timestamp&quot;: &quot;$</span><span style="color:#2F86D2;">time_iso8601</span><span style="color:#A44185;">&quot;, &#39;</span></span>
<span class="line"><span style="color:#002339;">         </span><span style="color:#A44185;">&#39;&quot;remote_addr&quot;: &quot;$</span><span style="color:#2F86D2;">remote_addr</span><span style="color:#A44185;">&quot;, &#39;</span></span>
<span class="line"><span style="color:#002339;">         </span><span style="color:#A44185;">&#39;&quot;remote_user&quot;: &quot;$</span><span style="color:#2F86D2;">remote_user</span><span style="color:#A44185;">&quot;, &#39;</span></span>
<span class="line"><span style="color:#002339;">         </span><span style="color:#A44185;">&#39;&quot;request_time&quot;: &quot;$</span><span style="color:#2F86D2;">request_time</span><span style="color:#A44185;">&quot;, &#39;</span></span>
<span class="line"><span style="color:#002339;">         </span><span style="color:#A44185;">&#39;&quot;status&quot;: &quot;$</span><span style="color:#2F86D2;">status</span><span style="color:#A44185;">&quot;, &#39;</span></span>
<span class="line"><span style="color:#002339;">         </span><span style="color:#A44185;">&#39;&quot;request_uri&quot;: &quot;$</span><span style="color:#2F86D2;">request_uri</span><span style="color:#A44185;">&quot;, &#39;</span></span>
<span class="line"><span style="color:#002339;">         </span><span style="color:#A44185;">&#39;&quot;request_method&quot;: &quot;$</span><span style="color:#2F86D2;">request_method</span><span style="color:#A44185;">&quot;, &#39;</span></span>
<span class="line"><span style="color:#002339;">         </span><span style="color:#A44185;">&#39;&quot;http_referrer&quot;: &quot;$</span><span style="color:#2F86D2;">http_referer</span><span style="color:#A44185;">&quot;, &#39;</span></span>
<span class="line"><span style="color:#002339;">         </span><span style="color:#A44185;">&#39;&quot;body_bytes_sent&quot;: &quot;$</span><span style="color:#2F86D2;">body_bytes_sent</span><span style="color:#A44185;">&quot;, &#39;</span></span>
<span class="line"><span style="color:#002339;">         </span><span style="color:#A44185;">&#39;&quot;http_x_forwarded_for&quot;: &quot;$</span><span style="color:#2F86D2;">http_x_forwarded_for</span><span style="color:#A44185;">&quot;, &#39;</span></span>
<span class="line"><span style="color:#002339;">         </span><span style="color:#A44185;">&#39;&quot;http_user_agent&quot;: &quot;$</span><span style="color:#2F86D2;">http_user_agent</span><span style="color:#A44185;">&quot;}&#39;</span><span style="color:#002339;">;、</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#002339;">   </span><span style="color:#7B30D0;"> access_log </span><span style="color:#002339;"> /var/log/nginx/access.log  json;</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p><img src="/doc/elk/img-18.png" alt="image.png"></p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#0444AC;">filebeat.inputs</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">- </span><span style="color:#0444AC;">type</span><span style="color:#002339;">: </span><span style="color:#A44185;">log</span><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">paths</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">    - </span><span style="color:#A44185;">/var/log/nginx/access.log</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">tags</span><span style="color:#002339;">: [</span><span style="color:#A44185;">&quot;access&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#0444AC;">fields</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">app</span><span style="color:#002339;">: </span><span style="color:#A44185;">www</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">type</span><span style="color:#002339;">: </span><span style="color:#A44185;">ngxin-access</span></span>
<span class="line"><span style="color:#0444AC;">fields_under_root</span><span style="color:#002339;">: </span><span style="color:#174781;">true</span></span>
<span class="line"><span style="color:#002339;">- </span><span style="color:#0444AC;">type</span><span style="color:#002339;">: </span><span style="color:#A44185;">log</span><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">paths</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">    - </span><span style="color:#A44185;">/var/log/nginx/error.log</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">tags</span><span style="color:#002339;">: [</span><span style="color:#A44185;">&quot;error&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#0444AC;">fields</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">app</span><span style="color:#002339;">: </span><span style="color:#A44185;">www</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">type</span><span style="color:#002339;">: </span><span style="color:#A44185;">ngxin-error</span></span>
<span class="line"><span style="color:#0444AC;">fields_under_root</span><span style="color:#002339;">: </span><span style="color:#174781;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#0444AC;">output.redis</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">hosts</span><span style="color:#002339;">: [</span><span style="color:#A44185;">&quot;localhost:6379&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">password</span><span style="color:#002339;">: </span><span style="color:#A44185;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">key</span><span style="color:#002339;">: </span><span style="color:#A44185;">&quot;filebeat&quot;</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">db</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">timeout</span><span style="color:#002339;">: </span><span style="color:#174781;">5</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">datatype</span><span style="color:#002339;">: </span><span style="color:#A44185;">list</span></span></code></pre></div><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">redis</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">host</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;localhost&quot;</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">port</span><span style="color:#002339;"> =&gt; 6379</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">password</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">db</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">data_type</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;list&quot;</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">key</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;filebeat&quot;</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">filter</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">if</span><span style="color:#002339;"> [app] == </span><span style="color:#A44185;">&quot;www&quot;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">if</span><span style="color:#002339;"> [type] == </span><span style="color:#A44185;">&quot;nginx-access&quot;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#7B30D0;">json</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">          </span><span style="color:#7B30D0;">source</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;message&quot;</span></span>
<span class="line"><span style="color:#002339;">          </span><span style="color:#7B30D0;">remove_field</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;message&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#7B30D0;">geoip</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">          </span><span style="color:#7B30D0;">source</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;remote_addr&quot;</span></span>
<span class="line"><span style="color:#002339;">          </span><span style="color:#7B30D0;">target</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;geoip&quot;</span></span>
<span class="line"><span style="color:#002339;">          </span><span style="color:#7B30D0;">database</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;D:\path\ELK\GeoLite2-City_20220503\GeoLite2-City.mmdb&quot;</span></span>
<span class="line"><span style="color:#002339;">          </span><span style="color:#7B30D0;">add_field</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;[geoip][coordinates]&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;%{[geoip][longitude]}&quot;</span><span style="color:#002339;">] </span></span>
<span class="line"><span style="color:#002339;">          </span><span style="color:#7B30D0;">add_field</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;[geoip][coordinates]&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;%{[geoip][latitude]}&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#7B30D0;">mutate</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">          </span><span style="color:#7B30D0;">convert</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;[geoip][coordinates]&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;float&quot;</span><span style="color:#002339;">]  </span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">output</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">elasticsearch</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#7B30D0;">hosts</span><span style="color:#002339;">  =&gt; [</span><span style="color:#A44185;">&quot;http://localhost:9200&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">     </span><span style="color:#7B30D0;"> index </span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;logstash-%{type}-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">  stdout{codec =&gt; rubydebug }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p><img src="/doc/elk/img-19.png" alt="image.png"></p><h3 id="java堆栈日志收集" tabindex="-1">Java堆栈日志收集 <a class="header-anchor" href="#java堆栈日志收集" aria-label="Permalink to &quot;Java堆栈日志收集&quot;">​</a></h3><p><img src="/doc/elk/img-20.png" alt="image.png"></p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#0444AC;">filebeat.prospectors</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">- </span><span style="color:#0444AC;">type</span><span style="color:#002339;">: </span><span style="color:#A44185;">log</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">paths</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">    - </span><span style="color:#A44185;">/usr/local/tomcat/logs/catalina.out</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">tags</span><span style="color:#002339;">: [</span><span style="color:#A44185;">&quot;tomcat&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">fields</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#0444AC;">app</span><span style="color:#002339;">: </span><span style="color:#A44185;">www</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#0444AC;">type</span><span style="color:#002339;">: </span><span style="color:#A44185;">tomcat-catalina</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">fields_under_root</span><span style="color:#002339;">: </span><span style="color:#174781;">true</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">multiline</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#0444AC;">pattern</span><span style="color:#002339;">: </span><span style="color:#A44185;">&#39;^\[&#39;</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#0444AC;">negate</span><span style="color:#002339;">: </span><span style="color:#174781;">true</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#0444AC;">match</span><span style="color:#002339;">: </span><span style="color:#A44185;">after</span></span>
<span class="line"></span>
<span class="line"><span style="color:#0444AC;">output.redis</span><span style="color:#002339;">:</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">hosts</span><span style="color:#002339;">: [</span><span style="color:#A44185;">&quot;localhost:6379&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">password</span><span style="color:#002339;">: </span><span style="color:#A44185;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">key</span><span style="color:#002339;">: </span><span style="color:#A44185;">&quot;filebeat&quot;</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">db</span><span style="color:#002339;">: </span><span style="color:#174781;">0</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#0444AC;">datatype</span><span style="color:#002339;">: </span><span style="color:#A44185;">list</span></span></code></pre></div><h3 id="定制日志格式收集" tabindex="-1">定制日志格式收集 <a class="header-anchor" href="#定制日志格式收集" aria-label="Permalink to &quot;定制日志格式收集&quot;">​</a></h3><p>ngxin默认的 main 格式日志 <img src="/doc/elk/img-21.png" alt="image.png"><br>使用 Grok 进行匹配</p><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">redis</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">host</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;localhost&quot;</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">port</span><span style="color:#002339;"> =&gt; 6379</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">password</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;123456&quot;</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">db</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">data_type</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;list&quot;</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">key</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;filebeat&quot;</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">filter</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#7B30D0;">if</span><span style="color:#002339;"> [app] == </span><span style="color:#A44185;">&quot;www&quot;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">if</span><span style="color:#002339;"> [type] == </span><span style="color:#A44185;">&quot;nginx-access&quot;</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">      </span><span style="color:#7B30D0;">grok</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">       </span><span style="color:#7B30D0;"> match </span><span style="color:#002339;">=&gt; {</span></span>
<span class="line"><span style="color:#002339;">          </span><span style="color:#A44185;">&quot;message&quot;</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;%{IPV4:remote_addr} - (%{USERNAME:remote_user}|-) \[%{HTTPDATE:time_local}\] </span><span style="color:#174781;">\&quot;</span><span style="color:#A44185;">%{WORD:request_method} %{URIPATHPARAM:request_uri} HTTP/%{NUMBER:http_protocol}</span><span style="color:#174781;">\&quot;</span><span style="color:#A44185;"> %{NUMBER:http_status} %{NUMBER:body_bytes_sent} </span><span style="color:#174781;">\&quot;</span><span style="color:#A44185;">%{GREEDYDATA:http_referer}</span><span style="color:#174781;">\&quot;</span><span style="color:#A44185;"> </span><span style="color:#174781;">\&quot;</span><span style="color:#A44185;">%{GREEDYDATA:http_user_agent}</span><span style="color:#174781;">\&quot;</span><span style="color:#A44185;"> </span><span style="color:#174781;">\&quot;</span><span style="color:#A44185;">(%{IPV4:http_x_forwarded_for}|-)</span><span style="color:#174781;">\&quot;</span><span style="color:#A44185;">&quot;</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">        overwrite =&gt; [</span><span style="color:#A44185;">&quot;message&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">      geoip {</span></span>
<span class="line"><span style="color:#002339;">          source =&gt; </span><span style="color:#A44185;">&quot;remote_addr&quot;</span></span>
<span class="line"><span style="color:#002339;">          target =&gt; </span><span style="color:#A44185;">&quot;geoip&quot;</span></span>
<span class="line"><span style="color:#002339;">          database =&gt; </span><span style="color:#A44185;">&quot;/opt/GeoLite2-City.mmdb&quot;</span></span>
<span class="line"><span style="color:#002339;">          add_field =&gt; [</span><span style="color:#A44185;">&quot;[geoip][coordinates]&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;%{[geoip][longitude]}&quot;</span><span style="color:#002339;">] </span></span>
<span class="line"><span style="color:#002339;">          add_field =&gt; [</span><span style="color:#A44185;">&quot;[geoip][coordinates]&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;%{[geoip][latitude]}&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">      date {</span></span>
<span class="line"><span style="color:#002339;">          locale =&gt; </span><span style="color:#A44185;">&quot;en&quot;</span></span>
<span class="line"><span style="color:#002339;">          match =&gt; [</span><span style="color:#A44185;">&quot;time_local&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">      mutate {</span></span>
<span class="line"><span style="color:#002339;">          convert =&gt; [</span><span style="color:#A44185;">&quot;[geoip][coordinates]&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;float&quot;</span><span style="color:#002339;">]  </span></span>
<span class="line"><span style="color:#002339;">      }</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">output {</span></span>
<span class="line"><span style="color:#002339;">  elasticsearch {</span></span>
<span class="line"><span style="color:#002339;">      hosts  =&gt; [</span><span style="color:#A44185;">&quot;http://lcoalhost:9200&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">      index  =&gt; </span><span style="color:#A44185;">&quot;logstash-%{type}-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#002339;">  }</span></span>
<span class="line"><span style="color:#002339;">  stdout{codec =&gt; rubydebug }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><h3 id="log4j收集" tabindex="-1">Log4j收集 <a class="header-anchor" href="#log4j收集" aria-label="Permalink to &quot;Log4j收集&quot;">​</a></h3><div class="language-properties"><button title="Copy Code" class="copy"></button><span class="lang">properties</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">### 设置###</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.rootLogger</span><span style="color:#002339;"> = debug,stdout,D,E,logstash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">### 输出信息到控制抬 ###</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.stdout</span><span style="color:#002339;"> = org.apache.log4j.ConsoleAppender</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.stdout.Target</span><span style="color:#002339;"> = System.out</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.stdout.layout</span><span style="color:#002339;"> = org.apache.log4j.PatternLayout</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.stdout.layout.ConversionPattern</span><span style="color:#002339;"> = [%-5p] %d{yyyy-MM-dd HH:mm:ss,SSS} method:%l%n%m%n</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">### 输出DEBUG 级别以上的日志到=/Users/bee/Documents/elk/log4j/debug.log###</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.D</span><span style="color:#002339;"> = org.apache.log4j.DailyRollingFileAppender</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.D.File</span><span style="color:#002339;"> = /Users/bee/Documents/elk/log4j/debug.log</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.D.Append</span><span style="color:#002339;"> = true</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.D.Threshold</span><span style="color:#002339;"> = DEBUG </span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.D.layout</span><span style="color:#002339;"> = org.apache.log4j.PatternLayout</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.D.layout.ConversionPattern</span><span style="color:#002339;"> = %-d{yyyy-MM-dd HH:mm:ss}  [ %t:%r ] - [ %p ]  %m%n</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">### 输出ERROR 级别以上的日志到=/Users/bee/Documents/elk/log4j/error.log  ###</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.E</span><span style="color:#002339;"> = org.apache.log4j.DailyRollingFileAppender</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.E.File</span><span style="color:#002339;"> =/Users/bee/Documents/elk/log4j/error.log </span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.E.Append</span><span style="color:#002339;"> = true</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.E.Threshold</span><span style="color:#002339;"> = ERROR </span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.E.layout</span><span style="color:#002339;"> = org.apache.log4j.PatternLayout</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.E.layout.ConversionPattern</span><span style="color:#002339;"> = %-d{yyyy-MM-dd HH:mm:ss}  [ %t:%r ] - [ %p ]  %m%n</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">#输出日志到logstash</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.logstash</span><span style="color:#002339;">=org.apache.log4j.net.SocketAppender</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.logstash.RemoteHost</span><span style="color:#002339;">=127.0.0.1</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.logstash.port</span><span style="color:#002339;">=4560</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.logstash.ReconnectionDelay</span><span style="color:#002339;">=60000</span></span>
<span class="line"><span style="color:#7B30D0;">log4j.appender.logstash.LocationInfo</span><span style="color:#002339;">=true</span></span></code></pre></div><ol><li>第一份输出到控制台</li><li>第二份把DEBUG 级别以上的日志到文件</li><li>第三份把输出ERROR 级别以上的日志到文件</li><li>第四份输出到logstash</li></ol><div class="language-nginx"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">input</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">log4j</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">host</span><span style="color:#002339;"> =&gt; </span><span style="color:#A44185;">&quot;127.0.0.1&quot;</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">port</span><span style="color:#002339;"> =&gt; 8001</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">output</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    elasticsearch{</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">hosts</span><span style="color:#002339;"> =&gt; [</span><span style="color:#A44185;">&quot;localhost:9200&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#002339;">       </span><span style="color:#7B30D0;"> index </span><span style="color:#002339;">=&gt; </span><span style="color:#A44185;">&quot;log4j-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">    stdout {</span></span>
<span class="line"><span style="color:#002339;">      codec =&gt; rubydebug</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">import</span><span style="color:#002339;"> </span><span style="color:#DA5221;">org.apache.log4j.Logger</span><span style="color:#002339;">;</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"> * Created by bee on 17/3/6.</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">Log4jTest</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#0991B6;">Logger</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">logger</span><span style="color:#7B30D0;">=</span><span style="color:#2F86D2;">Logger</span><span style="color:#002339;">.</span><span style="color:#7EB233;">getLogger</span><span style="color:#002339;">(</span><span style="color:#2F86D2;">Log4jTest</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">class</span><span style="color:#002339;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">logger</span><span style="color:#002339;">.</span><span style="color:#7EB233;">debug</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;This is a debug message!&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">logger</span><span style="color:#002339;">.</span><span style="color:#7EB233;">info</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;This is info message!&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">logger</span><span style="color:#002339;">.</span><span style="color:#7EB233;">warn</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;This is a warn message!&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#2F86D2;">logger</span><span style="color:#002339;">.</span><span style="color:#7EB233;">error</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;This is error message!&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">try</span><span style="color:#002339;">{</span></span>
<span class="line"><span style="color:#002339;">           </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(</span><span style="color:#174781;">5</span><span style="color:#7B30D0;">/</span><span style="color:#174781;">0</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        }</span><span style="color:#7B30D0;">catch</span><span style="color:#002339;">(</span><span style="color:#0991B6;">Exception</span><span style="color:#002339;"> </span><span style="color:#B1108E;">e</span><span style="color:#002339;">){</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">logger</span><span style="color:#002339;">.</span><span style="color:#7EB233;">error</span><span style="color:#002339;">(e);</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div><p><img src="/doc/elk/img-22.png" alt="image.png"></p></div></div></main><footer class="VPDocFooter" data-v-6b87e69f data-v-ef5dee53><!--[--><!--]--><div class="edit-info" data-v-ef5dee53><div class="edit-link" data-v-ef5dee53><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/fxbsujay/Sujay-Docs/blob/main/docs/blog/elk.md" target="_blank" rel="noreferrer" data-v-ef5dee53><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-ef5dee53><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> 在 GitHub 上编辑此页面<!--]--></a></div><div class="last-updated" data-v-ef5dee53><p class="VPLastUpdated" data-v-ef5dee53 data-v-7de715c0>最近更新时间: <time datetime="2023-05-10T08:28:35.000Z" data-v-7de715c0></time></p></div></div><nav class="prev-next" data-v-ef5dee53><div class="pager" data-v-ef5dee53><a class="pager-link prev" href="/blog/mq.html" data-v-ef5dee53><span class="desc" data-v-ef5dee53>上一页</span><span class="title" data-v-ef5dee53>消息队列</span></a></div><div class="pager" data-v-ef5dee53><a class="pager-link next" href="/blog/netty.html" data-v-ef5dee53><span class="desc" data-v-ef5dee53>下一页</span><span class="title" data-v-ef5dee53>Netty 源码分析</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-1919c326 data-v-e03eb2e1><div class="container" data-v-e03eb2e1><p class="message" data-v-e03eb2e1>Released under the <a href="https://github.com/fxbsujay/Sujay-Docs/blob/main/LICENSE">MIT License</a>.</p><p class="copyright" data-v-e03eb2e1>Copyright © 2020-present <a href="https://github.com/fxbsujay">Fan XueBin</a> <a href="https://beian.miit.gov.cn/">鲁ICP备2022006050号-1</a></p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"blog_hexo.md\":\"a84aa174\",\"blog_css.md\":\"e4763fc2\",\"blog_eventloop.md\":\"471536b1\",\"blog_bit_operation.md\":\"db10f3b8\",\"blog_jdk_support.md\":\"f9931fb7\",\"components_button.md\":\"439755e4\",\"blog_shiwu.md\":\"bd992913\",\"blog_docker.md\":\"cb9c53a8\",\"blog_mysql_index.md\":\"d7e8a110\",\"components_overview.md\":\"4c21adf3\",\"blog_mymap.md\":\"b912d4ee\",\"blog_seata-sharding.md\":\"1375f7d8\",\"index.md\":\"25f20114\",\"blog_text.md\":\"d495ba65\",\"blog_snow-flake.md\":\"8bc954db\",\"blog_vue.md\":\"383b36ee\",\"blog_juc.md\":\"953e4d26\",\"blog_mysql.md\":\"f6ac6a27\",\"blog_redis.md\":\"ac42df03\",\"blog_mq.md\":\"5f8384e8\",\"blog_netty.md\":\"90136efb\",\"blog_elk.md\":\"59399ef9\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Sujay\",\"titleTemplate\":\":title - Sujay\",\"description\":\"Sujay Blog.\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"logo\":\"/favicon.ico\",\"siteTitle\":\"Fan Xuebin\",\"outline\":{\"level\":\"deep\",\"label\":\"大纲\"},\"lastUpdated\":{\"text\":\"最近更新时间\"},\"editLink\":{\"pattern\":\"https://github.com/fxbsujay/Sujay-Docs/blob/main/docs/:path\",\"text\":\"在 GitHub 上编辑此页面\"},\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"returnToTopLabel\":\"返回\",\"sidebarMenuLabel\":\"目录\",\"footer\":{\"message\":\"Released under the <a href=\\\"https://github.com/fxbsujay/Sujay-Docs/blob/main/LICENSE\\\">MIT License</a>.\",\"copyright\":\"Copyright © 2020-present <a href=\\\"https://github.com/fxbsujay\\\">Fan XueBin</a> <a href=\\\"https://beian.miit.gov.cn/\\\">鲁ICP备2022006050号-1</a>\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/fxbsujay\"}],\"nav\":[{\"text\":\"博客\",\"link\":\"/blog/jdk_support\",\"activeMatch\":\"/blog/\"},{\"text\":\"UI组件库\",\"link\":\"/components/button\",\"activeMatch\":\"/components/\"}],\"sidebar\":{\"/blog\":[{\"text\":\"后端知识库\",\"collapsed\":false,\"items\":[{\"text\":\"JAVA JDK17 新特性\",\"link\":\"/blog/jdk_support\"},{\"text\":\"位运算\",\"link\":\"/blog/bit_operation\"},{\"text\":\"Redis\",\"link\":\"/blog/redis\"},{\"text\":\"Docker\",\"link\":\"/blog/docker\"},{\"text\":\"MySql\",\"link\":\"/blog/mysql\"},{\"text\":\"MySql 索引\",\"link\":\"/blog/mysql_index\"},{\"text\":\"Java JUC\",\"link\":\"/blog/juc\"},{\"text\":\"消息队列\",\"link\":\"/blog/mq\"},{\"text\":\"ELK 学习文档\",\"link\":\"/blog/elk\"},{\"text\":\"Netty 源码分析\",\"link\":\"/blog/netty\"},{\"text\":\"雪花算法\",\"link\":\"/blog/snow-flake\"},{\"text\":\"实现一个简易Map\",\"link\":\"/blog/mymap\"},{\"text\":\"Seata 分布式事务\",\"link\":\"/blog/shiwu\"}]},{\"text\":\"前端知识库\",\"collapsed\":false,\"items\":[{\"text\":\"css选择器\",\"link\":\"/blog/css\"},{\"text\":\"事件循环\",\"link\":\"/blog/eventLoop\"},{\"text\":\"Vue3 快速上手\",\"link\":\"/blog/vue\"}]},{\"text\":\"生活小工具\",\"collapsed\":false,\"items\":[{\"text\":\"使用 Hexo 搭建一个博客\",\"link\":\"/blog/hexo\"},{\"text\":\"示例\",\"link\":\"/blog/text\"}]}],\"/components\":[{\"text\":\"基础组件\",\"collapsed\":false,\"items\":[{\"text\":\"按钮\",\"link\":\"/components/button\"}]}]}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>