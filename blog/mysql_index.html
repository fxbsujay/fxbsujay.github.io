<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySql 索引 - Sujay</title>
    <meta name="description" content="Sujay Blog.">
    <link rel="preload stylesheet" href="/assets/style.24f015e4.css" as="style">
    
    <script type="module" src="/assets/app.fa9b4eef.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.4cf23e62.js">
    <link rel="modulepreload" href="/assets/chunks/theme.0be83c97.js">
    <link rel="modulepreload" href="/assets/blog_mysql_index.md.d7e8a110.lean.js">
    <link rel="icon" href="/favicon.ico">
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-1919c326><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-1919c326 data-v-7e5bc4a5><div class="VPNavBar has-sidebar" data-v-7e5bc4a5 data-v-a0fd61f4><div class="container" data-v-a0fd61f4><div class="title" data-v-a0fd61f4><div class="VPNavBarTitle has-sidebar" data-v-a0fd61f4 data-v-86d1bed8><a class="title" href="/" data-v-86d1bed8><!--[--><!--]--><!--[--><img class="VPImage logo" src="/favicon.ico" alt data-v-8426fc1a><!--]--><!--[-->Fan Xuebin<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-a0fd61f4><div class="curtain" data-v-a0fd61f4></div><div class="content-body" data-v-a0fd61f4><!--[--><!--]--><div class="VPNavBarSearch search" data-v-a0fd61f4><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a0fd61f4 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/blog/jdk_support.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>博客</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/components/button.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>UI组件库</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a0fd61f4 data-v-f6a63727><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-f6a63727 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a0fd61f4 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/fxbsujay" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a0fd61f4 data-v-40855f84 data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-40855f84 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-40855f84><div class="item social-links" data-v-40855f84><div class="VPSocialLinks social-links-list" data-v-40855f84 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/fxbsujay" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a0fd61f4 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-1919c326 data-v-79c8c1df><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-79c8c1df><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-79c8c1df><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-79c8c1df>目录</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-79c8c1df data-v-1c15a60a><button data-v-1c15a60a>返回</button><!----></div></div><aside class="VPSidebar" data-v-1919c326 data-v-b00e2fdd><div class="curtain" data-v-b00e2fdd></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-b00e2fdd><span class="visually-hidden" id="sidebar-aria-label" data-v-b00e2fdd> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>后端知识库</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/jdk_support.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>JAVA JDK17 新特性</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/bit_operation.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>位运算</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/redis.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Redis</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/docker.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Docker</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/mysql.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>MySql</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/mysql_index.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>MySql 索引</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/juc.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Java JUC</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/mq.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>消息队列</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/elk.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>ELK 学习文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/netty.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Netty 源码分析</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/snow-flake.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>雪花算法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/mymap.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>实现一个简易Map</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/shiwu.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Seata 分布式事务</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>前端知识库</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/css.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>css选择器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/eventLoop.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>事件循环</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/vue.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>Vue3 快速上手</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>生活小工具</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/hexo.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>使用 Hexo 搭建一个博客</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/blog/text.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>示例</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-1919c326 data-v-669faec9><div class="VPDoc has-sidebar has-aside" data-v-669faec9 data-v-6b87e69f><!--[--><!--]--><div class="container" data-v-6b87e69f><div class="aside" data-v-6b87e69f><div class="aside-curtain" data-v-6b87e69f></div><div class="aside-container" data-v-6b87e69f><div class="aside-content" data-v-6b87e69f><div class="VPDocAside" data-v-6b87e69f data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-d330b1bb><div class="content" data-v-d330b1bb><div class="outline-marker" data-v-d330b1bb></div><div class="outline-title" role="heading" aria-level="2" data-v-d330b1bb>大纲</div><nav aria-labelledby="doc-outline-aria-label" data-v-d330b1bb><span class="visually-hidden" id="doc-outline-aria-label" data-v-d330b1bb> Table of Contents for current page </span><ul class="root" data-v-d330b1bb data-v-d0ee3533><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b87e69f><div class="content-container" data-v-6b87e69f><!--[--><!--]--><!----><main class="main" data-v-6b87e69f><div style="position:relative;" class="vp-doc _blog_mysql_index" data-v-6b87e69f><div><h1 id="mysql-索引" tabindex="-1">MySql 索引 <a class="header-anchor" href="#mysql-索引" aria-label="Permalink to &quot;MySql 索引&quot;">​</a></h1><p>索引的基本使用和索引的失效情况分析</p><div class="tip custom-block"><p class="custom-block-title">什么是索引</p><p>索引一般以文件形式存在磁盘中（也可以存于内存中），存储的索引的原理大致概括为以空间换时间，数据库在未添加索引的时候进行查询默认的是进行全量搜索，也就是进行全局扫描，有多少条数据就要进行多少次查询，然后找到相匹配的数据就把他放到结果集中，直到全表扫描完。而建立索引之后，会将建立索引的KEY值放在一个n叉树上（BTree）。因为B树的特点就是适合在磁盘等直接存储设备上组织动态查找表，每次以索引进行条件查询时，会去树上根据key值直接进行搜索</p></div><h2 id="优点" tabindex="-1">优点 <a class="header-anchor" href="#优点" aria-label="Permalink to &quot;优点&quot;">​</a></h2><p>建立索引的目的是加快对表中记录的查找或排序！</p><ul><li>建立索引的列可以保证行的唯一性，生成唯一的rowId</li><li>建立索引可以有效缩短数据的检索时间</li><li>建立索引可以加快表与表之间的连接</li><li>为用来排序或者是分组的字段添加索引可以加快分组和排序顺序</li></ul><h2 id="缺点" tabindex="-1">缺点 <a class="header-anchor" href="#缺点" aria-label="Permalink to &quot;缺点&quot;">​</a></h2><p>数据库中表的数据量较大的情况下，对于查询响应时间不能满足业务需求，可以合理的使用索引提升查询效率</p><ul><li>创建索引和维护索引需要时间成本，这个成本随着数据量的增加而加大</li><li>创建索引和维护索引需要空间成本，每一条索引都要占据数据库的物理存储空间，数据量越大，占用空间也越大（数据表占据的是数据库的数据空间）</li><li>会降低表的增删改的效率，因为每次增删改索引需要进行动态维护，导致时间变长</li></ul><h2 id="索引结构" tabindex="-1">索引结构 <a class="header-anchor" href="#索引结构" aria-label="Permalink to &quot;索引结构&quot;">​</a></h2><table><thead><tr><th style="text-align:center;">索引结构</th><th style="text-align:center;">描述</th></tr></thead><tbody><tr><td style="text-align:center;">B+Tree</td><td style="text-align:center;">最常见的索引类型，大部分引擎都支持B+树索引</td></tr><tr><td style="text-align:center;">Hash</td><td style="text-align:center;">底层数据结构是用哈希表实现，只有精确匹配索引列的查询才有效，不支持范围查询</td></tr><tr><td style="text-align:center;">R-Tree(空间索引)</td><td style="text-align:center;">空间索引是 MyISAM 引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少</td></tr><tr><td style="text-align:center;">Full-Text(全文索引)</td><td style="text-align:center;">是一种通过建立倒排索引，快速匹配文档的方式，类似于 Lucene, Solr, ES</td></tr></tbody></table><table><thead><tr><th style="text-align:center;">索引</th><th style="text-align:center;">InnoDB</th><th style="text-align:center;">MyISAM</th><th style="text-align:center;">Memory</th></tr></thead><tbody><tr><td style="text-align:center;">B+Tree索引</td><td style="text-align:center;">支持</td><td style="text-align:center;">支持</td><td style="text-align:center;">支持</td></tr><tr><td style="text-align:center;">Hash索引</td><td style="text-align:center;">不支持</td><td style="text-align:center;">不支持</td><td style="text-align:center;">支持</td></tr><tr><td style="text-align:center;">R-Tree索引</td><td style="text-align:center;">不支持</td><td style="text-align:center;">支持</td><td style="text-align:center;">不支持</td></tr><tr><td style="text-align:center;">Full-text</td><td style="text-align:center;">5.6版本后支持</td><td style="text-align:center;">支持</td><td style="text-align:center;">不支持</td></tr></tbody></table><h3 id="b-tree" tabindex="-1">B-Tree <a class="header-anchor" href="#b-tree" aria-label="Permalink to &quot;B-Tree&quot;">​</a></h3><p><img src="/doc/mysql/img-2.png" alt="二叉树"></p><p>二叉树的缺点可以用红黑树来解决： <img src="/doc/mysql/img-3.png" alt="红黑树"> 红黑树也存在大数据量情况下，层级较深，检索速度慢的问题。</p><p>为了解决上述问题，可以使用 B-Tree 结构。 B-Tree (多路平衡查找树) 以一棵最大度数（max-degree，指一个节点的子节点个数）为5（5阶）的 b-tree 为例（每个节点最多存储4个key，5个指针）</p><p><img src="/doc/mysql/img-4.png" alt="B-Tree结构"></p><blockquote><p>演示地址：<a href="https://www.cs.usfca.edu/~galles/visualization/BTree.html" target="_blank" rel="noreferrer">https://www.cs.usfca.edu/~galles/visualization/BTree.html</a></p></blockquote><h3 id="b-tree-1" tabindex="-1">B+Tree <a class="header-anchor" href="#b-tree-1" aria-label="Permalink to &quot;B+Tree&quot;">​</a></h3><p>结构图：</p><p><img src="/doc/mysql/img-5.png" alt="B+Tree结构图"></p><blockquote><p>演示地址：<a href="https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html" target="_blank" rel="noreferrer">https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html</a></p></blockquote><p>与 B-Tree 的区别：</p><ul><li>所有的数据都会出现在叶子节点</li><li>叶子节点形成一个单向链表</li></ul><p>MySQL 索引数据结构对经典的 B+Tree 进行了优化。在原 B+Tree 的基础上，增加一个指向相邻叶子节点的链表指针，就形成了带有顺序指针的 B+Tree，提高区间访问的性能。</p><p><img src="/doc/mysql/img-6.png" alt="MySQL B+Tree 结构图"></p><h3 id="hash" tabindex="-1">Hash <a class="header-anchor" href="#hash" aria-label="Permalink to &quot;Hash&quot;">​</a></h3><p>哈希索引就是采用一定的hash算法，将键值换算成新的hash值，映射到对应的槽位上，然后存储在hash表中。 如果两个（或多个）键值，映射到一个相同的槽位上，他们就产生了hash冲突（也称为hash碰撞），可以通过链表来解决。</p><p><img src="/doc/mysql/img-7.png" alt="Hash索引原理图"></p><p>特点：</p><ul><li>Hash索引只能用于对等比较（=、in），不支持范围查询（betwwn、&gt;、&lt;、...）</li><li>无法利用索引完成排序操作</li><li>查询效率高，通常只需要一次检索就可以了，效率通常要高于 B+Tree 索引</li></ul><p>存储引擎支持：</p><ul><li>Memory</li><li>InnoDB: 具有自适应hash功能，hash索引是存储引擎根据 B+Tree 索引在指定条件下自动构建的</li></ul><div class="tip custom-block"><p class="custom-block-title">为什么 InnoDB 存储引擎选择使用 B+Tree 索引结构？</p><ul><li>相对于二叉树，层级更少，搜索效率高</li><li>对于 B-Tree，无论是叶子节点还是非叶子节点，都会保存数据，这样导致一页中存储的键值减少，指针也跟着减少，要同样保存大量数据，只能增加树的高度，导致性能降低</li><li>相对于 Hash 索引，B+Tree 支持范围匹配及排序操作</li></ul></div><h2 id="索引分类" tabindex="-1">索引分类 <a class="header-anchor" href="#索引分类" aria-label="Permalink to &quot;索引分类&quot;">​</a></h2><table><thead><tr><th>分类</th><th>含义</th><th>特点</th><th>关键字</th></tr></thead><tbody><tr><td>主键索引</td><td>针对于表中主键创建的索引</td><td>默认自动创建，只能有一个</td><td>PRIMARY</td></tr><tr><td>唯一索引</td><td>避免同一个表中某数据列中的值重复</td><td>可以有多个</td><td>UNIQUE</td></tr><tr><td>常规索引</td><td>快速定位特定数据</td><td>可以有多个</td><td></td></tr><tr><td>全文索引</td><td>全文索引查找的是文本中的关键词，而不是比较索引中的值</td><td>可以有多个</td><td>FULLTEXT</td></tr></tbody></table><p>在 InnoDB 存储引擎中，根据索引的存储形式，又可以分为以下两种：</p><table><thead><tr><th>分类</th><th>含义</th><th>特点</th></tr></thead><tbody><tr><td>聚集索引(Clustered Index)</td><td>将数据存储与索引放一块，索引结构的叶子节点保存了行数据</td><td>必须有，而且只有一个</td></tr><tr><td>二级索引(Secondary Index)</td><td>将数据与索引分开存储，索引结构的叶子节点关联的是对应的主键</td><td>可以存在多个</td></tr></tbody></table><p>演示图：</p><p><img src="/doc/mysql/img-8.png" alt="大致原理"></p><p><img src="/doc/mysql/img-9.png" alt="大致原理"></p><p>聚集索引选取规则：</p><ul><li>如果存在主键，主键索引就是聚集索引</li><li>如果不存在主键，将使用第一个唯一(UNIQUE)索引作为聚集索引</li><li>如果表没有主键或没有合适的唯一索引，则 InnoDB 会自动生成一个 rowid 作为隐藏的聚集索引</li></ul><h4 id="" tabindex="-1"><a class="header-anchor" href="#" aria-label="Permalink to &quot;&quot;">​</a></h4><div class="tip custom-block"><p class="custom-block-title">以下 SQL 语句，哪个执行效率高？为什么？</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">-- id为主键，name字段创建的有索引</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> user </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> id </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#174781;">10</span><span style="color:#002339;">;</span></span>
<span class="line"><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> user </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">name</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#A44185;">&#39;Arm&#39;</span><span style="color:#002339;">;</span></span></code></pre></div><p>答：第一条语句，因为第二条需要回表查询，相当于两个步骤</p></div><p>2. InnoDB 主键索引的 B+Tree 高度为多少？</p><p>答：假设一行数据大小为1k，一页中可以存储16行这样的数据。InnoDB 的指针占用6个字节的空间，主键假设为bigint，占用字节数为8. 可得公式：<code>n * 8 + (n + 1) * 6 = 16 * 1024</code>，其中 8 表示 bigint 占用的字节数，n 表示当前节点存储的key的数量，(n + 1) 表示指针数量（比key多一个）。算出n约为1170。</p><p>如果树的高度为2，那么他能存储的数据量大概为：<code>1171 * 16 = 18736</code>； 如果树的高度为3，那么他能存储的数据量大概为：<code>1171 * 1171 * 16 = 21939856</code>。</p><p>另外，如果有成千上万的数据，那么就要考虑分表，涉及运维篇知识</p><h2 id="基本语句" tabindex="-1">基本语句 <a class="header-anchor" href="#基本语句" aria-label="Permalink to &quot;基本语句&quot;">​</a></h2><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">TABLE</span><span style="color:#002339;"> </span><span style="color:#7EB233;">table_name</span><span style="color:#002339;">[col_name data type]</span></span>
<span class="line"><span style="color:#002339;">[unique|fulltext][index|key][index_name](col_name[length])[asc|desc]</span></span></code></pre></div><ul><li>unique|fulltext为可选参数，分别表示唯一索引、全文索引</li><li>index和key为同义词，两者作用相同，用来指定创建索引</li><li>col_name为需要创建索引的字段列，该列必须从数据表中该定义的多个列中选择</li><li>index_name指定索引的名称，为可选参数，如果不指定，默认col_name为索引值</li><li>ength为可选参数，表示索引的长度，只有字符串类型的字段才能指定索引长度</li><li>asc或desc指定升序或降序的索引值存储</li></ul><h3 id="普通索引-单列索引" tabindex="-1">普通索引（单列索引） <a class="header-anchor" href="#普通索引-单列索引" aria-label="Permalink to &quot;普通索引（单列索引）&quot;">​</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">-- 直接创建索引</span></span>
<span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">INDEX</span><span style="color:#002339;"> </span><span style="color:#7EB233;">index_name</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">ON</span><span style="color:#002339;"> table_name(col_name)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 修改表结构的方式添加索引</span></span>
<span class="line"><span style="color:#7B30D0;">ALTER</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">TABLE</span><span style="color:#002339;"> table_name </span><span style="color:#7B30D0;">ADD</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">INDEX</span><span style="color:#002339;"> index_name(col_name)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 创建表的时候同时创建索引</span></span>
<span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">TABLE</span><span style="color:#002339;"> `</span><span style="color:#7EB233;">news</span><span style="color:#002339;">` (</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`id`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">int</span><span style="color:#002339;">(</span><span style="color:#174781;">11</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;"> AUTO_INCREMENT ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`title`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">255</span><span style="color:#002339;">)  </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;"> ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`content`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">255</span><span style="color:#002339;">)  </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;"> ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`time`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">20</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;"> </span><span style="color:#DA5221;">DEFAULT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;"> ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">PRIMARY KEY</span><span style="color:#002339;"> (</span><span style="color:#A44185;">`id`</span><span style="color:#002339;">),</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">INDEX</span><span style="color:#002339;"> index_name (title(</span><span style="color:#174781;">255</span><span style="color:#002339;">))</span></span>
<span class="line"><span style="color:#002339;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 删除索引</span></span>
<span class="line"><span style="color:#7B30D0;">DROP</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">INDEX</span><span style="color:#002339;"> index_name </span><span style="color:#7B30D0;">ON</span><span style="color:#002339;"> table_name;</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 或者</span></span>
<span class="line"><span style="color:#7B30D0;">alter</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">table</span><span style="color:#002339;"> </span><span style="color:#A44185;">`表名`</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">drop</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">index</span><span style="color:#002339;"> 索引名;</span></span></code></pre></div><h3 id="复合索引-组合索引" tabindex="-1">复合索引（组合索引） <a class="header-anchor" href="#复合索引-组合索引" aria-label="Permalink to &quot;复合索引（组合索引）&quot;">​</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">-- 直接创建索引</span></span>
<span class="line"><span style="color:#7B30D0;">create</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">index</span><span style="color:#002339;"> </span><span style="color:#7EB233;">index_name</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">on</span><span style="color:#002339;"> table_name(col_name1,col_name2,...)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 修改表结构的方式添加索引</span></span>
<span class="line"><span style="color:#7B30D0;">alter</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">table</span><span style="color:#002339;"> table_name </span><span style="color:#7B30D0;">add</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">index</span><span style="color:#002339;"> index_name(col_name,col_name2,...)</span></span></code></pre></div><h3 id="唯一索引" tabindex="-1">唯一索引 <a class="header-anchor" href="#唯一索引" aria-label="Permalink to &quot;唯一索引&quot;">​</a></h3><p>唯一索引和普通索引类似，主要的区别在于，唯一索引限制列的值必须唯一，但允许存在空值（只允许存在一条空值）</p><div class="tip custom-block line"> &quot;空值&quot; 和 &quot;NULL&quot; 的是不一样的，空值是不占用空间的，MySQL中的NULL其实是占用空间的 </div><ul><li>如果添加索引的列的值存在两个或者两个以上的空值，则不能创建唯一性索引会失败。（一般在创建表的时候，要对自动设置唯一性索引，需要在字段上加上 not null）</li><li>如果添加索引的列的值存在两个或者两个以上的null值，还是可以创建唯一性索引，只是后面创建的数据不能再插入null值 ，并且严格意义上此列并不是唯一的，因为存在多个null值</li></ul><p>对于多个字段创建唯一索引规定列值的组合必须唯一 比如：在order表创建orderId字段和 productId字段 的唯一性索引，那么这两列的组合值必须唯一！</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">--长度验证：注意空值的之间是没有空格的。</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#7B30D0;">&gt;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">length</span><span style="color:#002339;">(</span><span style="color:#A44185;">&#39;&#39;</span><span style="color:#002339;">),</span><span style="color:#7B30D0;">length</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">null</span><span style="color:#002339;">),</span><span style="color:#7B30D0;">length</span><span style="color:#002339;">(</span><span style="color:#A44185;">&#39; &#39;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#7B30D0;">+</span><span style="color:#357B42;font-style:italic;">------------+--------------+-------------+</span></span>
<span class="line"><span style="color:#002339;">| </span><span style="color:#7B30D0;">length</span><span style="color:#002339;">(</span><span style="color:#A44185;">&#39;&#39;</span><span style="color:#002339;">) | </span><span style="color:#7B30D0;">length</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">null</span><span style="color:#002339;">) | </span><span style="color:#7B30D0;">length</span><span style="color:#002339;">(</span><span style="color:#A44185;">&#39; &#39;</span><span style="color:#002339;">) |</span></span>
<span class="line"><span style="color:#7B30D0;">+</span><span style="color:#357B42;font-style:italic;">------------+--------------+-------------+</span></span>
<span class="line"><span style="color:#002339;">|          </span><span style="color:#174781;">0</span><span style="color:#002339;"> |         </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;"> |           </span><span style="color:#174781;">1</span><span style="color:#002339;"> |</span></span>
<span class="line"><span style="color:#7B30D0;">+</span><span style="color:#357B42;font-style:italic;">------------+--------------+-------------+</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 创建单个索引</span></span>
<span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">UNIQUE INDEX</span><span style="color:#002339;"> </span><span style="color:#7EB233;">index_name</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">ON</span><span style="color:#002339;"> table_name(col_name)</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 创建多个索引</span></span>
<span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">UNIQUE INDEX</span><span style="color:#002339;"> </span><span style="color:#7EB233;">index_name</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">on</span><span style="color:#002339;"> table_name(col_name,...)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 修改表结构的方式 单个</span></span>
<span class="line"><span style="color:#7B30D0;">ALTER</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">TABLE</span><span style="color:#002339;"> table_name </span><span style="color:#7B30D0;">ADD</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">UNIQUE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">index</span><span style="color:#002339;"> index_name(col_name)</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 修改表结构的方式 多个</span></span>
<span class="line"><span style="color:#7B30D0;">ALTER</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">TABLE</span><span style="color:#002339;"> table_name </span><span style="color:#7B30D0;">ADD</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">UNIQUE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">index</span><span style="color:#002339;"> index_name(col_name,...)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 创建表的时候同时创建索引</span></span>
<span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">TABLE</span><span style="color:#002339;"> `</span><span style="color:#7EB233;">news</span><span style="color:#002339;">` (</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`id`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">int</span><span style="color:#002339;">(</span><span style="color:#174781;">11</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;"> AUTO_INCREMENT ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`title`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">255</span><span style="color:#002339;">)  </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;"> ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`content`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">255</span><span style="color:#002339;">)  </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;"> ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`time`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">20</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;"> </span><span style="color:#DA5221;">DEFAULT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;"> ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">PRIMARY KEY</span><span style="color:#002339;"> (</span><span style="color:#A44185;">`id`</span><span style="color:#002339;">),</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">UNIQUE</span><span style="color:#002339;"> index_name_unique(title)</span></span>
<span class="line"><span style="color:#002339;">)</span></span></code></pre></div><h3 id="主键索引" tabindex="-1">主键索引 <a class="header-anchor" href="#主键索引" aria-label="Permalink to &quot;主键索引&quot;">​</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">-- 主键索引(创建表时添加)</span></span>
<span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">TABLE</span><span style="color:#002339;"> `</span><span style="color:#7EB233;">news</span><span style="color:#002339;">` (</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`id`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">int</span><span style="color:#002339;">(</span><span style="color:#174781;">11</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;"> AUTO_INCREMENT ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`title`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">255</span><span style="color:#002339;">)  </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;"> ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`content`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">255</span><span style="color:#002339;">)  </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;"> ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`time`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">20</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;"> </span><span style="color:#DA5221;">DEFAULT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;"> ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">PRIMARY KEY</span><span style="color:#002339;"> (</span><span style="color:#A44185;">`id`</span><span style="color:#002339;">)</span></span>
<span class="line"><span style="color:#002339;">)</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 创建表后添加</span></span>
<span class="line"><span style="color:#7B30D0;">alter</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">table</span><span style="color:#002339;"> tbl_name </span><span style="color:#7B30D0;">add</span><span style="color:#002339;"> </span><span style="color:#DA5221;">primary key</span><span style="color:#002339;">(col_name)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">TABLE</span><span style="color:#002339;"> `</span><span style="color:#7EB233;">order</span><span style="color:#002339;">` (</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`orderId`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">36</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`productId`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">36</span><span style="color:#002339;">)  </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;"> ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`time`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">20</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;"> </span><span style="color:#DA5221;">DEFAULT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">NULL</span></span>
<span class="line"><span style="color:#002339;">)</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#7B30D0;">alter</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">table</span><span style="color:#002339;"> </span><span style="color:#A44185;">`order`</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">add</span><span style="color:#002339;"> </span><span style="color:#DA5221;">primary key</span><span style="color:#002339;">(</span><span style="color:#A44185;">`orderId`</span><span style="color:#002339;">)</span></span></code></pre></div><h3 id="全文索引" tabindex="-1">全文索引 <a class="header-anchor" href="#全文索引" aria-label="Permalink to &quot;全文索引&quot;">​</a></h3><p>在一般情况下，模糊查询都是通过 like 的方式进行查询。但是，对于海量数据，这并不是一个好办法，在 like <code>value%</code> 可以使用索引，但是对于 like <code>%value%</code> 这样的方式，执行全表查询，这在数据量小的表，不存在性能问题，但是对于海量数据，全表扫描是非常可怕的事情，所以 like 进行模糊匹配性能很差</p><p>这种情况下，需要考虑使用全文搜索的方式进行优化。全文搜索在 MySQL 中是一个 FULLTEXT 类型索引。<strong>FULLTEXT 索引在 MySQL 5.6 版本之后支持 InnoDB，而之前的版本只支持 MyISAM 表</strong>。 全文索引主要用来查找文本中的关键字，而不是直接与索引中的值相比较。fulltext索引跟其它索引大不相同，它更像是一个搜索引擎，而不是简单的where语句的参数匹配。fulltext索引配合match against操作使用，而不是一般的where语句加like。目前只有char、varchar，text 列上可以创建全文索引。</p><div class="tip custom-block"><p class="custom-block-title">小技巧</p><p>在数据量较大时候，先将数据放入一个没有全局索引的表中，然后再用CREATE index创建fulltext索引，要比先为一张表建立fulltext然后再将数据写入的速度快很多</p></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">-- 创建表的适合添加全文索引</span></span>
<span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">TABLE</span><span style="color:#002339;"> `</span><span style="color:#7EB233;">news</span><span style="color:#002339;">` (</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`id`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">int</span><span style="color:#002339;">(</span><span style="color:#174781;">11</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;"> AUTO_INCREMENT ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`title`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">255</span><span style="color:#002339;">)  </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;"> ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`content`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">text</span><span style="color:#002339;">  </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;"> ,</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">`time`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">20</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;"> </span><span style="color:#DA5221;">DEFAULT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;"> ,</span></span>
<span class="line"><span style="color:#002339;">     </span><span style="color:#DA5221;">PRIMARY KEY</span><span style="color:#002339;"> (</span><span style="color:#A44185;">`id`</span><span style="color:#002339;">),</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#7B30D0;">FULLTEXT</span><span style="color:#002339;"> (content)</span></span>
<span class="line"><span style="color:#002339;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 修改表结构的时候创建索引</span></span>
<span class="line"><span style="color:#7B30D0;">ALTER</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">TABLE</span><span style="color:#002339;"> table_name </span><span style="color:#7B30D0;">ADD</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">FULLTEXT</span><span style="color:#002339;"> index_fulltext_content(col_name)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 直接创建索引</span></span>
<span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">FULLTEXT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">INDEX</span><span style="color:#002339;"> index_fulltext_content </span><span style="color:#7B30D0;">ON</span><span style="color:#002339;"> table_name(col_name)</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">默认 MySQL 不支持中文全文检索</p><p>MySQL 全文搜索只是一个临时方案，对于全文搜索场景，更专业的做法是使用全文搜索引擎，例如 ElasticSearch 或 Solr 索引的查询和删除</p></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">-- 查看:</span></span>
<span class="line"><span style="color:#002339;">show indexes </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> </span><span style="color:#A44185;">`表名`</span><span style="color:#002339;">;</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 或</span></span>
<span class="line"><span style="color:#002339;">show keys </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> </span><span style="color:#A44185;">`表名`</span><span style="color:#002339;">;</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 删除</span></span>
<span class="line"><span style="color:#7B30D0;">alter</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">table</span><span style="color:#002339;"> </span><span style="color:#A44185;">`表名`</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">drop</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">index</span><span style="color:#002339;"> 索引名;</span></span></code></pre></div><h3 id="覆盖索引" tabindex="-1">覆盖索引 <a class="header-anchor" href="#覆盖索引" aria-label="Permalink to &quot;覆盖索引&quot;">​</a></h3><p>查询使用了索引，并且需要返回的列，在该索引中已经全部能找到，减少 SELECT *，避免回表查询</p><p>explain 中 extra 字段含义：</p><p><code>using index condition</code>：查找使用了索引，但是需要回表查询数据</p><p><code>using WHERE; using index</code>：查找使用了索引，但是需要的数据都在索引列中能找到，所以不需要回表查询</p><p>如果在聚集索引中直接能找到对应的行，则直接返回行数据，只需一次查询，哪怕是SELECT *</p><p>如果在辅助索引中找聚集索引，如<code>SELECT id, name FROM xxx WHERE name=&#39;xxx&#39;;</code>，也只需要通过辅助索引(name)查找到对应的id，返回name和name索引对应的id即可，只需要一次查询；</p><p>如果是通过辅助索引查找其他字段，则需要回表查询，如 <code>SELECT id, name, gender FROM xxx WHERE name=&#39;xxx&#39;;</code></p><p>所以尽量不要用<code>SELECT *</code>，容易出现回表查询，降低效率，除非有联合索引包含了所有字段</p><div class="tip custom-block"><p class="custom-block-title">面试题</p><p>一张表，有四个字段（id, username, password, status），由于数据量大，需要对以下SQL语句进行优化，该如何进行才是最优方案：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">SELECT</span><span style="color:#002339;"> id, username, </span><span style="color:#7B30D0;">password</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">FROM</span><span style="color:#002339;"> tb_user </span><span style="color:#7B30D0;">WHERE</span><span style="color:#002339;"> username</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;itcast&#39;</span></span></code></pre></div><p>解：给username和password字段建立联合索引，则不需要回表查询，直接覆盖索引</p></div><h3 id="前缀索引" tabindex="-1">前缀索引 <a class="header-anchor" href="#前缀索引" aria-label="Permalink to &quot;前缀索引&quot;">​</a></h3><p>当字段类型为字符串（varchar, text等）时，有时候需要索引很长的字符串，这会让索引变得很大，查询时，浪费大量的磁盘IO，影响查询效率，此时可以只降字符串的一部分前缀，建立索引，这样可以大大节约索引空间，从而提高索引效率。</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">create</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">index</span><span style="color:#002339;"> </span><span style="color:#7EB233;">idx_xxxx</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">on</span><span style="color:#002339;"> table_name(columnn(n))</span></span></code></pre></div><p>前缀长度：可以根据索引的选择性来决定，而选择性是指不重复的索引值（基数）和数据表的记录总数的比值，索引选择性越高则查询效率越高，唯一索引的选择性是1，这是最好的索引选择性，性能也是最好的。</p><p>求选择性公式：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">SELECT</span><span style="color:#002339;"> </span><span style="color:#1AB394;">count</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">distinct</span><span style="color:#002339;"> email) </span><span style="color:#7B30D0;">/</span><span style="color:#002339;"> </span><span style="color:#1AB394;">count</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">*</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">FROM</span><span style="color:#002339;"> tb_user</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">SELECT</span><span style="color:#002339;"> </span><span style="color:#1AB394;">count</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">distinct</span><span style="color:#002339;"> </span><span style="color:#1AB394;">substring</span><span style="color:#002339;">(email, </span><span style="color:#174781;">1</span><span style="color:#002339;">, </span><span style="color:#174781;">5</span><span style="color:#002339;">)) </span><span style="color:#7B30D0;">/</span><span style="color:#002339;"> </span><span style="color:#1AB394;">count</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">*</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">FROM</span><span style="color:#002339;"> tb_user</span></span></code></pre></div><p>show index 里面的sub_part可以看到接取的长度</p><h2 id="索引失效" tabindex="-1">索引失效 <a class="header-anchor" href="#索引失效" aria-label="Permalink to &quot;索引失效&quot;">​</a></h2><p>索引优化工具 EXPLAIN 或者 DESC 命令获取 MySQL 如何执行 SELECT 语句的信息，包括在 SELECT 语句执行过程中表如何连接和连接的顺序</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">-- 查看索引使用效果</span></span>
<span class="line"><span style="color:#002339;">show </span><span style="color:#7B30D0;">status</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">like</span><span style="color:#002339;"> ‘Handler_read%’</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">handler_read_key:				这个值越高越好，越高表示使用索引查询到的次数</span></span>
<span class="line"><span style="color:#002339;">handler_read_rnd_next:	这个值越高，说明查询低效</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 查询索引使用情况</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">SELECT</span><span style="color:#002339;"> 字段列表 </span><span style="color:#7B30D0;">FROM</span><span style="color:#002339;"> 表名 HWERE 条件</span></span>
<span class="line"><span style="color:#7B30D0;">DESC</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">SELECT</span><span style="color:#002339;"> 字段列表 </span><span style="color:#7B30D0;">FROM</span><span style="color:#002339;"> 表名 HWERE 条件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 建议使用索引</span></span>
<span class="line"><span style="color:#002339;">explain </span><span style="color:#7B30D0;">SELECT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">FROM</span><span style="color:#002339;"> tb_user </span><span style="color:#7B30D0;">use</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">index</span><span style="color:#002339;">(idx_user_pro) </span><span style="color:#7B30D0;">WHERE</span><span style="color:#002339;"> profession</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&quot;软工&quot;</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 不使用哪个索引：</span></span>
<span class="line"><span style="color:#002339;">explain </span><span style="color:#7B30D0;">SELECT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">FROM</span><span style="color:#002339;"> tb_user </span><span style="color:#7B30D0;">ignore</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">index</span><span style="color:#002339;">(idx_user_pro) </span><span style="color:#7B30D0;">WHERE</span><span style="color:#002339;"> profession</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&quot;软工&quot;</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 必须使用哪个索引</span></span>
<span class="line"><span style="color:#002339;">explain </span><span style="color:#7B30D0;">SELECT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">FROM</span><span style="color:#002339;"> tb_user </span><span style="color:#7B30D0;">force</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">index</span><span style="color:#002339;">(idx_user_pro) </span><span style="color:#7B30D0;">WHERE</span><span style="color:#002339;"> profession</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&quot;软工&quot;</span></span></code></pre></div><p>EXPLAIN 各字段含义：</p><ul><li>id：SELECT 查询的序列号，表示查询中执行 SELECT 子句或者操作表的顺序（id相同，执行顺序从上到下；id不同，值越大越先执行）</li><li>SELECT_type：表示 SELECT 的类型，常见取值有 SIMPLE（简单表，即不适用表连接或者子查询）、PRIMARY（主查询，即外层的查询）、UNION（UNION中的第二个或者后面的查询语句）、SUBQUERY（SELECT/WHERE之后包含了子查询）等</li><li>type：表示连接类型，性能由好到差的连接类型为 NULL、system、const、eq_ref、ref、range、index、all</li><li>possible_key：可能应用在这张表上的索引，一个或多个</li><li>Key：实际使用的索引，如果为 NULL，则没有使用索引</li><li>Key_len：表示索引中使用的字节数，该值为索引字段最大可能长度，并非实际使用长度，在不损失精确性的前提下，长度越短越好</li><li>rows：MySQL认为必须要执行的行数，在InnoDB引擎的表中，是一个估计值，可能并不总是准确的</li><li>filtered：表示返回结果的行数占需读取行数的百分比，filtered的值越大越好</li></ul><hr><blockquote><p>测试数据</p></blockquote><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">DROP</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">TABLE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">IF</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">EXISTS</span><span style="color:#002339;"> </span><span style="color:#A44185;">`students`</span><span style="color:#002339;">;</span></span>
<span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">TABLE</span><span style="color:#002339;"> `</span><span style="color:#7EB233;">students</span><span style="color:#002339;">` (</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#A44185;">`stud_id`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">int</span><span style="color:#002339;">(</span><span style="color:#174781;">11</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#A44185;">`name`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">50</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#A44185;">`email`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">50</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#A44185;">`phone`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">varchar</span><span style="color:#002339;">(</span><span style="color:#174781;">1</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">NOT NULL</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#A44185;">`create_date`</span><span style="color:#002339;"> </span><span style="color:#0991B6;">date</span><span style="color:#002339;"> </span><span style="color:#DA5221;">DEFAULT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">NULL</span><span style="color:#002339;">,</span></span>
<span class="line"><span style="color:#002339;">  </span><span style="color:#DA5221;">PRIMARY KEY</span><span style="color:#002339;"> (</span><span style="color:#A44185;">`stud_id`</span><span style="color:#002339;">)</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#002339;">)</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#7B30D0;">INSERT INTO</span><span style="color:#002339;"> </span><span style="color:#A44185;">`learn_mybatis`</span><span style="color:#002339;">.</span><span style="color:#A44185;">`students`</span><span style="color:#002339;"> (</span><span style="color:#A44185;">`stud_id`</span><span style="color:#002339;">, </span><span style="color:#A44185;">`name`</span><span style="color:#002339;">, </span><span style="color:#A44185;">`email`</span><span style="color:#002339;">, </span><span style="color:#A44185;">`phone`</span><span style="color:#002339;">, </span><span style="color:#A44185;">`create_date`</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">VALUES</span><span style="color:#002339;"> (</span><span style="color:#A44185;">&#39;1&#39;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&#39;admin&#39;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&#39;student1@gmail.com&#39;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&#39;18729902095&#39;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&#39;1983-06-25&#39;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#7B30D0;">INSERT INTO</span><span style="color:#002339;"> </span><span style="color:#A44185;">`learn_mybatis`</span><span style="color:#002339;">.</span><span style="color:#A44185;">`students`</span><span style="color:#002339;"> (</span><span style="color:#A44185;">`stud_id`</span><span style="color:#002339;">, </span><span style="color:#A44185;">`name`</span><span style="color:#002339;">, </span><span style="color:#A44185;">`email`</span><span style="color:#002339;">, </span><span style="color:#A44185;">`phone`</span><span style="color:#002339;">, </span><span style="color:#A44185;">`create_date`</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">VALUES</span><span style="color:#002339;"> (</span><span style="color:#A44185;">&#39;2&#39;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&#39;root&#39;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&#39;74298110186@qq.com&#39;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&#39;2&#39;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&#39;1983-12-25&#39;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#7B30D0;">INSERT INTO</span><span style="color:#002339;"> </span><span style="color:#A44185;">`learn_mybatis`</span><span style="color:#002339;">.</span><span style="color:#A44185;">`students`</span><span style="color:#002339;"> (</span><span style="color:#A44185;">`stud_id`</span><span style="color:#002339;">, </span><span style="color:#A44185;">`name`</span><span style="color:#002339;">, </span><span style="color:#A44185;">`email`</span><span style="color:#002339;">, </span><span style="color:#A44185;">`phone`</span><span style="color:#002339;">, </span><span style="color:#A44185;">`create_date`</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">VALUES</span><span style="color:#002339;"> (</span><span style="color:#A44185;">&#39;3&#39;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&#39;110&#39;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&#39;7429811086@qq.com&#39;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&#39;3dsad&#39;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&#39;2017-04-28&#39;</span><span style="color:#002339;">);</span></span></code></pre></div><h3 id="_1-在where后使用or-导致索引失效-尽量少用or" tabindex="-1">1. 在where后使用or，导致索引失效（尽量少用or） <a class="header-anchor" href="#_1-在where后使用or-导致索引失效-尽量少用or" aria-label="Permalink to &quot;1. 在where后使用or，导致索引失效（尽量少用or）&quot;">​</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">INDEX</span><span style="color:#002339;"> </span><span style="color:#7EB233;">index_name_email</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">ON</span><span style="color:#002339;"> students(email)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">INDEX</span><span style="color:#002339;"> </span><span style="color:#7EB233;">index_name_phone</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">ON</span><span style="color:#002339;"> students(phone)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 使用了索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> stud_id</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;1&#39;</span><span style="color:#002339;">  </span><span style="color:#7B30D0;">or</span><span style="color:#002339;"> phone</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;18729902095&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 使用了索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> stud_id</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;1&#39;</span><span style="color:#002339;">  </span><span style="color:#7B30D0;">or</span><span style="color:#002339;"> email</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;742981086@qq.com&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">---------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 没有使用索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> phone</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;18729902095&#39;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">or</span><span style="color:#002339;"> email</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;742981086@qq.com&#39;</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 没有使用索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> stud_id</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;1&#39;</span><span style="color:#002339;">  </span><span style="color:#7B30D0;">or</span><span style="color:#002339;"> phone</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;222&#39;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">or</span><span style="color:#002339;"> email</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;742981086@qq.com&#39;</span></span></code></pre></div><h3 id="_2-使用-like-like-查询是以-开头" tabindex="-1">2. 使用 like，like 查询是以 <code>%</code> 开头 <a class="header-anchor" href="#_2-使用-like-like-查询是以-开头" aria-label="Permalink to &quot;2. 使用 like，like 查询是以 `%` 开头&quot;">​</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">-- 使用了index_name_email索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> email </span><span style="color:#7B30D0;">like</span><span style="color:#002339;"> </span><span style="color:#A44185;">&#39;742981086@qq.com%&#39;</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 没有使用index_name_email索引，索引失效</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> email </span><span style="color:#7B30D0;">like</span><span style="color:#002339;"> </span><span style="color:#A44185;">&#39;%742981086@qq.com&#39;</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 没有使用index_name_email索引，索引失效</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> email </span><span style="color:#7B30D0;">like</span><span style="color:#002339;"> </span><span style="color:#A44185;">&#39;%742981086@qq.com%&#39;</span></span></code></pre></div><h3 id="_3-复合索引遵守-最左前缀-原则" tabindex="-1">3. 复合索引遵守“最左前缀”原则 <a class="header-anchor" href="#_3-复合索引遵守-最左前缀-原则" aria-label="Permalink to &quot;3. 复合索引遵守“最左前缀”原则&quot;">​</a></h3><p>在查询条件中使用了复合索引的第一个字段，索引才会被使用</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">create</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">index</span><span style="color:#002339;"> </span><span style="color:#7EB233;">index_email_phone</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">on</span><span style="color:#002339;"> students(email,phone)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 使用了 index_email_phone 索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> email</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;742981086@qq.com&#39;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">and</span><span style="color:#002339;">  phone</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;18729902095&#39;</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 使用了 index_email_phone 索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> phone</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;18729902095&#39;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">and</span><span style="color:#002339;">  email</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;742981086@qq.com&#39;</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 使用了 index_email_phone 索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> email</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;742981086@qq.com&#39;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">and</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">name=</span><span style="color:#A44185;">&#39;admin&#39;</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 没有使用index_email_phone索引，复合索引失效</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> phone</span><span style="color:#7B30D0;">=</span><span style="color:#A44185;">&#39;18729902095&#39;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">and</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">name=</span><span style="color:#A44185;">&#39;admin&#39;</span></span></code></pre></div><h3 id="_4-字符串类型字段未使用引号" tabindex="-1">4. 字符串类型字段未使用引号 <a class="header-anchor" href="#_4-字符串类型字段未使用引号" aria-label="Permalink to &quot;4. 字符串类型字段未使用引号&quot;">​</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">INDEX</span><span style="color:#002339;"> </span><span style="color:#7EB233;">index_name</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">ON</span><span style="color:#002339;"> students(</span><span style="color:#7B30D0;">name</span><span style="color:#002339;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 使用索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">name=</span><span style="color:#A44185;">&#39;110&#39;</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 没有使用索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">name=</span><span style="color:#174781;">110</span></span></code></pre></div><h3 id="_5-使用-in-导致索引失效" tabindex="-1">5. 使用 in 导致索引失效 <a class="header-anchor" href="#_5-使用-in-导致索引失效" aria-label="Permalink to &quot;5. 使用 in 导致索引失效&quot;">​</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">-- 使用索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">name=</span><span style="color:#A44185;">&#39;admin&#39;</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 没有使用索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">SELECT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">name</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">in</span><span style="color:#002339;"> (</span><span style="color:#A44185;">&#39;admin&#39;</span><span style="color:#002339;">)</span></span></code></pre></div><h3 id="_6-date-format-格式化时间" tabindex="-1">6. DATE_FORMAT()格式化时间 <a class="header-anchor" href="#_6-date-format-格式化时间" aria-label="Permalink to &quot;6. DATE_FORMAT()格式化时间&quot;">​</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">CREATE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">INDEX</span><span style="color:#002339;"> </span><span style="color:#7EB233;">index_create_date</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">ON</span><span style="color:#002339;"> students(create_date)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 使用索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">SELECT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> create_date </span><span style="color:#7B30D0;">&gt;=</span><span style="color:#002339;"> </span><span style="color:#A44185;">&#39;2010-05-05&#39;</span></span>
<span class="line"><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">-- 没有使用索引</span></span>
<span class="line"><span style="color:#002339;">EXPLAIN </span><span style="color:#7B30D0;">SELECT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">DATE_FORMAT</span><span style="color:#002339;">(create_date,</span><span style="color:#A44185;">&#39;%Y-%m-%d&#39;</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">&gt;=</span><span style="color:#002339;"> </span><span style="color:#A44185;">&#39;2010-05-05&#39;</span></span></code></pre></div><h3 id="_7-order-by、group-by-、-union、-distinc-中的字段出现在where条件中时-才会利用索引" tabindex="-1">7. order by、group by 、 union、 distinc 中的字段出现在where条件中时，才会利用索引 <a class="header-anchor" href="#_7-order-by、group-by-、-union、-distinc-中的字段出现在where条件中时-才会利用索引" aria-label="Permalink to &quot;7. order by、group by 、 union、 distinc 中的字段出现在where条件中时，才会利用索引&quot;">​</a></h3><h3 id="_8-对索引列进行运算导致索引失效-我所指的对索引列进行运算包括-等" tabindex="-1">8. 对索引列进行运算导致索引失效,我所指的对索引列进行运算包括(+，-，*，/，! 等) <a class="header-anchor" href="#_8-对索引列进行运算导致索引失效-我所指的对索引列进行运算包括-等" aria-label="Permalink to &quot;8. 对索引列进行运算导致索引失效,我所指的对索引列进行运算包括(+，-，*，/，! 等)&quot;">​</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;"># 使用索引</span></span>
<span class="line"><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> id</span><span style="color:#7B30D0;">=</span><span style="color:#174781;">10</span><span style="color:#002339;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;"># 没有使用索引</span></span>
<span class="line"><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> id</span><span style="color:#7B30D0;">-</span><span style="color:#174781;">1</span><span style="color:#7B30D0;">=</span><span style="color:#174781;">9</span></span></code></pre></div><h3 id="_9-使用mysql内部函数导致索引失效-对于这样情况应当创建基于函数的索引" tabindex="-1">9. 使用mysql内部函数导致索引失效.对于这样情况应当创建基于函数的索引 <a class="header-anchor" href="#_9-使用mysql内部函数导致索引失效-对于这样情况应当创建基于函数的索引" aria-label="Permalink to &quot;9. 使用mysql内部函数导致索引失效.对于这样情况应当创建基于函数的索引&quot;">​</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;"># 使用索引</span></span>
<span class="line"><span style="color:#7B30D0;">create</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">index</span><span style="color:#002339;"> </span><span style="color:#7EB233;">test_id_fbi_idx</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">on</span><span style="color:#002339;"> students(</span><span style="color:#1AB394;">round</span><span style="color:#002339;">(id))</span></span>
<span class="line"><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> test </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> </span><span style="color:#1AB394;">round</span><span style="color:#002339;">(id)</span><span style="color:#7B30D0;">=</span><span style="color:#174781;">10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;"># 没有使用索引</span></span>
<span class="line"><span style="color:#7B30D0;">select</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">*</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">from</span><span style="color:#002339;"> students </span><span style="color:#7B30D0;">where</span><span style="color:#002339;"> </span><span style="color:#1AB394;">round</span><span style="color:#002339;">(id)</span><span style="color:#7B30D0;">=</span><span style="color:#174781;">10</span><span style="color:#002339;">;</span></span></code></pre></div><h3 id="_10-在join操作中-需要从多个数据表提取数据时-mysql只有在主键和外键的数据类型相同时才能使用索引-否则即使建立了-索引也不会使用" tabindex="-1">10. 在JOIN操作中（需要从多个数据表提取数据时），MYSQL只有在主键和外键的数据类型相同时才能使用索引，否则即使建立了 索引也不会使用 <a class="header-anchor" href="#_10-在join操作中-需要从多个数据表提取数据时-mysql只有在主键和外键的数据类型相同时才能使用索引-否则即使建立了-索引也不会使用" aria-label="Permalink to &quot;10. 在JOIN操作中（需要从多个数据表提取数据时），MYSQL只有在主键和外键的数据类型相同时才能使用索引，否则即使建立了 索引也不会使用&quot;">​</a></h3><h3 id="_11-重复数据太多-例如-性别" tabindex="-1">11. 重复数据太多，例如“性别” <a class="header-anchor" href="#_11-重复数据太多-例如-性别" aria-label="Permalink to &quot;11. 重复数据太多，例如“性别”&quot;">​</a></h3><h3 id="_12-索引不会包含有null值的列" tabindex="-1">12. 索引不会包含有NULL值的列 <a class="header-anchor" href="#_12-索引不会包含有null值的列" aria-label="Permalink to &quot;12. 索引不会包含有NULL值的列&quot;">​</a></h3><h3 id="_13-not-in和-操作都不会使用索引将进行全表扫描。not-in可以not-exists代替-id-3则可使用id-3-or-id-3来代替" tabindex="-1">13. NOT IN和&lt;&gt;操作都不会使用索引将进行全表扫描。NOT IN可以NOT EXISTS代替，id&lt;&gt;3则可使用id&gt;3 or id&lt;3来代替 <a class="header-anchor" href="#_13-not-in和-操作都不会使用索引将进行全表扫描。not-in可以not-exists代替-id-3则可使用id-3-or-id-3来代替" aria-label="Permalink to &quot;13. NOT IN和&lt;&gt;操作都不会使用索引将进行全表扫描。NOT IN可以NOT EXISTS代替，id&lt;&gt;3则可使用id&gt;3 or id&lt;3来代替&quot;">​</a></h3><h3 id="_14-查询的数量是大表的大部分-应该是30-以上" tabindex="-1">14. 查询的数量是大表的大部分，应该是30％以上 <a class="header-anchor" href="#_14-查询的数量是大表的大部分-应该是30-以上" aria-label="Permalink to &quot;14. 查询的数量是大表的大部分，应该是30％以上&quot;">​</a></h3><h3 id="设计原则" tabindex="-1">设计原则 <a class="header-anchor" href="#设计原则" aria-label="Permalink to &quot;设计原则&quot;">​</a></h3><p>多条件联合查询时，MySQL优化器会评估哪个字段的索引效率更高，会选择该索引完成本次查询</p><ol><li>针对于数据量较大，且查询比较频繁的表建立索引</li><li>针对于常作为查询条件（WHERE）、排序（order by）、分组（group by）操作的字段建立索引</li><li>尽量选择区分度高的列作为索引，尽量建立唯一索引，区分度越高，使用索引的效率越高</li><li>如果是字符串类型的字段，字段长度较长，可以针对于字段的特点，建立前缀索引</li><li>尽量使用联合索引，减少单列索引，查询时，联合索引很多时候可以覆盖索引，节省存储空间，避免回表，提高查询效率</li><li>要控制索引的数量，索引并不是多多益善，索引越多，维护索引结构的代价就越大，会影响增删改的效率</li><li>如果索引列不能存储NULL值，请在创建表时使用NOT NULL约束它。当优化器知道每列是否包含NULL值时，它可以更好地确定哪个索引最有效地用于查询</li></ol></div></div></main><footer class="VPDocFooter" data-v-6b87e69f data-v-ef5dee53><!--[--><!--]--><div class="edit-info" data-v-ef5dee53><div class="edit-link" data-v-ef5dee53><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/fxbsujay/Sujay-Docs/blob/main/docs/blog/mysql_index.md" target="_blank" rel="noreferrer" data-v-ef5dee53><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-ef5dee53><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> 在 GitHub 上编辑此页面<!--]--></a></div><div class="last-updated" data-v-ef5dee53><p class="VPLastUpdated" data-v-ef5dee53 data-v-7de715c0>最近更新时间: <time datetime="2023-08-17T11:15:43.000Z" data-v-7de715c0></time></p></div></div><nav class="prev-next" data-v-ef5dee53><div class="pager" data-v-ef5dee53><!----></div><div class="pager" data-v-ef5dee53><a class="pager-link next" href="/blog/jdk_support.html" data-v-ef5dee53><span class="desc" data-v-ef5dee53>下一页</span><span class="title" data-v-ef5dee53>JAVA JDK17 新特性</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-1919c326 data-v-e03eb2e1><div class="container" data-v-e03eb2e1><p class="message" data-v-e03eb2e1>Released under the <a href="https://github.com/fxbsujay/Sujay-Docs/blob/main/LICENSE">MIT License</a>.</p><p class="copyright" data-v-e03eb2e1>Copyright © 2020-present <a href="https://github.com/fxbsujay">Fan XueBin</a> <a href="https://beian.miit.gov.cn/">鲁ICP备2022006050号-1</a></p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"blog_hexo.md\":\"a84aa174\",\"blog_css.md\":\"e4763fc2\",\"blog_eventloop.md\":\"471536b1\",\"blog_bit_operation.md\":\"db10f3b8\",\"blog_jdk_support.md\":\"f9931fb7\",\"components_button.md\":\"439755e4\",\"blog_shiwu.md\":\"bd992913\",\"blog_docker.md\":\"cb9c53a8\",\"blog_mysql_index.md\":\"d7e8a110\",\"components_overview.md\":\"4c21adf3\",\"blog_mymap.md\":\"b912d4ee\",\"blog_seata-sharding.md\":\"1375f7d8\",\"index.md\":\"25f20114\",\"blog_text.md\":\"d495ba65\",\"blog_snow-flake.md\":\"8bc954db\",\"blog_vue.md\":\"383b36ee\",\"blog_juc.md\":\"953e4d26\",\"blog_mysql.md\":\"f6ac6a27\",\"blog_redis.md\":\"ac42df03\",\"blog_mq.md\":\"5f8384e8\",\"blog_netty.md\":\"90136efb\",\"blog_elk.md\":\"59399ef9\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Sujay\",\"titleTemplate\":\":title - Sujay\",\"description\":\"Sujay Blog.\",\"base\":\"/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"logo\":\"/favicon.ico\",\"siteTitle\":\"Fan Xuebin\",\"outline\":{\"level\":\"deep\",\"label\":\"大纲\"},\"lastUpdated\":{\"text\":\"最近更新时间\"},\"editLink\":{\"pattern\":\"https://github.com/fxbsujay/Sujay-Docs/blob/main/docs/:path\",\"text\":\"在 GitHub 上编辑此页面\"},\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"returnToTopLabel\":\"返回\",\"sidebarMenuLabel\":\"目录\",\"footer\":{\"message\":\"Released under the <a href=\\\"https://github.com/fxbsujay/Sujay-Docs/blob/main/LICENSE\\\">MIT License</a>.\",\"copyright\":\"Copyright © 2020-present <a href=\\\"https://github.com/fxbsujay\\\">Fan XueBin</a> <a href=\\\"https://beian.miit.gov.cn/\\\">鲁ICP备2022006050号-1</a>\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/fxbsujay\"}],\"nav\":[{\"text\":\"博客\",\"link\":\"/blog/jdk_support\",\"activeMatch\":\"/blog/\"},{\"text\":\"UI组件库\",\"link\":\"/components/button\",\"activeMatch\":\"/components/\"}],\"sidebar\":{\"/blog\":[{\"text\":\"后端知识库\",\"collapsed\":false,\"items\":[{\"text\":\"JAVA JDK17 新特性\",\"link\":\"/blog/jdk_support\"},{\"text\":\"位运算\",\"link\":\"/blog/bit_operation\"},{\"text\":\"Redis\",\"link\":\"/blog/redis\"},{\"text\":\"Docker\",\"link\":\"/blog/docker\"},{\"text\":\"MySql\",\"link\":\"/blog/mysql\"},{\"text\":\"MySql 索引\",\"link\":\"/blog/mysql_index\"},{\"text\":\"Java JUC\",\"link\":\"/blog/juc\"},{\"text\":\"消息队列\",\"link\":\"/blog/mq\"},{\"text\":\"ELK 学习文档\",\"link\":\"/blog/elk\"},{\"text\":\"Netty 源码分析\",\"link\":\"/blog/netty\"},{\"text\":\"雪花算法\",\"link\":\"/blog/snow-flake\"},{\"text\":\"实现一个简易Map\",\"link\":\"/blog/mymap\"},{\"text\":\"Seata 分布式事务\",\"link\":\"/blog/shiwu\"}]},{\"text\":\"前端知识库\",\"collapsed\":false,\"items\":[{\"text\":\"css选择器\",\"link\":\"/blog/css\"},{\"text\":\"事件循环\",\"link\":\"/blog/eventLoop\"},{\"text\":\"Vue3 快速上手\",\"link\":\"/blog/vue\"}]},{\"text\":\"生活小工具\",\"collapsed\":false,\"items\":[{\"text\":\"使用 Hexo 搭建一个博客\",\"link\":\"/blog/hexo\"},{\"text\":\"示例\",\"link\":\"/blog/text\"}]}],\"/components\":[{\"text\":\"基础组件\",\"collapsed\":false,\"items\":[{\"text\":\"按钮\",\"link\":\"/components/button\"}]}]}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>