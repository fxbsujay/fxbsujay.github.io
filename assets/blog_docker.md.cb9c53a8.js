import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.4cf23e62.js";const u=JSON.parse('{"title":"Docker","description":"","frontmatter":{},"headers":[],"relativePath":"blog/docker.md","filePath":"blog/docker.md","lastUpdated":1695207282000}'),p={name:"blog/docker.md"},o=l(`<h1 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-label="Permalink to &quot;Docker&quot;">​</a></h1><h2 id="使用说明" tabindex="-1">使用说明 <a class="header-anchor" href="#使用说明" aria-label="Permalink to &quot;使用说明&quot;">​</a></h2><blockquote><p><a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noreferrer">安装文档</a> <a href="https://hub.docker.com/" target="_blank" rel="noreferrer">镜像网站</a> <a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noreferrer">阿里云镜像加速</a></p></blockquote><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;"># 下载yum</span></span>
<span class="line"><span style="color:#7EB233;">tar</span><span style="color:#002339;"> </span><span style="color:#174781;">-xvf</span><span style="color:#002339;"> </span><span style="color:#A44185;">xxx.tar.gz</span></span>
<span class="line"><span style="color:#7EB233;">./yummain.py</span><span style="color:#002339;"> </span><span style="color:#A44185;">install</span><span style="color:#002339;"> </span><span style="color:#A44185;">yum</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 安装存储库</span></span>
<span class="line"><span style="color:#7EB233;">yum</span><span style="color:#002339;"> </span><span style="color:#A44185;">install</span><span style="color:#002339;"> </span><span style="color:#174781;">-y</span><span style="color:#002339;"> </span><span style="color:#A44185;">yum-utils</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 设置镜像源</span></span>
<span class="line"><span style="color:#7EB233;">yum-config-manager</span><span style="color:#002339;"> </span><span style="color:#174781;">\\</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#174781;">--add-repo</span><span style="color:#002339;"> </span><span style="color:#174781;">\\</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#A44185;">https://download.docker.com/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#002339;">    </span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 安装引擎</span></span>
<span class="line"><span style="color:#7EB233;">yum</span><span style="color:#002339;"> </span><span style="color:#A44185;">install</span><span style="color:#002339;"> </span><span style="color:#A44185;">docker-ce</span><span style="color:#002339;"> </span><span style="color:#A44185;">docker-ce-cli</span><span style="color:#002339;"> </span><span style="color:#A44185;">containerd.io</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 启动</span></span>
<span class="line"><span style="color:#7EB233;">systemctl</span><span style="color:#002339;"> </span><span style="color:#A44185;">start</span><span style="color:#002339;"> </span><span style="color:#A44185;">docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 开机自启动</span></span>
<span class="line"><span style="color:#7EB233;">systemctl</span><span style="color:#002339;"> </span><span style="color:#A44185;">enable</span><span style="color:#002339;"> </span><span style="color:#A44185;">docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 停止</span></span>
<span class="line"><span style="color:#7EB233;">systemctl</span><span style="color:#002339;"> </span><span style="color:#A44185;">stop</span><span style="color:#002339;"> </span><span style="color:#A44185;">docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 重启</span></span>
<span class="line"><span style="color:#7EB233;">systemctl</span><span style="color:#002339;"> </span><span style="color:#A44185;">restart</span><span style="color:#002339;"> </span><span style="color:#A44185;">docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 查看docker版本</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">version</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 查询Docker主体信息</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">info</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 查询帮助文档</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#174781;">--help</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">具体命</span><span style="color:#002339;">令</span><span style="color:#7B30D0;">&gt;</span><span style="color:#002339;"> </span><span style="color:#174781;">--help</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 卸载</span></span>
<span class="line"><span style="color:#7EB233;">yum</span><span style="color:#002339;"> </span><span style="color:#A44185;">remove</span><span style="color:#002339;"> </span><span style="color:#A44185;">dokcer-ce</span><span style="color:#002339;"> </span><span style="color:#A44185;">docker-ce-cli</span><span style="color:#002339;"> </span><span style="color:#A44185;">containerd.io</span></span>
<span class="line"><span style="color:#7EB233;">rm</span><span style="color:#002339;"> </span><span style="color:#174781;">-rf</span><span style="color:#002339;"> </span><span style="color:#A44185;">/var/lib/docker</span></span>
<span class="line"><span style="color:#7EB233;">rm</span><span style="color:#002339;"> </span><span style="color:#174781;">-rf</span><span style="color:#002339;"> </span><span style="color:#A44185;">/var/lib/contained</span></span></code></pre></div><h3 id="镜像加速" tabindex="-1">镜像加速 <a class="header-anchor" href="#镜像加速" aria-label="Permalink to &quot;镜像加速&quot;">​</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;"># 创建文件</span></span>
<span class="line"><span style="color:#7EB233;">mkdir</span><span style="color:#002339;"> </span><span style="color:#174781;">-p</span><span style="color:#002339;"> </span><span style="color:#A44185;">/etc/docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 修改配置, 设置镜像</span></span>
<span class="line"><span style="color:#7EB233;">tee</span><span style="color:#002339;"> </span><span style="color:#A44185;">/etc/docker/daemon.json</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;&lt;-</span><span style="color:#002339;">&#39;</span><span style="color:#002339;">EOF</span><span style="color:#002339;">&#39;</span></span>
<span class="line"><span style="color:#A44185;">{</span></span>
<span class="line"><span style="color:#A44185;">  &quot;registry-mirrors&quot;: [&quot;https://vw9qapdy.mirror.aliyuncs.com&quot;]</span></span>
<span class="line"><span style="color:#A44185;">}</span></span>
<span class="line"><span style="color:#002339;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 重启后台线程</span></span>
<span class="line"><span style="color:#7EB233;">systemctl</span><span style="color:#002339;"> </span><span style="color:#A44185;">daemon-reload</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 重启docker</span></span>
<span class="line"><span style="color:#7EB233;">systemctl</span><span style="color:#002339;"> </span><span style="color:#A44185;">restart</span><span style="color:#002339;"> </span><span style="color:#A44185;">docker</span></span></code></pre></div><h3 id="常用命令" tabindex="-1">常用命令 <a class="header-anchor" href="#常用命令" aria-label="Permalink to &quot;常用命令&quot;">​</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;">## 查看当前下载的所有镜像</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">images</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 搜索 镜像，列出25个</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">search</span><span style="color:#002339;"> </span><span style="color:#174781;">--limit</span><span style="color:#002339;"> </span><span style="color:#174781;">25</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">镜</span><span style="color:#002339;">像</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 下载镜像，可以不指定版本，默认下载最新</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">pull</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">镜</span><span style="color:#002339;">像</span><span style="color:#7B30D0;">&gt;</span><span style="color:#A44185;">:</span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">版</span><span style="color:#002339;">本</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 删除镜像</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">rmi</span><span style="color:#002339;">  </span><span style="color:#174781;">-f</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">镜</span><span style="color:#002339;">像</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 删除全部镜像</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">rmi</span><span style="color:#002339;"> </span><span style="color:#174781;">-f</span><span style="color:#002339;"> </span><span style="color:#A44185;">$(</span><span style="color:#7EB233;">docker</span><span style="color:#A44185;"> images </span><span style="color:#174781;">-qa</span><span style="color:#A44185;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 创建并启动镜像容器</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">run</span><span style="color:#002339;"> [参数数组] </span><span style="color:#7B30D0;">&lt;</span><span style="color:#002339;">镜像</span><span style="color:#7B30D0;">&gt;</span><span style="color:#002339;"> [附加命令数组] [附加启动参数数组]  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 列出当前启动中的容器</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">ps</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 列出当前所有容器</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">ps</span><span style="color:#002339;"> </span><span style="color:#174781;">-a</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 进入容器内部</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">exec</span><span style="color:#002339;"> </span><span style="color:#174781;">-it</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span><span style="color:#002339;"> </span><span style="color:#A44185;">/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 退出容器，容器停止</span></span>
<span class="line"><span style="color:#1AB394;">exit</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 推出以容器，容器不停止</span></span>
<span class="line"><span style="color:#7EB233;">ctrl</span><span style="color:#002339;"> </span><span style="color:#A44185;">+</span><span style="color:#002339;"> </span><span style="color:#A44185;">p</span><span style="color:#002339;"> </span><span style="color:#A44185;">+</span><span style="color:#002339;"> </span><span style="color:#A44185;">q</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 启动容器</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">start</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 重启容器</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">restart</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 停止容器</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">stop</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 强制杀死容器</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">kill</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 删除容器, 要先停止容器再删除</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">rm</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 随docker启动则自动启动容器，不设置重启docker不会启动容器</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">update</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span><span style="color:#002339;"> </span><span style="color:#174781;">--restart=always</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 复制容器文件</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">cp</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容</span><span style="color:#002339;">器</span><span style="color:#7B30D0;">&gt;</span><span style="color:#A44185;">:</span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器目录文</span><span style="color:#002339;">件</span><span style="color:#7B30D0;">&gt;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">本机目录文</span><span style="color:#002339;">件</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 构建镜像</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">build</span><span style="color:#002339;"> </span><span style="color:#174781;">-t</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">名</span><span style="color:#002339;">称</span><span style="color:#7B30D0;">&gt;</span><span style="color:#A44185;">:</span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">标</span><span style="color:#002339;">签</span><span style="color:#7B30D0;">&gt;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">DockerFile相对路</span><span style="color:#002339;">径</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 查看映射端口对应的容器内部源端口</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">port</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 查看容器详情</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">inspect</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 查看日志</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">inspect</span><span style="color:#002339;"> </span><span style="color:#174781;">--format</span><span style="color:#002339;"> </span><span style="color:#A44185;">&#39;{{.LogPath}}&#39;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"><span style="color:#7EB233;">cat</span><span style="color:#002339;"> </span><span style="color:#A44185;">/var/lib/docker/xxxxx.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># -f 跟踪日志，-t 显示时间</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#174781;">-f</span><span style="color:#002339;"> </span><span style="color:#174781;">-t</span><span style="color:#002339;"> </span><span style="color:#A44185;">logs</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 查看历史版本信息</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">history</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 查看容器ip</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">inspect</span><span style="color:#002339;"> </span><span style="color:#174781;">--format=</span><span style="color:#A44185;">&#39;{{.NetworkSettings.IPAddress}}&#39;</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 查看容器进程信息</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">top</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">容器名</span><span style="color:#002339;"> </span><span style="color:#A44185;">/</span><span style="color:#002339;"> </span><span style="color:#A44185;">I</span><span style="color:#002339;">D</span><span style="color:#7B30D0;">&gt;</span></span></code></pre></div><h3 id="dockerfile" tabindex="-1">DockerFile <a class="header-anchor" href="#dockerfile" aria-label="Permalink to &quot;DockerFile&quot;">​</a></h3><blockquote><p><a href="https://docs.docker.com/engine/reference/builder/" target="_blank" rel="noreferrer">参考文档</a> <a href="https://github.com/docker-library/tomcat/blob/master/8.5/jdk8/temurin-jammy/Dockerfile" target="_blank" rel="noreferrer">Tomcat案例</a></p></blockquote><p>FROM</p><p>指定基础镜像，当前镜像依赖于哪个镜像，DockerFile的第一条语句必须是FROM</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7EB233;">FROM</span><span style="color:#002339;"> </span><span style="color:#A44185;">centos</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7EB233;">FROM</span><span style="color:#002339;"> </span><span style="color:#A44185;">java:8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7EB233;">FROM</span><span style="color:#002339;"> </span><span style="color:#A44185;">openjdk:8-jdk-alpine</span></span></code></pre></div><p>MAINTAINER</p><p>指定镜像作者</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7EB233;">MAINTAINER</span><span style="color:#002339;"> </span><span style="color:#A44185;">fxbsujat@gmail.com</span></span></code></pre></div><p>RUN</p><p>此命令是在 docker build 时进行</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7EB233;">RUN</span><span style="color:#002339;"> </span><span style="color:#A44185;">echo</span><span style="color:#002339;"> </span><span style="color:#A44185;">&#39;Hello, Docker!&#39;</span><span style="color:#002339;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7EB233;">RUN</span><span style="color:#002339;"> [</span><span style="color:#A44185;">&quot;/bin/bash&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;-c&quot;,</span><span style="color:#002339;"> </span><span style="color:#A44185;">&quot;echo hello&quot;]</span></span></code></pre></div><p>EXPOSE</p><p>仅仅只是声明端口</p><p>作用：</p><ul><li>帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射</li><li>在运行时使用随机端口映射时，也就是 docker run -P 时，会自动随机映射 EXPOSE 的端口</li></ul><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7EB233;">EXPOSE</span><span style="color:#002339;"> </span><span style="color:#174781;">3306</span></span>
<span class="line"><span style="color:#7EB233;">EXPOSE</span><span style="color:#002339;"> </span><span style="color:#174781;">8080</span><span style="color:#A44185;">/tcp</span><span style="color:#002339;"> </span><span style="color:#174781;">9000</span><span style="color:#A44185;">/udp</span></span></code></pre></div><p>WORKDIR</p><p>指定工作目录，如该目录不存在，则建立目录，终端登录的默认目录</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#002339;">WORKDIR /usr/local/tomcat</span></span></code></pre></div><p>USER</p><p>指定该镜像以什么用户去执行，默认为root</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7EB233;">USER</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">用户</span><span style="color:#002339;">名</span><span style="color:#7B30D0;">&gt;</span><span style="color:#A44185;">[:</span><span style="color:#7B30D0;">&lt;</span><span style="color:#A44185;">用户</span><span style="color:#002339;">组</span><span style="color:#7B30D0;">&gt;</span><span style="color:#A44185;">]</span></span></code></pre></div><p>ENV</p><p>设置环境变量，定义了环境变量，那么在后续的指令中，就可以使用这个环境变量</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7EB233;">ENV</span><span style="color:#002339;"> </span><span style="color:#A44185;">JAVA_PATH</span><span style="color:#002339;"> </span><span style="color:#A44185;">/usr/java1.8</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7EB233;">RUN</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">$JAVA_PATH</span><span style="color:#002339;"> </span><span style="color:#174781;">-jar</span><span style="color:#002339;"> </span><span style="color:#A44185;">app.jar</span></span></code></pre></div><p>ADD</p><p>将宿主机下的文件/目录复制到镜像内且自动处理URL和解压tar压缩包,路径为相对路径</p><p>如果是URL 将自动创建路径目录，并将文件放在路径目录下</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7EB233;">ADD</span><span style="color:#002339;"> </span><span style="color:#A44185;">demo-0.0.1-SNAPSHOT.jar</span><span style="color:#002339;"> </span><span style="color:#A44185;">app.jar</span></span>
<span class="line"><span style="color:#7EB233;">ADD</span><span style="color:#002339;"> </span><span style="color:#A44185;">http://xxx.com/demo/demo-0.0.1-SNAPSHOT.jar</span></span></code></pre></div><p>COPY</p><p>类似于ADD，拷贝文件和目录到镜像中</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7EB233;">COPY</span><span style="color:#002339;"> </span><span style="color:#A44185;">overview.md.txt</span><span style="color:#002339;"> </span><span style="color:#A44185;">/mydir/</span></span></code></pre></div><p>VOLUME</p><p>定义匿名数据卷。在启动容器时忘记挂载数据卷，会自动挂载到匿名卷，在启动容器 docker run 的时候，我们可以通过 -v 参数修改挂载点</p><p>作用：</p><ul><li>避免重要的数据，因容器重启而丢失，这是非常致命的</li><li>避免容器不断变大</li></ul><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7EB233;">VOLUME</span><span style="color:#002339;"> </span><span style="color:#A44185;">/tmp</span></span></code></pre></div><p>CMD</p><p>类似于 RUN 指令，在 docker run 时运行，如果出现多个CMD，只有最后一个CMD会生效，使用括号时，第一行的参数如果在指定位置或系统的环境变量找不到就会被当作ENTRYPOINT的参数来使用</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7EB233;">CMD</span><span style="color:#002339;"> </span><span style="color:#A44185;">echo</span><span style="color:#002339;"> </span><span style="color:#A44185;">&#39;Hello, Docker!&#39;</span></span>
<span class="line"><span style="color:#7EB233;">CMD</span><span style="color:#002339;"> [</span><span style="color:#A44185;">&quot;&lt;可执行文件或命令&gt;&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;&lt;参数&gt;&quot;,</span><span style="color:#002339;"> </span><span style="color:#A44185;">&quot;&lt;参数&gt;&quot;,</span><span style="color:#002339;"> </span><span style="color:#A44185;">...]</span><span style="color:#002339;"> </span></span>
<span class="line"><span style="color:#7EB233;">CMD</span><span style="color:#002339;"> [</span><span style="color:#A44185;">&quot;&lt;参数&gt;&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;&lt;参数&gt;&quot;,</span><span style="color:#002339;"> </span><span style="color:#A44185;">...]</span></span></code></pre></div><p>ENTRYPOINT</p><p>类似于 CMD 指令，但其不会被 docker run 的命令行参数指定的指令所覆盖，而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;"># nginx -c /etc/nginx/nginx.conf</span></span>
<span class="line"><span style="color:#7EB233;">CMD</span><span style="color:#002339;"> [</span><span style="color:#A44185;">&quot;/etc/nginx/nginx.conf&quot;</span><span style="color:#002339;">]</span></span>
<span class="line"><span style="color:#7EB233;">ENTRYPOINT</span><span style="color:#002339;"> [</span><span style="color:#A44185;">&quot;nginx&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;-c&quot;]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7EB233;">ENTRYPOINT</span><span style="color:#002339;"> [</span><span style="color:#A44185;">&quot;java&quot;</span><span style="color:#002339;">, </span><span style="color:#A44185;">&quot;-jar&quot;,</span><span style="color:#002339;"> </span><span style="color:#A44185;">&quot;/app.jar&quot;]</span></span></code></pre></div><h3 id="阿里云镜像仓库" tabindex="-1">阿里云镜像仓库 <a class="header-anchor" href="#阿里云镜像仓库" aria-label="Permalink to &quot;阿里云镜像仓库&quot;">​</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#357B42;font-style:italic;"># 登录到自己的阿里云镜像仓库</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">login</span><span style="color:#002339;"> </span><span style="color:#174781;">--username=</span><span style="color:#7B30D0;">***</span><span style="color:#002339;"> </span><span style="color:#A44185;">registry.cn-hangzhou.aliyuncs.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 添加镜像</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">tag</span><span style="color:#002339;"> [本地镜像名或ID] registry.cn-hangzhou.aliyuncs.com/命名空间/镜像仓库:[镜像版本号]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 上传镜像</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">push</span><span style="color:#002339;"> </span><span style="color:#A44185;">registry.cn-hangzhou.aliyuncs.com/命名空间/镜像仓库:[镜像版本号]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;"># 拉取镜像</span></span>
<span class="line"><span style="color:#7EB233;">docker</span><span style="color:#002339;"> </span><span style="color:#A44185;">pull</span><span style="color:#002339;"> </span><span style="color:#A44185;">registry.cn-hangzhou.aliyuncs.com/命名空间/镜像仓库:[镜像版本号]</span></span></code></pre></div>`,53),e=[o];function c(t,r,y,i,d,A){return n(),a("div",null,e)}const h=s(p,[["render",c]]);export{u as __pageData,h as default};
