import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.4cf23e62.js";const A=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"blog/snow-flake.md","filePath":"blog/snow-flake.md","lastUpdated":1683707315000}'),p={name:"blog/snow-flake.md"},o=l(`<div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki slack-ochin"><code><span class="line"><span style="color:#7B30D0;">package</span><span style="color:#002339;"> </span><span style="color:#DA5221;">com.susu.utils</span><span style="color:#002339;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"> * &lt;p&gt;Description: Snow flakeId Worker&lt;/p&gt;</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"> * &lt;p&gt;雪花算法ID&lt;/p&gt;</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"> * </span><span style="color:#7B30D0;">@author</span><span style="color:#357B42;font-style:italic;"> fxbsujay@gmail.com</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"> * </span><span style="color:#7B30D0;">@version</span><span style="color:#357B42;font-style:italic;"> 13:08 2022/4/28</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"> * </span><span style="color:#7B30D0;">@since</span><span style="color:#357B42;font-style:italic;"> JDK1.8</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">class</span><span style="color:#002339;"> </span><span style="color:#0444AC;">SnowFlakeUtils</span><span style="color:#002339;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 数据中心 ( 0 - 31 )</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">DATA_CENTER_ID</span><span style="color:#002339;">;</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 机器标识 ( 0 - 31 )</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">MACHINE_ID</span><span style="color:#002339;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 毫秒内序列号 ( 0 - 4095 )</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">sequence</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#174781;">0L</span><span style="color:#002339;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 上一次生成ID的时间戳</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">lastStamp</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">-</span><span style="color:#174781;">1L</span><span style="color:#002339;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 起始的时间戳 （ 2019-01-01 ）</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">START_STAMP</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#174781;">1480166465631L</span><span style="color:#002339;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 序列号占用的位数</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">SEQUENCE_BIT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#174781;">12L</span><span style="color:#002339;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 机器标识占用的位数</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">MACHINE_BIT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#174781;">5L</span><span style="color:#002339;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 数据中心占用的位数</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">DATACENTER_BIT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#174781;">5L</span><span style="color:#002339;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * ~ 运算符的含义</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * int a = 10;</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * System.out.println(~a);</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 正数的原码 = 反码 = 补码</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 负数的反码 = 原码符号位不变，其它位全取反，负数的补码 = 反码 + 1</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * ~表示非运算符，就是将该数的所有二进制位全取反，</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 但又由于计算机中是以补码的形式存储的，所以0 1010全取反是1 0101（只是补码形式，还需要转成原码）</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 此时得到的1 0101只是补码，我们需要将它先转为反码，反码 = 补码-1，得到反码为1 010</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 我们得到反码后，将它转为原码，原码 = 反码符号位不变，其它位全取反，得到最终的原码为1 1011，转化为十进制就是-11</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     *</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 每一部分的最大值</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">MAX_SEQUENCE</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">~</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">-</span><span style="color:#174781;">1L</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;&lt;</span><span style="color:#002339;"> SEQUENCE_BIT);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">MAX_MACHINE_NUM</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">~</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">-</span><span style="color:#174781;">1L</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;&lt;</span><span style="color:#002339;"> MACHINE_BIT);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">MAX_DATACENTER_NUM</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">~</span><span style="color:#002339;">(</span><span style="color:#7B30D0;">-</span><span style="color:#174781;">1L</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;&lt;</span><span style="color:#002339;"> DATACENTER_BIT);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 机器id向左移12位</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">MACHINE_LEFT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> SEQUENCE_BIT;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 数据标识id向左移17位 （ 12 + 5 ）</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">DATACENTER_LEFT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> SEQUENCE_BIT </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> MACHINE_BIT;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 时间戳向左移22位 （ 5 + 5 + 12 ）</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#DA5221;">final</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">TIMESTAMP_LEFT</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> DATACENTER_LEFT </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> DATACENTER_BIT;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * 构造函数</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * </span><span style="color:#7B30D0;">@param</span><span style="color:#357B42;font-style:italic;"> </span><span style="color:#B1108E;">datacenterId</span><span style="color:#357B42;font-style:italic;"> 数据中心ID （ 0 - 31 ）</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * </span><span style="color:#7B30D0;">@param</span><span style="color:#357B42;font-style:italic;"> </span><span style="color:#B1108E;">machineId</span><span style="color:#357B42;font-style:italic;">  机器Id （ 0 - 31 ）</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SnowFlakeUtils</span><span style="color:#002339;">(</span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#B1108E;">datacenterId</span><span style="color:#002339;">, </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#B1108E;">machineId</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">if</span><span style="color:#002339;"> (datacenterId </span><span style="color:#7B30D0;">&gt;</span><span style="color:#002339;"> MAX_DATACENTER_NUM </span><span style="color:#7B30D0;">||</span><span style="color:#002339;"> datacenterId </span><span style="color:#7B30D0;">&lt;</span><span style="color:#002339;"> </span><span style="color:#174781;">0</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#7B30D0;">throw</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">IllegalArgumentException</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;datacenterId can&#39;t be greater than MAX_DATACENTER_NUM or less than 0&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">if</span><span style="color:#002339;"> (machineId </span><span style="color:#7B30D0;">&gt;</span><span style="color:#002339;"> MAX_MACHINE_NUM </span><span style="color:#7B30D0;">||</span><span style="color:#002339;"> machineId </span><span style="color:#7B30D0;">&lt;</span><span style="color:#002339;"> </span><span style="color:#174781;">0</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#7B30D0;">throw</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">IllegalArgumentException</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;machineId can&#39;t be greater than MAX_MACHINE_NUM or less than 0&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#000000;">this</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">DATA_CENTER_ID</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> datacenterId;</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#000000;">this</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">MACHINE_ID</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> machineId;</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * &lt;p&gt;Description: generate next ID&lt;/p&gt;</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * &lt;p&gt;产生下一个ID&lt;/p&gt;</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * </span><span style="color:#7B30D0;">@return</span><span style="color:#357B42;font-style:italic;"> SnowflakeId</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">synchronized</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#7EB233;">nextId</span><span style="color:#002339;">() {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">timeStamp</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7EB233;">timeGen</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">if</span><span style="color:#002339;"> (timeStamp </span><span style="color:#7B30D0;">&lt;</span><span style="color:#002339;"> lastStamp) {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#7B30D0;">throw</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">RuntimeException</span><span style="color:#002339;">(</span><span style="color:#A44185;">&quot;Clock moved backwards. Refusing to generate id&quot;</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">if</span><span style="color:#002339;"> (timeStamp </span><span style="color:#7B30D0;">==</span><span style="color:#002339;"> lastStamp) {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//相同毫秒内，序列号自增</span></span>
<span class="line"><span style="color:#002339;">            sequence </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> (sequence </span><span style="color:#7B30D0;">+</span><span style="color:#002339;"> </span><span style="color:#174781;">1</span><span style="color:#002339;">) </span><span style="color:#7B30D0;">&amp;</span><span style="color:#002339;"> MAX_SEQUENCE;</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//同一毫秒的序列数已经达到最大</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#7B30D0;">if</span><span style="color:#002339;"> (sequence </span><span style="color:#7B30D0;">==</span><span style="color:#002339;"> </span><span style="color:#174781;">0L</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">                timeStamp </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7EB233;">getNextMill</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            }</span></span>
<span class="line"><span style="color:#002339;">        } </span><span style="color:#7B30D0;">else</span><span style="color:#002339;"> {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#357B42;font-style:italic;">//不同毫秒内，序列号置为0</span></span>
<span class="line"><span style="color:#002339;">            sequence </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#174781;">0L</span><span style="color:#002339;">;</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">        lastStamp </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> timeStamp;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#357B42;font-style:italic;">// 移位并通过或运算拼到一起组成64位ID</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">return</span><span style="color:#002339;"> (timeStamp </span><span style="color:#7B30D0;">-</span><span style="color:#002339;"> START_STAMP) </span><span style="color:#7B30D0;">&lt;&lt;</span><span style="color:#002339;"> </span><span style="color:#0991B6;">TIMESTAMP_LEFT</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#7B30D0;">|</span><span style="color:#002339;"> </span><span style="color:#0991B6;">DATA_CENTER_ID</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;&lt;</span><span style="color:#002339;"> </span><span style="color:#0991B6;">DATACENTER_LEFT</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#7B30D0;">|</span><span style="color:#002339;"> </span><span style="color:#0991B6;">MACHINE_ID</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">&lt;&lt;</span><span style="color:#002339;"> </span><span style="color:#0991B6;">MACHINE_LEFT</span></span>
<span class="line"><span style="color:#002339;">                </span><span style="color:#7B30D0;">|</span><span style="color:#002339;"> sequence;</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#7EB233;">getNextMill</span><span style="color:#002339;">() {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">mill</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7EB233;">timeGen</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">while</span><span style="color:#002339;"> (mill </span><span style="color:#7B30D0;">&lt;=</span><span style="color:#002339;"> lastStamp) {</span></span>
<span class="line"><span style="color:#002339;">            mill </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7EB233;">timeGen</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">return</span><span style="color:#002339;"> mill;</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#357B42;font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     * </span><span style="color:#7B30D0;">@return</span><span style="color:#357B42;font-style:italic;"> 当前时间戳</span></span>
<span class="line"><span style="color:#357B42;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">private</span><span style="color:#002339;"> </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#7EB233;">timeGen</span><span style="color:#002339;">() {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">return</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#7EB233;">currentTimeMillis</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    </span><span style="color:#DA5221;">public</span><span style="color:#002339;"> </span><span style="color:#DA5221;">static</span><span style="color:#002339;"> </span><span style="color:#0991B6;">void</span><span style="color:#002339;"> </span><span style="color:#7EB233;">main</span><span style="color:#002339;">(</span><span style="color:#0991B6;">String</span><span style="color:#002339;">[] </span><span style="color:#B1108E;">args</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SnowFlakeUtils</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">utilA</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SnowFlakeUtils</span><span style="color:#002339;">(</span><span style="color:#174781;">1</span><span style="color:#002339;">,</span><span style="color:#174781;">1</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">for</span><span style="color:#002339;"> (</span><span style="color:#0991B6;">int</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">i</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#174781;">0</span><span style="color:#002339;">; i </span><span style="color:#7B30D0;">&lt;</span><span style="color:#002339;"> </span><span style="color:#174781;">10</span><span style="color:#002339;">; i</span><span style="color:#7B30D0;">++</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">id</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">utilA</span><span style="color:#002339;">.</span><span style="color:#7EB233;">nextId</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(id);</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#0991B6;">SnowFlakeUtils</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">utilB</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">new</span><span style="color:#002339;"> </span><span style="color:#7EB233;">SnowFlakeUtils</span><span style="color:#002339;">(</span><span style="color:#174781;">2</span><span style="color:#002339;">,</span><span style="color:#174781;">1</span><span style="color:#002339;">);</span></span>
<span class="line"><span style="color:#002339;">        </span><span style="color:#7B30D0;">for</span><span style="color:#002339;"> (</span><span style="color:#0991B6;">int</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">i</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#174781;">0</span><span style="color:#002339;">; i </span><span style="color:#7B30D0;">&lt;</span><span style="color:#002339;"> </span><span style="color:#174781;">10</span><span style="color:#002339;">; i</span><span style="color:#7B30D0;">++</span><span style="color:#002339;">) {</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#0991B6;">long</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">id</span><span style="color:#002339;"> </span><span style="color:#7B30D0;">=</span><span style="color:#002339;"> </span><span style="color:#2F86D2;">utilB</span><span style="color:#002339;">.</span><span style="color:#7EB233;">nextId</span><span style="color:#002339;">();</span></span>
<span class="line"><span style="color:#002339;">            </span><span style="color:#2F86D2;">System</span><span style="color:#002339;">.</span><span style="color:#2F86D2;">out</span><span style="color:#002339;">.</span><span style="color:#7EB233;">println</span><span style="color:#002339;">(id);</span></span>
<span class="line"><span style="color:#002339;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#002339;">}</span></span></code></pre></div>`,1),t=[o];function e(c,y,r,i,B,D){return n(),a("div",null,t)}const E=s(p,[["render",e]]);export{A as __pageData,E as default};
